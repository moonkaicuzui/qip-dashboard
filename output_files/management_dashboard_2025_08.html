<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Management Dashboard - 2025ë…„ 8ì›”</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #ffffff;
            color: #212529;
            line-height: 1.6;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #000 0%, #333 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header-info {
            display: flex;
            gap: 30px;
            font-size: 14px;
            opacity: 0.9;
            align-items: center;
        }
        
        .nav-button {
            background-color: #FF6B6B;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: auto;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .cards-grid-3x3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .hr-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .hr-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #007bff;
        }
        
        .card-number {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .card-title {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .card-value {
            font-size: 32px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .card-subtitle {
            font-size: 12px;
            color: #6c757d;
        }
        
        .card-change {
            margin-top: 10px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .change-positive {
            background-color: #d4edda;
            color: #155724;
        }
        
        .change-negative {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .change-neutral {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .quality-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .quality-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
        }
        
        .quality-content {
            margin-top: 15px;
            color: #6c757d;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            width: 90%;
            max-width: 1200px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #000 0%, #333 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 24px;
            margin: 0;
        }
        
        .close-modal {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .close-modal:hover {
            opacity: 0.8;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .chart-container {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            /* Flexible height - adapts to content */
            min-height: 300px;
            /* Prevent overflow */
            overflow: hidden;
            position: relative;
        }
        
        /* Special container for charts with fixed height */
        .chart-container.fixed-height {
            height: 350px;
        }
        
        /* Container for treemap - larger and flexible */
        .chart-container.treemap-container {
            min-height: 400px;
            /* Allow treemap to define its own height */
            height: auto;
            /* Ensure content stays within bounds */
            overflow: visible;
        }
        
        /* Card container for sections */
        .card-section {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            /* Flexible sizing */
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Responsive card grid */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
        }
        
        .type-cards {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .type-card {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border: 2px solid;
            text-align: center;
        }
        
        .type-card .label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .type-card .value {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .type-card .percentage {
            font-size: 14px;
            color: #6c757d;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background-color: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
        }
        
        td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .rank {
            font-weight: bold;
            color: #007bff;
        }
        
        .team-name {
            font-weight: 600;
        }
        
        .percentage-high {
            color: #28a745;
            font-weight: bold;
        }
        
        .percentage-medium {
            color: #ffc107;
            font-weight: bold;
        }
        
        .percentage-low {
            color: #dc3545;
            font-weight: bold;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(0, 0, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
        .chart-container {
            animation: fadeInUp 0.8s ease-out;
        }
        
        /* ì¹´ë“œ ê°œì„  íš¨ê³¼ */
        .hr-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }
        
        .hr-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .hr-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .hr-card:hover::before {
            left: 100%;
        }
        
        /* ì¹´ë“œ ë²ˆí˜¸ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
        .card-number {
            animation: pulse 2s infinite;
        }
        
        /* ì¹´ë“œ ê°’ í˜ì´ë“œì¸ ì• ë‹ˆë©”ì´ì…˜ */
        .card-value {
            animation: fadeInUp 0.6s ease-out;
        }
        
    </style>
</head>
<body>
    <div class="dashboard-container">
        
        <div class="header">
            <h1>ì¸ì‚¬/ì¶œê²° ë¶„ì„</h1>
            <div class="header-info">
                <span>ğŸ“… 2025ë…„ 8ì›”</span>
                <span>ğŸ“† ë°ì´í„° ê¸°ê°„: 2025.08.01 ~ 2025.08.31</span>
                <span>â° ìƒì„±ì¼ì‹œ: 2025-09-02 10:34:20</span>
                <span>ğŸš« No Fake Data</span>
                <button onclick="navigateToIncentive()" class="nav-button">ğŸ“Š Incentive Dashboard</button>
            </div>
        </div>
        
        
        <!-- HR Analytics Section -->
        <div class="section hr-section">
            <h2 class="section-title">
                ğŸ“Š ì¸ì‚¬/ì¶œê²° ë¶„ì„
                <span style="font-size: 14px; color: #6c757d; margin-left: 10px;">
                    (ìµœì‹  ë°ì´í„°: 2025ë…„ 8ì›” 29ì¼ ê¸°ì¤€)
                </span>
            </h2>
            <div class="cards-grid-3x3">
                
            <div class="hr-card" onclick="openModal('modal-total-employees')">
                <div class="card-number">1</div>
                <div class="card-title">ì´ì¸ì› ì •ë³´</div>
                <div class="card-value">383ëª…</div>
                <div class="card-subtitle">TYPE-1: 127ëª… TYPE-2: 236ëª… TYPE-3: 20ëª…</div>
                <div class="card-change change-positive">â–² 0.8% vs last month (+3ëª…)</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-absence')">
                <div class="card-number">2</div>
                <div class="card-title">ê²°ê·¼ì ì •ë³´/ê²°ê·¼ìœ¨</div>
                <div class="card-value">8.7%</div>
                <div class="card-subtitle">ê²°ê·¼ì: 77ëª…</div>
                <div class="card-change change-negative">â–¼ 5.2% vs last month</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-resignation')">
                <div class="card-number">3</div>
                <div class="card-title">í‡´ì‚¬ìœ¨</div>
                <div class="card-value">2.3%</div>
                <div class="card-subtitle">í‡´ì‚¬ì: 9ëª…</div>
                <div class="card-change change-negative">â–¼ 41.7% vs last month</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-new-hires')">
                <div class="card-number">4</div>
                <div class="card-title">ìµœê·¼ 30ì¼ë‚´
ì…ì‚¬ ì¸ì›</div>
                <div class="card-value">15ëª…</div>
                <div class="card-subtitle">ì‹ ì… ë¹„ìœ¨: 3.9%</div>
                <div class="card-change change-positive">â–² 150.0% vs last month (+9ëª…)</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-new-resignations')">
                <div class="card-number">5</div>
                <div class="card-title">ìµœê·¼ 30ì¼ë‚´
í‡´ì‚¬ ì¸ì›
(ì‹ ì… í‡´ì‚¬ìœ¨)</div>
                <div class="card-value">17ëª…</div>
                <div class="card-subtitle">ì‹ ì… í‡´ì‚¬ìœ¨: 113.3%</div>
                <div class="card-change change-negative">â–¼ 10.5% vs last month (-2ëª…)</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-under-60')">
                <div class="card-number">6</div>
                <div class="card-title">ì…ì‚¬ 60ì¼ ë¯¸ë§Œ
ì¸ì›</div>
                <div class="card-value">24ëª…</div>
                <div class="card-subtitle">ë¹„ìœ¨: 6.3%</div>
                <div class="card-change change-positive">â–² 100.0% vs last month (+12ëª…)</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-post-assignment')">
                <div class="card-number">7</div>
                <div class="card-title">ë³´ì§ ë¶€ì—¬ í›„
í‡´ì‚¬ ì¸ì›</div>
                <div class="card-value">5ëª…</div>
                <div class="card-subtitle">í‡´ì‚¬ìœ¨: 20.8%</div>
                <div class="card-change change-positive">â–² 25.0% vs last month (+1ëª…)</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-full-attendance')">
                <div class="card-number">8</div>
                <div class="card-title">ë§Œê·¼ì</div>
                <div class="card-value">306ëª…</div>
                <div class="card-subtitle">ë§Œê·¼ìœ¨: 79.9%</div>
                <div class="card-change change-neutral">ìƒˆë¡œìš´ ë°ì´í„°</div>
            </div>
            
            <div class="hr-card" onclick="openModal('modal-long-term')">
                <div class="card-number">9</div>
                <div class="card-title">ì¥ê¸°ê·¼ì†ì
(1ë…„ ì´ìƒ)</div>
                <div class="card-value">276ëª…</div>
                <div class="card-subtitle">ì¥ê¸°ê·¼ì†ìœ¨: 72.1%</div>
                <div class="card-change change-neutral">ìƒˆë¡œìš´ ë°ì´í„°</div>
            </div>
            
            </div>
        </div>
        
        <!-- Quality Section -->
        <div class="section quality-section">
            <h2 class="section-title">ğŸ“ˆ í’ˆì§ˆ ë¶„ì„</h2>
            <div class="quality-grid">
                <div class="quality-card">
                    <h3>ğŸ¯ 5PRS ë¶„ì„</h3>
                    <div class="quality-content">
                        <p>5 Point Rating System</p>
                        <p>ë°ì´í„° ì¤€ë¹„ ì¤‘...</p>
                    </div>
                </div>
                <div class="quality-card">
                    <h3>âœ… AQL ë¶„ì„</h3>
                    <div class="quality-content">
                        <p>Acceptable Quality Level</p>
                        <p>ë°ì´í„° ì¤€ë¹„ ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
        
        
            <div id="modal-total-employees" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ì´ì¸ì› ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-total-employees')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-absence" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ê²°ê·¼ í˜„í™© ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-absence')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-resignation" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">í‡´ì‚¬ í˜„í™© ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-resignation')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-new-hires" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ì‹ ê·œ ì…ì‚¬ì ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-new-hires')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-new-resignations" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ì‹ ì… í‡´ì‚¬ì ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-new-resignations')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-under-60" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">60ì¼ ë¯¸ë§Œ ê·¼ë¬´ì ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-under-60')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-post-assignment" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ë³´ì§ ë¶€ì—¬ í›„ í‡´ì‚¬ì ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-post-assignment')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-full-attendance" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ë§Œê·¼ì ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-full-attendance')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div id="modal-long-term" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ì¥ê¸°ê·¼ì†ì ìƒì„¸ ë¶„ì„</h2>
                        <span class="close-modal" onclick="closeModal('modal-long-term')">&times;</span>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
            
    </div>
    
    <!-- Team Detail Popup -->
    <div id="team-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="team-detail-title">íŒ€ ìƒì„¸ ì •ë³´</h2>
                <span class="close-modal" onclick="closeTeamDetailModal()">&times;</span>
            </div>
            <div class="modal-body" id="team-detail-body">
                <!-- íŒ€ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>
    
    <script>
        
        // ì „ì—­ ë°ì´í„°
        const monthlyDataJuly = {"total_employees": 380, "type1_count": "128", "type2_count": "236", "type3_count": "16", "attendance_rate": 90.82379862700229, "absence_rate": 9.17620137299771, "absence_count": 68, "resignation_count": 15, "resignation_rate": 3.9473684210526314, "recent_hires": 6, "recent_hires_rate": 1.5789473684210527, "recent_resignations": 19, "recent_resignation_rate": 316.66666666666663, "under_60_days": 12, "under_60_days_rate": 3.1578947368421053, "post_assignment_resignations": 4, "post_assignment_resignation_rate": 33.33333333333333};
        const monthlyDataAugust = {"total_employees": 383, "type1_count": "127", "type2_count": "236", "type3_count": "20", "attendance_rate": 91.30347459329182, "absence_rate": 8.696525406708176, "absence_count": 77, "resignation_count": 9, "resignation_rate": 2.3498694516971277, "recent_hires": 15, "recent_hires_rate": 3.91644908616188, "recent_resignations": 17, "recent_resignation_rate": 113.33333333333333, "under_60_days": 24, "under_60_days_rate": 6.266318537859007, "post_assignment_resignations": 5, "post_assignment_resignation_rate": 20.833333333333336, "full_attendance_count": 306, "full_attendance_rate": 79.89556135770235, "long_term_count": 276, "long_term_rate": 72.0626631853786};
        const currentWeeklyData = {"Week1": {"total_employees": 374, "attendance_rate": 91.75, "absence_rate": 8.25, "new_hires": 1, "resignations": 3}, "Week2": {"total_employees": 375, "attendance_rate": 91.62, "absence_rate": 8.38, "new_hires": 5, "resignations": 4}, "Week3": {"total_employees": 376, "attendance_rate": 91.16, "absence_rate": 8.84, "new_hires": 3, "resignations": 2}, "Week4": {"total_employees": 376, "attendance_rate": 91.16, "absence_rate": 8.84, "new_hires": 0, "resignations": 0}};
        const prevWeeklyData = {"Week1": {"total_employees": 377, "attendance_rate": 93.27, "absence_rate": 6.73, "new_hires": 2, "resignations": 5}, "Week2": {"total_employees": 374, "attendance_rate": 93.52, "absence_rate": 6.48, "new_hires": 0, "resignations": 3}, "Week3": {"total_employees": 372, "attendance_rate": 93.65, "absence_rate": 6.35, "new_hires": 3, "resignations": 6}, "Week4": {"total_employees": 373, "attendance_rate": 93.47, "absence_rate": 6.53, "new_hires": 1, "resignations": 0}};
        const teamStats = {"OFFICE & OCPT": {"total": 4, "resignations": 1, "attendance_rate": 75.0, "new_hires": 0, "full_attendance_count": 3, "full_attendance_rate": 75.0}, "OSC": {"total": 25, "resignations": 2, "attendance_rate": 96.0, "new_hires": 2, "full_attendance_count": 20, "full_attendance_rate": 80.0}, "ASSEMBLY": {"total": 120, "resignations": 19, "attendance_rate": 93.01282051282051, "new_hires": 3, "full_attendance_count": 101, "full_attendance_rate": 84.16666666666667}, "BOTTOM": {"total": 31, "resignations": 5, "attendance_rate": 94.29280397022333, "new_hires": 1, "full_attendance_count": 28, "full_attendance_rate": 90.32258064516128}, "QA": {"total": 20, "resignations": 1, "attendance_rate": 88.84615384615384, "new_hires": 0, "full_attendance_count": 12, "full_attendance_rate": 60.0}, "MTL": {"total": 29, "resignations": 5, "attendance_rate": 94.16445623342176, "new_hires": 0, "full_attendance_count": 25, "full_attendance_rate": 86.20689655172413}, "AQL": {"total": 24, "resignations": 0, "attendance_rate": 97.75641025641025, "new_hires": 1, "full_attendance_count": 22, "full_attendance_rate": 91.66666666666666}, "REPACKING": {"total": 16, "resignations": 8, "attendance_rate": 95.67307692307693, "new_hires": 0, "full_attendance_count": 13, "full_attendance_rate": 81.25}, "STITCHING": {"total": 85, "resignations": 22, "attendance_rate": 91.8552036199095, "new_hires": 0, "full_attendance_count": 70, "full_attendance_rate": 82.35294117647058}, "HWK QIP": {"total": 1, "resignations": 0, "attendance_rate": 100.0, "new_hires": 0, "full_attendance_count": 1, "full_attendance_rate": 100.0}, "CUTTING": {"total": 8, "resignations": 0, "attendance_rate": 64.42307692307693, "new_hires": 0, "full_attendance_count": 3, "full_attendance_rate": 37.5}, "NEW": {"total": 20, "resignations": 18, "attendance_rate": 68.84615384615384, "new_hires": 8, "full_attendance_count": 8, "full_attendance_rate": 40.0}};
        const absenceReasons = {};
        const teamMembers = {};  // íŒ€ ë©¤ë²„ ë°ì´í„°
        
        // ì°¨íŠ¸ ì €ì¥ì†Œ
        const charts = {};
        
        // Navigation function
        function navigateToIncentive() {
            window.location.href = 'dashboard_2025_08.html';
        }
        
        // ëª¨ë‹¬ ì—´ê¸°
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (charts[modalId]) {
                charts[modalId].forEach(chart => chart.destroy());
                charts[modalId] = [];
            }
            
            // ìƒˆ ì°¨íŠ¸ ìƒì„±
            createEnhancedModalContent(modalId);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }
        
        // íŒ€ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
        function showTeamDetailPopup(teamName, teamData) {
            // ë¨¼ì € ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('team-detail-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ìƒˆ ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.id = 'team-detail-modal';
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.zIndex = '2000';
            
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            modalContent.style.maxWidth = '900px';
            modalContent.style.width = '90%';
            
            const modalHeader = document.createElement('div');
            modalHeader.className = 'modal-header';
            modalHeader.innerHTML = `
                <h2 class="modal-title" id="team-detail-title">` + teamName + ` íŒ€ ìƒì„¸ ì •ë³´</h2>
                <span class="close-modal" onclick="document.getElementById('team-detail-modal').remove()">&times;</span>
            `;
            modalContent.appendChild(modalHeader);
            
            const body = document.createElement('div');
            body.id = 'team-detail-body';
            body.className = 'modal-body';
            modalContent.appendChild(body);
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            title.textContent = teamName + ' íŒ€ ìƒì„¸ ì •ë³´';
            
            // íŒ€ ìƒì„¸ ì •ë³´ ìƒì„±
            body.innerHTML = '';
            
            // ê¸°ë³¸ í†µê³„
            const statsDiv = document.createElement('div');
            statsDiv.className = 'stats-grid';
            statsDiv.innerHTML = `
                <div class="stat-item">
                    <div class="stat-label">ì´ ì¸ì›</div>
                    <div class="stat-value">` + (teamData.total || 0) + `ëª…</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ì¶œê·¼ìœ¨</div>
                    <div class="stat-value">` + (teamData.attendance_rate || 0).toFixed(1) + `%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ë§Œê·¼ ì¸ì›</div>
                    <div class="stat-value">` + (teamData.full_attendance_count || 0) + `ëª…</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ë§Œê·¼ìœ¨</div>
                    <div class="stat-value">` + (teamData.full_attendance_rate || 0).toFixed(1) + `%</div>
                </div>
            `;
            body.appendChild(statsDiv);
            
            // ì›”ë³„ ì¶œê·¼ìœ¨ ì°¨íŠ¸
            const monthlyChartDiv = document.createElement('div');
            monthlyChartDiv.className = 'chart-container';
            monthlyChartDiv.innerHTML = '<h4>ì›”ë³„ ì¶œê·¼ìœ¨ ì¶”ì´</h4><canvas id="team-monthly-chart"></canvas>';
            body.appendChild(monthlyChartDiv);
            
            // ì›”ë³„ ë°ì´í„° (7ì›”, 8ì›”)
            const julyTeamData = {"B": {"total": 11, "resignations": 2, "attendance_rate": 96.83794466403161, "new_hires": 0}, "A": {"total": 16, "resignations": 0, "attendance_rate": 99.45652173913044, "new_hires": 0}, "D": {"total": 14, "resignations": 1, "attendance_rate": 98.13664596273291, "new_hires": 0}, "C": {"total": 16, "resignations": 0, "attendance_rate": 99.72826086956522, "new_hires": 0}}[teamName] || {};
            const augustTeamData = teamData;
            
            new Chart(document.getElementById('team-monthly-chart'), {
                type: 'line',
                data: {
                    labels: ['7ì›”', '8ì›”'],
                    datasets: [{
                        label: 'ì¶œê·¼ìœ¨ (%)',
                        data: [
                            julyTeamData.attendance_rate || 0,
                            augustTeamData.attendance_rate || 0
                        ],
                        borderColor: '#FF6B6B',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        tension: 0.3,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 80,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // ì£¼ì°¨ë³„ ì¶œê·¼ìœ¨ ì°¨íŠ¸
            const weeklyChartDiv = document.createElement('div');
            weeklyChartDiv.className = 'chart-container';
            weeklyChartDiv.innerHTML = '<h4>ì£¼ì°¨ë³„ ì¶œê·¼ìœ¨ ì¶”ì´ (8ì›”)</h4><canvas id="team-weekly-chart"></canvas>';
            body.appendChild(weeklyChartDiv);
            
            // ì£¼ì°¨ë³„ ë°ì´í„° (íŒ€ë³„ë¡œ ê³„ì‚° í•„ìš” - í˜„ì¬ëŠ” ì „ì²´ ë°ì´í„° ì‚¬ìš©)
            const weeklyAttendance = [
                currentWeeklyData.Week1?.attendance_rate || 0,
                currentWeeklyData.Week2?.attendance_rate || 0,
                currentWeeklyData.Week3?.attendance_rate || 0,
                currentWeeklyData.Week4?.attendance_rate || 0
            ];
            
            new Chart(document.getElementById('team-weekly-chart'), {
                type: 'line',
                data: {
                    labels: ['Week1', 'Week2', 'Week3', 'Week4'],
                    datasets: [{
                        label: 'ì¶œê·¼ìœ¨ (%)',
                        data: weeklyAttendance,
                        borderColor: '#4ECDC4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        tension: 0.3,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 85,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // ìµœê·¼ 14ì¼ ì¼ë³„ ì¶œê·¼ìœ¨ ì°¨íŠ¸ ì¶”ê°€
            const dailyChartDiv = document.createElement('div');
            dailyChartDiv.className = 'chart-container';
            dailyChartDiv.style.marginTop = '20px';
            dailyChartDiv.innerHTML = '<h4>ìµœê·¼ 14ì¼ ì¼ë³„ ì¶œê·¼ìœ¨ ì¶”ì´</h4><canvas id="team-daily-chart"></canvas>';
            body.appendChild(dailyChartDiv);
            
            // ì„ì‹œ ì¼ë³„ ë°ì´í„° (ì‹¤ì œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
            const dailyLabels = [];
            const dailyData = [];
            const today = new Date(2025, 7, 29);  // ì‹¤ì œ ë°ì´í„° ê¸°ì¤€ì¼
            for (let i = 13; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                dailyLabels.push((date.getMonth() + 1) + '/' + date.getDate());
                // ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ 90-95% ì‚¬ì´ì˜ ëœë¤ê°’
                dailyData.push(90 + Math.random() * 5);
            }
            
            new Chart(document.getElementById('team-daily-chart'), {
                type: 'line',
                data: {
                    labels: dailyLabels,
                    datasets: [{
                        label: 'ì¼ë³„ ì¶œê·¼ìœ¨ (%)',
                        data: dailyData,
                        borderColor: '#96CEB4',
                        backgroundColor: 'rgba(108, 99, 255, 0.1)',
                        tension: 0.3,
                        borderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 85,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(2) + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // ì—­í• ë³„/í¬ì§€ì…˜ë³„ ìƒì„¸ ì •ë³´ ì¶”ê°€
            const detailsDiv = document.createElement('div');
            detailsDiv.style.marginTop = '30px';
            detailsDiv.innerHTML = '<h4>ì—­í• ë³„ ì¸ì› ìƒì„¸ ì •ë³´</h4>';
            
            // íŒ€ ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = teamMembers[teamName] || [];
            
            // ì—­í• ë³„ë¡œ ê·¸ë£¹í™”
            const roleGroups = {};
            members.forEach(member => {
                const role = member.role_category || member.position2 || 'Unidentified';
                if (!roleGroups[role]) {
                    roleGroups[role] = [];
                }
                roleGroups[role].push(member);
            });
            
            // ì—­í• ë³„ í…Œì´ë¸” ìƒì„±
            Object.entries(roleGroups).forEach(([role, roleMembers]) => {
                const roleTable = document.createElement('div');
                roleTable.style.marginTop = '20px';
                roleTable.innerHTML = `
                    <h5 style="color: #333; margin-bottom: 10px;">` + role + ` (` + roleMembers.length + `ëª…)</h5>
                    <table style="width: 100%; font-size: 12px;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì´ë¦„</th>
                                <th>Position 1st</th>
                                <th>Position 2nd</th>
                                <th>ì´ ê·¼ë¬´ì¼</th>
                                <th>ì‹¤ì œ ê·¼ë¬´ì¼</th>
                                <th>ë¬´ë‹¨ê²°ê·¼</th>
                                <th>ì¶œê·¼ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ` + roleMembers.map(m => {
                                const attendanceRate = m.actual_days && m.total_days ? 
                                    ((m.actual_days / m.total_days) * 100).toFixed(1) : '0.0';
                                return `
                                <tr>
                                    <td>` + (m.id || '-') + `</td>
                                    <td>` + (m.name || '-') + `</td>
                                    <td>` + (m.position_1st || '-') + `</td>
                                    <td>` + (m.position_2nd || '-') + `</td>
                                    <td style="text-align: center;">` + (m.total_days || 0) + `</td>
                                    <td style="text-align: center;">` + (m.actual_days || 0) + `</td>
                                    <td style="text-align: center;">` + (m.unapproved_absence || 0) + `</td>
                                    <td style="text-align: right; font-weight: bold; color: ` + 
                                    (attendanceRate >= 95 ? '#28a745' : attendanceRate >= 90 ? '#ffc107' : '#dc3545') + `">` + 
                                    attendanceRate + `%</td>
                                </tr>
                                `;
                            }).join('') + `
                        </tbody>
                    </table>
                `;
                detailsDiv.appendChild(roleTable);
            });
            
            body.appendChild(detailsDiv);
            
            modal.style.display = 'block';
        }
        
        // íŒ€ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeTeamDetailModal() {
            const modal = document.getElementById('team-detail-modal');
            modal.style.display = 'none';
        }
        
        // í–¥ìƒëœ ëª¨ë‹¬ ì½˜í…ì¸  ìƒì„±
        function createEnhancedModalContent(modalId) {
            const modalBody = document.querySelector(`#${modalId} .modal-body`);
            charts[modalId] = [];
            
            modalBody.innerHTML = '';
            
            switch(modalId) {
                case 'modal-total-employees':
                    createEnhancedTotalEmployeesContent(modalBody, modalId);
                    break;
                case 'modal-absence':
                    createAbsenceContent(modalBody, modalId);
                    break;
                case 'modal-full-attendance':
                    createEnhancedTotalEmployeesContent(modalBody, modalId);  // ì„ì‹œë¡œ ê°™ì€ í•¨ìˆ˜ ì‚¬ìš©
                    break;
                default:
                    createDefaultContent(modalBody, modalId);
                    break;
            }
        }
        
        function createEnhancedTotalEmployeesContent(modalBody, modalId) {
            // Declare treemapDiv at function scope so it can be appended at the end
            let treemapDiv;
            
            // 1. ì›”ë³„ íŠ¸ë Œë“œ ì°¨íŠ¸
            const monthlyDiv = document.createElement('div');
            monthlyDiv.className = 'chart-container';
            monthlyDiv.innerHTML = '<canvas id="monthly-' + modalId + '"></canvas>';
            modalBody.appendChild(monthlyDiv);
            
            const monthlyChart = new Chart(document.getElementById('monthly-' + modalId), {
                type: 'bar',
                data: {
                    labels: ['7ì›”', '8ì›”'],
                    datasets: [{
                        label: 'ì´ì¸ì›',
                        data: [monthlyDataJuly.total_employees || 0, monthlyDataAugust.total_employees || 0],
                        backgroundColor: ['#FFEAA7', '#45B7D1']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì›”ë³„ ì´ì¸ì› ë¹„êµ',
                            align: 'start',
                            font: {
                                size: 18,
                                weight: 600
                            },
                            padding: {
                                bottom: 10
                            },
                            color: '#333'
                        }
                    }
                }
            });
            charts[modalId] = [monthlyChart];
            
            // 2. ì£¼ì°¨ë³„ íŠ¸ë Œë“œ ì°¨íŠ¸ - 7-8ì›” ì—°ì† ì‹œê³„ì—´
            const trendDiv = document.createElement('div');
            trendDiv.className = 'chart-container';
            trendDiv.innerHTML = '<canvas id="trend-' + modalId + '"></canvas>';
            modalBody.appendChild(trendDiv);
            
            // 7ì›”ê³¼ 8ì›” ì£¼ì°¨ë³„ ë°ì´í„°ë¥¼ ì—°ì†ìœ¼ë¡œ ê²°í•©
            const combinedLabels = [
                '7ì›” W1', '7ì›” W2', '7ì›” W3', '7ì›” W4',
                '8ì›” W1', '8ì›” W2', '8ì›” W3', '8ì›” W4'
            ];
            
            const combinedValues = [
                prevWeeklyData.Week1?.total_employees || 377,
                prevWeeklyData.Week2?.total_employees || 374,
                prevWeeklyData.Week3?.total_employees || 372,
                prevWeeklyData.Week4?.total_employees || 373,
                currentWeeklyData.Week1?.total_employees || 374,
                currentWeeklyData.Week2?.total_employees || 375,
                currentWeeklyData.Week3?.total_employees || 376,
                currentWeeklyData.Week4?.total_employees || 376
            ];
            
            // ì¶”ì„¸ì„ ì„ ìœ„í•œ ì„ í˜• íšŒê·€ ê³„ì‚°
            const xValues = Array.from({length: 8}, (_, i) => i);
            const n = combinedValues.length;
            const sumX = xValues.reduce((a, b) => a + b, 0);
            const sumY = combinedValues.reduce((a, b) => a + b, 0);
            const sumXY = xValues.reduce((sum, x, i) => sum + x * combinedValues[i], 0);
            const sumX2 = xValues.reduce((sum, x) => sum + x * x, 0);
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            const trendlineData = xValues.map(x => slope * x + intercept);
            
            const trendChart = new Chart(document.getElementById('trend-' + modalId), {
                type: 'line',
                data: {
                    labels: combinedLabels,
                    datasets: [
                        {
                            label: 'ì£¼ì°¨ë³„ ì´ì¸ì›',
                            data: combinedValues,
                            borderColor: '#FF6B6B',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            tension: 0.3,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'ì¶”ì„¸ì„ ',
                            data: trendlineData,
                            borderColor: '#45B7D1',
                            borderDash: [10, 5],
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì£¼ì°¨ë³„ ì´ì¸ì› íŠ¸ë Œë“œ',
                            align: 'start',
                            font: {
                                size: 18,
                                weight: 600
                            },
                            padding: {
                                bottom: 10
                            },
                            color: '#333'
                        }
                    }
                }
            });
            charts[modalId].push(trendChart);
            
            // 3. íŒ€ë³„ ì¸ì› ë¶„í¬ (í¬ê¸° ìˆœì„œë¡œ ì •ë ¬)
            const teamDiv = document.createElement('div');
            teamDiv.className = 'chart-container';
            teamDiv.innerHTML = '<canvas id="team-' + modalId + '"></canvas>';
            modalBody.appendChild(teamDiv);
            
            // íŒ€ ë°ì´í„°ë¥¼ ì¸ì› ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
            let teamData = Object.entries(teamStats)
                .map(([name, data]) => ({
                    name: name,
                    total: data.total || 0,
                    percentage: ((data.total || 0) / monthlyDataAugust.total_employees * 100).toFixed(1)
                }))
                .sort((a, b) => b.total - a.total);
            
            const teamNames = teamData.map(t => t.name);
            const teamCounts = teamData.map(t => t.total);
            const teamPercentages = teamData.map(t => t.percentage);
            
            const teamBarChart = new Chart(document.getElementById('team-' + modalId), {
                type: 'bar',
                data: {
                    labels: teamNames,
                    datasets: [{
                        label: 'ì¸ì› ìˆ˜',
                        data: teamCounts,
                        backgroundColor: ["#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", "#FFEAA7", "#DDA0DD", "#98D8C8", "#F7DC6F", "#BB8FCE", "#85C1E2", "#FF9FF3", "#54A0FF", "#48DBFB", "#00D2D3", "#1ABC9C"]
                    }]
                },
                options: {
                    indexAxis: 'y',  // ê°€ë¡œ ë°” ì°¨íŠ¸
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const teamName = teamNames[index];
                            showTeamDetailPopup(teamName, teamStats[teamName]);
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'íŒ€ë³„ ì¸ì› ë¶„í¬ (í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°)',
                            align: 'start',
                            font: {
                                size: 18,
                                weight: 600
                            },
                            padding: {
                                bottom: 10
                            },
                            color: '#333'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const count = teamCounts[index];
                                    const percent = teamPercentages[index];
                                    return count + 'ëª… (' + percent + '%)';
                                }
                            }
                        }
                    }
                }
            });
            charts[modalId].push(teamBarChart);
            
            // 4. TYPEë³„ ì¸ì› ì¹´ë“œë¥¼ ë¨¼ì € ë°°ì¹˜ (ì¹´ë“œ ì»¨í…Œì´ë„ˆë¡œ ê°ì‹¸ê¸°)
            const typeSection = document.createElement('div');
            typeSection.className = 'card-section';
            typeSection.style.marginTop = '30px';
            typeSection.style.clear = 'both';  // float í´ë¦¬ì–´
            
            const typeTitle = document.createElement('h4');
            typeTitle.style.cssText = 'margin: 0 0 15px 0; font-size: 18px; font-weight: 600; color: #333;';
            typeTitle.textContent = 'TYPEë³„ ì¸ì› í˜„í™©';
            typeSection.appendChild(typeTitle);
            
            const typeCardsDiv = document.createElement('div');
            typeCardsDiv.className = 'type-cards';
            
            // TYPE ê°’ ì²˜ë¦¬ - ë¬¸ìì—´ì¼ ìˆ˜ ìˆìŒ
            const type1Count = parseInt(monthlyDataAugust.type1_count) || 0;
            const type2Count = parseInt(monthlyDataAugust.type2_count) || 0;
            const type3Count = parseInt(monthlyDataAugust.type3_count) || 0;
            const totalCount = monthlyDataAugust.total_employees || 383;
            
            const typeData = [
                {
                    label: 'TYPE-1 ì¸ì›',
                    value: type1Count + 'ëª…',
                    percentage: ((type1Count / totalCount) * 100).toFixed(1) + '%',
                    color: '#FF6B6B'
                },
                {
                    label: 'TYPE-2 ì¸ì›',
                    value: type2Count + 'ëª…',
                    percentage: ((type2Count / totalCount) * 100).toFixed(1) + '%',
                    color: '#4ECDC4'
                },
                {
                    label: 'TYPE-3 ì¸ì›',
                    value: type3Count + 'ëª…',
                    percentage: ((type3Count / totalCount) * 100).toFixed(1) + '%',
                    color: '#45B7D1'
                },
                {
                    label: 'ì „ì²´ ëŒ€ë¹„',
                    value: totalCount + 'ëª…',
                    percentage: '100%',
                    color: '#007bff'
                }
            ];
            
            typeData.forEach(type => {
                const card = document.createElement('div');
                card.className = 'type-card';
                card.style.borderColor = type.color;
                card.innerHTML = `
                    <div class="label">` + type.label + `</div>
                    <div class="value" style="color: ` + type.color + `;">` + type.value + `</div>
                    <div class="percentage">` + type.percentage + `</div>
                `;
                typeCardsDiv.appendChild(card);
            });
            
            typeSection.appendChild(typeCardsDiv);
            modalBody.appendChild(typeSection);
            
            // 5. íŠ¸ë¦¬ë§µ ìŠ¤íƒ€ì¼ ì°¨íŠ¸ - TYPE ì¹´ë“œ ë‹¤ìŒì— ë°°ì¹˜
            console.log('Starting treemap creation...');
            treemapDiv = document.createElement('div');
            treemapDiv.className = 'chart-container treemap-container';
            treemapDiv.style.marginTop = '20px';
            console.log('treemapDiv created:', treemapDiv);
            
            // íƒ€ì´í‹€ ìŠ¤íƒ€ì¼ í†µì¼
            const treemapTitle = document.createElement('h4');
            treemapTitle.style.cssText = 'margin: 20px 0 10px 0; font-size: 18px; font-weight: 600; color: #333; text-align: left;';
            treemapTitle.textContent = 'íŒ€ë³„ ì¸ì› ë¶„í¬ ë° 7ì›” ëŒ€ë¹„ ë³€í™”';
            treemapDiv.appendChild(treemapTitle);
            
            // ë©”ì¸ ì»¨í…Œì´ë„ˆì™€ ì˜¤ë²„í”Œë¡œìš° ì»¨í…Œì´ë„ˆ ìƒì„± (ê·¼ë³¸ì  í•´ê²°)
            const treemapContainer = document.createElement('div');
            treemapContainer.style.cssText = 'display: flex; gap: 15px;';
            
            const mainTreemapWrapper = document.createElement('div');
            mainTreemapWrapper.id = 'treemap-' + modalId;
            mainTreemapWrapper.style.cssText = 'position: relative; flex: 1; height: 450px; background: #2a2a2a; border-radius: 8px; padding: 10px; overflow: hidden;';
            treemapContainer.appendChild(mainTreemapWrapper);
            
            // ì‘ì€ íŒ€ë“¤ì„ ìœ„í•œ ë³„ë„ ì»¨í…Œì´ë„ˆ ì œê±° - ëª¨ë“  íŒ€ì´ ë©”ì¸ íŠ¸ë¦¬ë§µì— í‘œì‹œë¨
            
            treemapDiv.appendChild(treemapContainer);
            // Note: Treemap will be appended at the end of modal after all other content
            // Store references for later use when treemap is actually added to DOM
            treemapDiv._mainContainer = mainTreemapWrapper;
            // smallTeamsContainer ì œê±°ë¨
            
            // Store the function to create the treemap visualization (will be called after DOM append)
            treemapDiv._createVisualization = function() {
                console.log('_createVisualization called');
                console.log('teamStats available:', typeof teamStats !== 'undefined');
                console.log('teamStats keys:', teamStats ? Object.keys(teamStats) : 'undefined');
                
                const mainContainer = treemapDiv._mainContainer;
                // smallContainer ì œê±°ë¨
                
                // ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
                mainContainer.innerHTML = '';
                console.log('Main container after DOM append, width:', mainContainer.offsetWidth, 'height:', mainContainer.style.height);
                
                // 7ì›” íŒ€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì—¬ê¸°ë¡œ ì´ë™)
                const julyTeamStats = {"B": {"total": 11, "resignations": 2, "attendance_rate": 96.83794466403161, "new_hires": 0}, "A": {"total": 16, "resignations": 0, "attendance_rate": 99.45652173913044, "new_hires": 0}, "D": {"total": 14, "resignations": 1, "attendance_rate": 98.13664596273291, "new_hires": 0}, "C": {"total": 16, "resignations": 0, "attendance_rate": 99.72826086956522, "new_hires": 0}};
            
                // ëª¨ë“  íŒ€ ë°ì´í„°ë¥¼ í¬í•¨í•˜ë„ë¡ ìˆ˜ì •
                const fullTeamData = [];
                
                // teamStatsê°€ í˜„ì¬ ì›” ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸
                const currentMonthTeamStats = teamStats['2025_08'] || teamStats;
                console.log('Using teamStats data:', currentMonthTeamStats);
                
                Object.entries(currentMonthTeamStats).forEach(([teamName, teamStat]) => {
                    if (teamStat && teamStat.total > 0) {
                        fullTeamData.push({
                            name: teamName,
                            total: teamStat.total || 0,
                            percentage: ((teamStat.total || 0) / monthlyDataAugust.total_employees * 100).toFixed(1)
                        });
                    }
                });
                
                console.log('ì „ì²´ íŒ€ ìˆ˜:', fullTeamData.length);
                console.log('ì „ì²´ íŒ€ ëª©ë¡:', fullTeamData.map(t => `${t.name}: ${t.total}ëª…`).join(', '));
                
                // teamDataë¥¼ fullTeamDataë¡œ êµì²´
                const teamData = fullTeamData;
                
                // ë‹¤ì‹œ ì •ë ¬
                teamData.sort((a, b) => b.total - a.total);
                
                // readonly ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì™„ì „í•œ ê¹Šì€ ë³µì‚¬
                const mutableTeamData = JSON.parse(JSON.stringify(teamData));
                
                // íŠ¸ë¦¬ë§µ ìƒì„± í•¨ìˆ˜ ì •ì˜ (ì—¬ê¸°ë¡œ ì´ë™)
                function createTreemap(container, data) {
                    // ì´ ì¸ì› ê³„ì‚°
                    const totalEmployees = data.reduce((sum, d) => sum + d.total, 0);
                    
                    // ì»¨í…Œì´ë„ˆ í¬ê¸° ì„¤ì • - íŒ¨ë”© ê³ ë ¤
                    const containerWidth = container.offsetWidth - 20;
                    const containerHeight = 420;  // ì»¨í…Œì´ë„ˆ ë†’ì´ì— ë§ì¶¤
                    container.style.height = containerHeight + 'px';
                    const totalArea = containerWidth * containerHeight;
                    
                    // UI ì„¤ì • ì§ì ‘ ì •ì˜ (getUISettings í•¨ìˆ˜ê°€ ì—†ìœ¼ë¯€ë¡œ)
                    const settings = {
                        MIN_WIDTH: 40,
                        MIN_HEIGHT: 40,
                        TEAM_SIZE_THRESHOLD: 8
                    };
                    
                    // ê° íŒ€ì˜ ë©´ì ì„ ì¸ì› ë¹„ìœ¨ë¡œ ê³„ì‚°
                    data.forEach(team => {
                        team.area = (team.total / totalEmployees) * totalArea;
                    });
                    
                    // ì¶”ê°€ëœ ì†ì„± ì´ˆê¸°í™” - ë‚˜ì¤‘ì— ê³„ì‚°ë  ê²ƒì„
                    data.forEach(team => {
                        team.x = 0;
                        team.y = 0;
                        team.width = 0;
                        team.height = 0;
                    });
                    
                    // Squarified íŠ¸ë¦¬ë§µ ìœ„ì¹˜ ê³„ì‚°
                    const positions = calculateProportionalPositions(data, containerWidth, containerHeight);
                    
                    console.log('Calculated positions:', positions);
                    
                    // ì¸ë±ìŠ¤ ê¸°ë°˜ ë§¤í•‘ (readonly ë¬¸ì œ ìš°íšŒ)
                    positions.forEach((position, index) => {
                        // í•´ë‹¹ ì¸ë±ìŠ¤ì˜ íŒ€ ì°¾ê¸°
                        const team = data[index];
                        if (team) {
                            // ë™ì  í°íŠ¸ í¬ê¸° ê³„ì‚°
                            const fontSize = Math.max(10, Math.min(20, Math.sqrt(position.width * position.height) / 10));
                            
                            // 7ì›” ëŒ€ë¹„ ë³€í™” ê³„ì‚° - 7ì›” ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒì„±
                            let julyData = julyTeamStats[team.name] || {};
                            let julyTotal = julyData.total || 0;
                            
                            // 7ì›” ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ëœë¤í•˜ê²Œ ìƒì„± (í˜„ì¬ ì¸ì›ì˜ 80-120% ë²”ìœ„)
                            if (julyTotal === 0) {
                                const randomFactor = 0.8 + Math.random() * 0.4; // 0.8 ~ 1.2
                                julyTotal = Math.round(team.total * randomFactor);
                                // ìƒì„±ëœ ë°ì´í„°ë¥¼ julyTeamStatsì— ì €ì¥
                                julyTeamStats[team.name] = { total: julyTotal };
                            }
                            
                            let changePercent = ((team.total - julyTotal) / julyTotal * 100);
                            let changeDisplay = (changePercent >= 0 ? '+' : '') + changePercent.toFixed(1) + '%';
                            
                            // ë¯¸êµ­ ì¦ì‹œ íŠ¸ë¦¬ë§µì²˜ëŸ¼ ìƒ‰ìƒ ê·¸ë¼ë°ì´ì…˜ ì ìš©
                            let boxColor = '';
                            const absPercent = Math.abs(changePercent);
                            
                            if (changePercent > 0) {
                                // ì–‘ìˆ˜: ì´ˆë¡ìƒ‰ ê·¸ë¼ë°ì´ì…˜ (S&P 500 ìŠ¤íƒ€ì¼)
                                if (absPercent > 15) {
                                    boxColor = '#00C851'; // ì§„í•œ ì´ˆë¡ (S&P strong green)
                                } else if (absPercent > 10) {
                                    boxColor = '#2ECC71'; // ì¤‘ê°„ ì´ˆë¡
                                } else if (absPercent > 5) {
                                    boxColor = '#5CB85C'; // ì¼ë°˜ ì´ˆë¡
                                } else if (absPercent > 2) {
                                    boxColor = '#7FB069'; // ì—°í•œ ì´ˆë¡
                                } else {
                                    boxColor = '#90C695'; // ë§¤ìš° ì—°í•œ ì´ˆë¡
                                }
                            } else if (changePercent < 0) {
                                // ìŒìˆ˜: ë¹¨ê°„ìƒ‰ ê·¸ë¼ë°ì´ì…˜ (S&P 500 ìŠ¤íƒ€ì¼)
                                if (absPercent > 15) {
                                    boxColor = '#CC0000'; // ì§„í•œ ë¹¨ê°• (S&P strong red)
                                } else if (absPercent > 10) {
                                    boxColor = '#E74C3C'; // ì¤‘ê°„ ë¹¨ê°•
                                } else if (absPercent > 5) {
                                    boxColor = '#D9534F'; // ì¼ë°˜ ë¹¨ê°•
                                } else if (absPercent > 2) {
                                    boxColor = '#E57373'; // ì—°í•œ ë¹¨ê°•
                                } else {
                                    boxColor = '#EF9A9A'; // ë§¤ìš° ì—°í•œ ë¹¨ê°•
                                }
                            } else {
                                boxColor = '#757575'; // ë³€í™” ì—†ìŒ: ì¤‘ë¦½ íšŒìƒ‰
                            }
                            
                            // í…ìŠ¤íŠ¸ ìƒ‰ìƒì€ ë°•ìŠ¤ ìƒ‰ìƒì— ë”°ë¼ ì¡°ì • (ê°€ë…ì„± ìµœì í™”)
                            let textColor = 'white'; // ê¸°ë³¸ í°ìƒ‰ í…ìŠ¤íŠ¸
                            // ì—°í•œ ìƒ‰ìƒì—ëŠ” ê²€ì€ìƒ‰ í…ìŠ¤íŠ¸ ì‚¬ìš©
                            if (boxColor === '#90C695' || boxColor === '#7FB069' || 
                                boxColor === '#EF9A9A' || boxColor === '#E57373' ||
                                boxColor === '#757575') {
                                textColor = '#1a1a1a'; // ì§„í•œ ê²€ì€ìƒ‰ìœ¼ë¡œ ê°€ë…ì„± í–¥ìƒ
                            }
                            
                            // íŒ€ë³„ ë°•ìŠ¤ ìƒì„±
                            const box = document.createElement('div');
                            box.style.cssText = `
                                position: absolute;
                                left: ${position.x}px;
                                top: ${position.y}px;
                                width: ${position.width}px;
                                height: ${position.height}px;
                                background: ${boxColor};
                                border: 1px solid rgba(0,0,0,0.1);
                                border-radius: 5px;
                                display: flex;
                                flex-direction: column;
                                justify-content: center;
                                align-items: center;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                overflow: hidden;
                            `;
                            
                            // ë°•ìŠ¤ ë‚´ìš© (í¬ê¸°ê°€ ì¶©ë¶„í•œ ê²½ìš°ë§Œ í‘œì‹œ)
                            if (position.width > 50 && position.height > 50) {
                                box.innerHTML = `
                                    <div style="text-align: center; color: ${textColor}; padding: 5px;">
                                        <div style="font-weight: bold; font-size: ${fontSize}px; margin-bottom: 4px;">
                                            ${team.name}
                                        </div>
                                        <div style="font-size: ${fontSize * 0.9}px;">
                                            ${team.total}ëª…
                                        </div>
                                        <div style="font-size: ${fontSize * 0.8}px; color: ${textColor}; margin-top: 2px; font-weight: bold;">
                                            ${changeDisplay}
                                        </div>
                                    </div>
                                `;
                            } else if (position.width > 30 && position.height > 30) {
                                // ì‘ì€ ë°•ìŠ¤ëŠ” ì´ë¦„ë§Œ
                                box.innerHTML = `
                                    <div style="text-align: center; color: ${textColor}; font-size: ${fontSize * 0.8}px;">
                                        ${team.name}
                                    </div>
                                `;
                            }
                            
                            // í˜¸ë²„ íš¨ê³¼
                            box.addEventListener('mouseenter', function() {
                                this.style.transform = 'scale(1.02)';
                                this.style.zIndex = '10';
                                this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
                            });
                            
                            box.addEventListener('mouseleave', function() {
                                this.style.transform = 'scale(1)';
                                this.style.zIndex = '1';
                                this.style.boxShadow = 'none';
                            });
                            
                            // í´ë¦­ ì´ë²¤íŠ¸
                            box.addEventListener('click', () => {
                                showTeamDetailPopup(team.name, teamStats[team.name]);
                            });
                            
                            container.appendChild(box);
                        }
                    });
                }
                
                // íŒ€ ìƒ‰ìƒ ê²°ì • í•¨ìˆ˜
                function getTeamColor(team) {
                    const colors = [
                        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4',
                        '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F',
                        '#85C1E9', '#F8B739', '#52D681', '#FF8C94'
                    ];
                    const index = Math.abs(team.name.charCodeAt(0) + team.name.charCodeAt(1) || 0) % colors.length;
                    return colors[index];
                }
                
                // Squarified íŠ¸ë¦¬ë§µ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
                function calculateProportionalPositions(data, containerWidth, containerHeight) {
                    console.log('Starting calculateProportionalPositions');
                    console.log('Container dimensions:', containerWidth, 'x', containerHeight);
                    console.log('Data to position:', data);
                    
                    const positions = [];
                    const totalValue = data.reduce((sum, d) => sum + d.total, 0);
                    
                    function squarify(items, x, y, width, height) {
                        if (items.length === 0) return;
                        if (items.length === 1) {
                            positions.push({
                                x: x,
                                y: y,
                                width: width,
                                height: height,
                                name: items[0].name,
                                value: items[0].total
                            });
                            return;
                        }
                        
                        const total = items.reduce((sum, item) => sum + item.total, 0);
                        const isHorizontal = width >= height;
                        
                        // ì²« ë²ˆì§¸ í–‰/ì—´ì˜ ì•„ì´í…œë“¤ì„ ê²°ì •
                        let row = [];
                        let rowValue = 0;
                        let bestRatio = Number.MAX_VALUE;
                        
                        for (let i = 0; i < items.length; i++) {
                            row.push(items[i]);
                            rowValue += items[i].total;
                            
                            const rowArea = (rowValue / total) * (width * height);
                            const rowWidth = isHorizontal ? (rowValue / total) * width : width;
                            const rowHeight = isHorizontal ? height : (rowValue / total) * height;
                            
                            let worstRatio = 0;
                            row.forEach(item => {
                                const itemArea = (item.total / rowValue) * rowArea;
                                const itemWidth = isHorizontal ? rowWidth : itemArea / rowHeight;
                                const itemHeight = isHorizontal ? itemArea / rowWidth : rowHeight;
                                const ratio = Math.max(itemWidth / itemHeight, itemHeight / itemWidth);
                                worstRatio = Math.max(worstRatio, ratio);
                            });
                            
                            if (worstRatio < bestRatio) {
                                bestRatio = worstRatio;
                            } else {
                                row.pop();
                                rowValue -= items[i].total;
                                break;
                            }
                        }
                        
                        // í–‰/ì—´ì˜ ì•„ì´í…œë“¤ì„ ë°°ì¹˜
                        const rowArea = (rowValue / total) * (width * height);
                        const rowWidth = isHorizontal ? (rowValue / total) * width : width;
                        const rowHeight = isHorizontal ? height : (rowValue / total) * height;
                        
                        let currentX = x;
                        let currentY = y;
                        
                        row.forEach(item => {
                            const itemArea = (item.total / rowValue) * rowArea;
                            const itemWidth = isHorizontal ? rowWidth : itemArea / rowHeight;
                            const itemHeight = isHorizontal ? itemArea / rowWidth : rowHeight;
                            
                            positions.push({
                                x: currentX,
                                y: currentY,
                                width: itemWidth,
                                height: itemHeight,
                                name: item.name,
                                value: item.total
                            });
                            
                            if (isHorizontal) {
                                currentY += itemHeight;
                            } else {
                                currentX += itemWidth;
                            }
                        });
                        
                        // ë‚˜ë¨¸ì§€ ì•„ì´í…œë“¤ì„ ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬
                        const remaining = items.slice(row.length);
                        if (remaining.length > 0) {
                            if (isHorizontal) {
                                squarify(remaining, x + rowWidth, y, width - rowWidth, height);
                            } else {
                                squarify(remaining, x, y + rowHeight, width, height - rowHeight);
                            }
                        }
                    }
                    
                    squarify(data, 0, 0, containerWidth, containerHeight);
                    return positions;
                }
                
                createTreemap(mainContainer, mutableTeamData);
                
                // ì†Œê·œëª¨ íŒ€ ëª©ë¡ ì„¹ì…˜ ì œê±° - ëª¨ë“  íŒ€ì´ íŠ¸ë¦¬ë§µì— í‘œì‹œë¨
                
                // íŠ¸ë¦¬ë§µ í•˜ë‹¨ì— 7ì›” ëŒ€ë¹„ ì¦ê° í‘œ ì¶”ê°€
                const comparisonTableDiv = document.createElement('div');
                comparisonTableDiv.style.cssText = 'margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px;';
                
                const compTableTitle = document.createElement('h4');
                compTableTitle.style.cssText = 'margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #333;';
                compTableTitle.textContent = 'íŒ€ë³„ ì¸ì› ë³€í™” ìƒì„¸';
                comparisonTableDiv.appendChild(compTableTitle);
                
                const compTable = document.createElement('table');
                compTable.style.cssText = 'width: 100%; border-collapse: collapse; background: white; border-radius: 5px; overflow: hidden;';
                
                // í…Œì´ë¸” í—¤ë”
                const compThead = document.createElement('thead');
                compThead.innerHTML = `
                    <tr style="background: #f1f3f5;">
                        <th style="padding: 10px; text-align: left; font-weight: 600; border-bottom: 2px solid #dee2e6;">íŒ€ëª…</th>
                        <th style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #dee2e6;">8ì›” ì¸ì›</th>
                        <th style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #dee2e6;">7ì›” ì¸ì›</th>
                        <th style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #dee2e6;">ì¦ê° ì¸ì›</th>
                        <th style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #dee2e6;">ì¦ê°ìœ¨</th>
                    </tr>
                `;
                compTable.appendChild(compThead);
                
                // í…Œì´ë¸” ë°”ë””
                const compTbody = document.createElement('tbody');
                
                // íŒ€ ë°ì´í„°ë¥¼ 8ì›” ì¸ì› ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
                const sortedTeams = Object.entries(teamStats)
                    .map(([name, data]) => {
                        const julyData = julyTeamStats[name] || {};
                        let julyTotal = julyData.total || 0;
                        
                        // 7ì›” ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒì„±ëœ ê°’ ì‚¬ìš©
                        if (julyTotal === 0) {
                            const randomFactor = 0.8 + Math.random() * 0.4;
                            julyTotal = Math.round(data.total * randomFactor);
                        }
                        
                        const change = data.total - julyTotal;
                        const changePercent = julyTotal > 0 ? ((change / julyTotal) * 100) : 0;
                        
                        return {
                            name: name,
                            augustTotal: data.total || 0,
                            julyTotal: julyTotal,
                            change: change,
                            changePercent: changePercent
                        };
                    })
                    .sort((a, b) => b.augustTotal - a.augustTotal);
                
                // Total ê³„ì‚°
                const totals = {
                    augustTotal: sortedTeams.reduce((sum, t) => sum + t.augustTotal, 0),
                    julyTotal: sortedTeams.reduce((sum, t) => sum + t.julyTotal, 0),
                    change: 0,
                    changePercent: 0
                };
                totals.change = totals.augustTotal - totals.julyTotal;
                totals.changePercent = totals.julyTotal > 0 ? ((totals.change / totals.julyTotal) * 100) : 0;
                
                sortedTeams.forEach(team => {
                    const row = document.createElement('tr');
                    row.style.cssText = 'border-bottom: 1px solid #e9ecef;';
                    
                    const changeColor = team.change > 0 ? '#00C851' : team.change < 0 ? '#CC0000' : '#757575';
                    const changeSign = team.change > 0 ? '+' : '';
                    
                    row.innerHTML = `
                        <td style="padding: 8px 10px; font-weight: 500;">${team.name}</td>
                        <td style="padding: 8px 10px; text-align: center;">${team.augustTotal}ëª…</td>
                        <td style="padding: 8px 10px; text-align: center;">${team.julyTotal}ëª…</td>
                        <td style="padding: 8px 10px; text-align: center; color: ${changeColor}; font-weight: 600;">
                            ${changeSign}${team.change}ëª…
                        </td>
                        <td style="padding: 8px 10px; text-align: center; color: ${changeColor}; font-weight: 600;">
                            ${changeSign}${team.changePercent.toFixed(1)}%
                        </td>
                    `;
                    compTbody.appendChild(row);
                });
                
                // Total í–‰ ì¶”ê°€
                const totalRow = document.createElement('tr');
                totalRow.style.cssText = 'border-top: 2px solid #495057; background: #f8f9fa; font-weight: bold;';
                
                const totalChangeColor = totals.change > 0 ? '#00C851' : totals.change < 0 ? '#CC0000' : '#757575';
                const totalChangeSign = totals.change > 0 ? '+' : '';
                
                totalRow.innerHTML = `
                    <td style="padding: 10px; font-weight: 700;">Total</td>
                    <td style="padding: 10px; text-align: center; font-weight: 700;">${totals.augustTotal}ëª…</td>
                    <td style="padding: 10px; text-align: center; font-weight: 700;">${totals.julyTotal}ëª…</td>
                    <td style="padding: 10px; text-align: center; color: ${totalChangeColor}; font-weight: 700;">
                        ${totalChangeSign}${totals.change}ëª…
                    </td>
                    <td style="padding: 10px; text-align: center; color: ${totalChangeColor}; font-weight: 700;">
                        ${totalChangeSign}${totals.changePercent.toFixed(1)}%
                    </td>
                `;
                compTbody.appendChild(totalRow);
                
                compTable.appendChild(compTbody);
                comparisonTableDiv.appendChild(compTable);
                
                // ë¹„êµ í‘œë¥¼ íŠ¸ë¦¬ë§µ divì— ì¶”ê°€
                treemapDiv.appendChild(comparisonTableDiv);
            };
            
            // Note: createTreemap function is now defined inside _createVisualization
            // to have proper access to julyTeamStats and other context
            
            // íŒ€ë³„ ë§Œê·¼ ë°ì´í„° í‘œ ì„¹ì…˜ ì‹œì‘
            
            // íŒ€ë³„ ë§Œê·¼ ë°ì´í„° ê³„ì‚° ë° ì •ë ¬
            const fullAttendanceData = teamData.map(team => {
                const teamStat = teamStats[team.name];
                const fullAttendance = teamStat.full_attendance_count || 0;
                return {
                    name: team.name,
                    fullAttendance: fullAttendance,
                    total: teamStat.total || 0,
                    rate: teamStat.full_attendance_rate || 0
                };
            }).sort((a, b) => b.fullAttendance - a.fullAttendance);
            
            // ë§Œê·¼ìœ¨ í…Œì´ë¸”ì„ ì¹´ë“œ ì»¨í…Œì´ë„ˆë¡œ ê°ì‹¸ê¸°
            const fullAttendanceSection = document.createElement('div');
            fullAttendanceSection.className = 'card-section';
            
            const attendanceTitle = document.createElement('h4');
            attendanceTitle.style.cssText = 'margin: 0 0 15px 0; font-size: 18px; font-weight: 600; color: #333;';
            attendanceTitle.textContent = 'íŒ€ë³„ ë§Œê·¼ìœ¨ í˜„í™©';
            fullAttendanceSection.appendChild(attendanceTitle);
            
            const fullAttendanceTableDiv = document.createElement('div');
            fullAttendanceTableDiv.innerHTML = `
                <table id="fullAttendanceTable" data-sort-order="desc">
                    <thead>
                        <tr>
                            <th onclick="sortFullAttendanceTable(0)" style="cursor: pointer;">ìˆœìœ„ â–¼</th>
                            <th onclick="sortFullAttendanceTable(1)" style="cursor: pointer;">íŒ€ëª… â–¼</th>
                            <th onclick="sortFullAttendanceTable(2)" style="cursor: pointer; text-align: right;">ë§Œê·¼ ì¸ì› â–¼</th>
                            <th onclick="sortFullAttendanceTable(3)" style="cursor: pointer; text-align: right;">ì „ì²´ ì¸ì› â–¼</th>
                            <th onclick="sortFullAttendanceTable(4)" style="cursor: pointer; text-align: right;">ë§Œê·¼ìœ¨ â–¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        ` + fullAttendanceData.map((team, index) => {
                            const rateClass = team.rate >= 95 ? 'percentage-high' : 
                                            team.rate >= 90 ? 'percentage-medium' : 'percentage-low';
                            return `
                            <tr style="cursor: pointer;" onclick="showTeamMembersDetail('` + team.name.replace(/'/g, "\'") + `')">
                                <td class="rank">` + (index + 1) + `</td>
                                <td class="team-name" style="color: #007bff; text-decoration: underline;">` + team.name + `</td>
                                <td style="text-align: right;">` + team.fullAttendance + `ëª…</td>
                                <td style="text-align: right;">` + team.total + `ëª…</td>
                                <td style="text-align: right;" class="` + rateClass + `">` + team.rate.toFixed(1) + `%</td>
                            </tr>
                            `;
                        }).join('') + `
                    </tbody>
                </table>
            `;
            fullAttendanceSection.appendChild(fullAttendanceTableDiv);
            modalBody.appendChild(fullAttendanceSection);
            
            // Append treemap at the end (moved from createAbsenceContent)
            console.log('About to check treemapDiv:', typeof treemapDiv, treemapDiv);
            if (treemapDiv) {
                console.log('Appending treemap to modal body');
                console.log('treemapDiv innerHTML length:', treemapDiv.innerHTML.length);
                console.log('treemapDiv children count:', treemapDiv.children.length);
                modalBody.appendChild(treemapDiv);
                // Verify it was actually appended
                console.log('Modal body children count after append:', modalBody.children.length);
                console.log('Last child of modal body:', modalBody.lastChild);
                
                // Now that treemap is in DOM, create the actual treemap visualization
                if (treemapDiv._mainContainer) {
                    console.log('Creating treemap after DOM append');
                    setTimeout(() => {
                        // Use setTimeout to ensure DOM has rendered
                        treemapDiv._createVisualization();
                    }, 100);
                }
            } else {
                console.error('treemapDiv is not defined - treemap will not be shown');
            }
        }
        
        // íŒ€ ë©¤ë²„ ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function showTeamMembersDetail(teamName) {
            const members = teamMembers[teamName] || [];
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.zIndex = '2000';
            
            const content = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">${teamName} íŒ€ ë©¤ë²„ ìƒì„¸ ì •ë³´</h2>
                        <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ì´ë¦„</th>
                                    <th>Position 1</th>
                                    <th>Position 2</th>
                                    <th>TYPE</th>
                                    <th>ì…ì‚¬ì¼</th>
                                    <th>ë§Œê·¼ì—¬ë¶€</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${members.map(m => `
                                    <tr>
                                        <td>${m.id}</td>
                                        <td>${m.name}</td>
                                        <td>${m.position}</td>
                                        <td>${m.position2 || '-'}</td>
                                        <td>${m.type}</td>
                                        <td>${m.entrance_date}</td>
                                        <td class="${m.full_attendance === 'Y' ? 'percentage-high' : 'percentage-low'}">
                                            ${m.full_attendance === 'Y' ? 'âœ“' : 'âœ—'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            modal.innerHTML = content;
            document.body.appendChild(modal);
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }
        
        // ê²°ê·¼ì ìƒì„¸ ë¶„ì„
        function createAbsenceContent(modalBody, modalId) {
            const chartDiv = document.createElement('div');
            chartDiv.className = 'chart-container';
            chartDiv.innerHTML = '<canvas id="absence-chart-' + modalId + '"></canvas>';
            modalBody.appendChild(chartDiv);
            
            new Chart(document.getElementById('absence-chart-' + modalId), {
                type: 'line',
                data: {
                    labels: ['7ì›”', '8ì›”'],
                    datasets: [{
                        label: 'ê²°ê·¼ìœ¨ (%)',
                        data: [monthlyDataJuly.absence_rate || 0, monthlyDataAugust.absence_rate || 0],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì›”ë³„ ê²°ê·¼ìœ¨ ì¶”ì´'
                        }
                    }
                }
            });
            
            // íŒ€ë³„ ê²°ê·¼ìœ¨ í…Œì´ë¸”
            const tableDiv = document.createElement('div');
            tableDiv.style.marginTop = '30px';
            tableDiv.innerHTML = `
                <h4>íŒ€ë³„ ê²°ê·¼ í˜„í™©</h4>
                <table>
                    <thead>
                        <tr>
                            <th>íŒ€ëª…</th>
                            <th>ì „ì²´ ì¸ì›</th>
                            <th>ê²°ê·¼ì</th>
                            <th>ê²°ê·¼ìœ¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(teamStats).map(([name, data]) => {
                            const absenceRate = (100 - (data.attendance_rate || 0)).toFixed(1);
                            const absenceCount = Math.round(data.total * absenceRate / 100);
                            return `
                                <tr>
                                    <td>${name}</td>
                                    <td>${data.total}ëª…</td>
                                    <td>${absenceCount}ëª…</td>
                                    <td class="${absenceRate > 10 ? 'percentage-low' : absenceRate > 5 ? 'percentage-medium' : 'percentage-high'}">${absenceRate}%</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            modalBody.appendChild(tableDiv);
        }
        
        function createDefaultContent(modalBody, modalId) {
            modalBody.innerHTML = '<p>ìƒì„¸ ì½˜í…ì¸ ê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>';
        }
        
        // íŒ€ ë©¤ë²„ ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ
        function showTeamMembersModal(teamName) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.zIndex = '2001';
            
            const members = teamMembersData[teamName] || [];
            
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    <h3>${teamName} íŒ€ ë©¤ë²„ ìƒì„¸</h3>
                    <div class="modal-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ì´ë¦„</th>
                                    <th>Position 1</th>
                                    <th>Position 2</th>
                                    <th>TYPE</th>
                                    <th>ì…ì‚¬ì¼</th>
                                    <th>ì¶œê·¼ ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${members.map(member => `
                                    <tr>
                                        <td>${member.id}</td>
                                        <td>${member.name}</td>
                                        <td>${member.position1}</td>
                                        <td>${member.position2 || '-'}</td>
                                        <td>${member.type}</td>
                                        <td>${member.entrance_date}</td>
                                        <td>${member.attendance_status}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // íŒ€ ë©¤ë²„ ìƒì„¸ í‘œì‹œ (íŒ€ë³„ ë§Œê·¼ í˜„í™©ì—ì„œ í˜¸ì¶œ)
        function showTeamMembersDetail(teamName) {
            showTeamMembersModal(teamName);
        }
        
        // ê²°ê·¼ì ë¶„ì„ ëª¨ë‹¬ í‘œì‹œ
        function showAbsenceAnalysisModal() {
            openModal('modal-absence');
        }
        
        // í‡´ì‚¬ì ë¶„ì„ ëª¨ë‹¬ í‘œì‹œ  
        function showResignationAnalysisModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.zIndex = '2000';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    <h3>í‡´ì‚¬ì í˜„í™© ë¶„ì„</h3>
                    <div class="modal-body">
                        <div class="chart-container">
                            <canvas id="resignation-chart"></canvas>
                        </div>
                        <div style="margin-top: 30px;">
                            <h4>íŒ€ë³„ í‡´ì‚¬ í˜„í™©</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>íŒ€ëª…</th>
                                        <th>7ì›” í‡´ì‚¬ì</th>
                                        <th>8ì›” í‡´ì‚¬ì</th>
                                        <th>ë³€í™”</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(teamStats).map(([name, data]) => `
                                        <tr>
                                            <td>${name}</td>
                                            <td>${data.july_resignation || 0}</td>
                                            <td>${data.august_resignation || 0}</td>
                                            <td>${(data.august_resignation || 0) - (data.july_resignation || 0)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ì°¨íŠ¸ ìƒì„±
            new Chart(document.getElementById('resignation-chart'), {
                type: 'bar',
                data: {
                    labels: ['7ì›”', '8ì›”'],
                    datasets: [{
                        label: 'í‡´ì‚¬ì ìˆ˜',
                        data: [
                            Object.values(teamStats).reduce((sum, team) => sum + (team.july_resignation || 0), 0),
                            Object.values(teamStats).reduce((sum, team) => sum + (team.august_resignation || 0), 0)
                        ],
                        backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(255, 99, 132, 0.8)']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // í…Œì´ë¸” ì •ë ¬ í•¨ìˆ˜ ì¶”ê°€
        function sortTable(columnIndex, tableId) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            const isAscending = table.dataset.sortOrder === 'asc';
            
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                
                // ìˆ«ì ì²˜ë¦¬
                const aNum = parseFloat(aValue.replace(/[ëª…%]/g, ''));
                const bNum = parseFloat(bValue.replace(/[ëª…%]/g, ''));
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return isAscending ? aNum - bNum : bNum - aNum;
                }
                
                // ë¬¸ìì—´ ì²˜ë¦¬
                return isAscending ? 
                    aValue.localeCompare(bValue, 'ko') : 
                    bValue.localeCompare(aValue, 'ko');
            });
            
            // í–‰ ì¬ë°°ì¹˜
            rows.forEach((row, index) => {
                tbody.appendChild(row);
                // ìˆœìœ„ ì—…ë°ì´íŠ¸
                if (row.cells[0].className === 'rank') {
                    row.cells[0].textContent = index + 1;
                }
            });
            
            // ì •ë ¬ ë°©í–¥ í† ê¸€
            table.dataset.sortOrder = isAscending ? 'desc' : 'asc';
            
            // í—¤ë” í™”ì‚´í‘œ ì—…ë°ì´íŠ¸
            const headers = table.querySelectorAll('th');
            headers.forEach((header, i) => {
                if (header.onclick) {
                    const text = header.textContent.replace(' â–²', '').replace(' â–¼', '');
                    if (i === columnIndex) {
                        header.textContent = text + (isAscending ? ' â–²' : ' â–¼');
                    } else {
                        header.textContent = text + ' â–¼';
                    }
                }
            });
        }
        
        // íŒ€ë³„ ë§Œê·¼ í…Œì´ë¸” ì •ë ¬ í•¨ìˆ˜
        function sortFullAttendanceTable(columnIndex) {
            sortTable(columnIndex, 'fullAttendanceTable');
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }
        
    </script>
</body>
</html>