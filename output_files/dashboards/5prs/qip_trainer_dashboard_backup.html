<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QIP Trainer Dashboard - í’ˆì§ˆ ê²€ì‚¬ íŠ¸ë ˆì´ë„ˆ ëŒ€ì‹œë³´ë“œ">
    <title>QIP Trainer Dashboard v2.0</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* CSS Reset & Variables */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2563eb;
            --primary-light: #60a5fa;
            --primary-dark: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        body {
            background: #f5f5f5;
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }
        
        /* Dashboard Header - ì›ë³¸ UI ìŠ¤íƒ€ì¼ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Enhanced Title Section */
        .header-title-container {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .title-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .title-main {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .title-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-gradient);
            border-radius: 0.5rem;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin: 0;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }
        
        .title-badge {
            font-size: 0.75rem;
            font-weight: 600;
            background: var(--success-color);
            color: white;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            vertical-align: super;
            margin-left: 0.5rem;
        }
        
        .title-subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
        }
        
        .title-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sync-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 0.375rem;
        }
        
        .sync-dot {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            animation: blink 2s ease-in-out infinite;
        }
        
        /* Enhanced Language Selector */
        .language-selector-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .language-selector {
            display: flex;
            gap: 0;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            padding: 0.25rem;
            border-radius: 0.625rem;
            position: relative;
        }
        
        .lang-btn {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .lang-btn:hover {
            color: var(--gray-800);
        }
        
        .lang-btn.active {
            background: white;
            color: var(--primary-color);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        
        .lang-flag {
            font-size: 1.25rem;
        }
        
        /* Container */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Period Selector - ì›ë³¸ UI ìŠ¤íƒ€ì¼ */
        .period-control-panel {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .period-selector-wrapper {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .period-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .period-selector {
            display: flex;
            gap: 0.375rem;
            background: var(--gray-100);
            padding: 0.375rem;
            border-radius: 0.625rem;
        }
        
        .period-btn {
            padding: 0.625rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .period-btn:hover {
            background: rgba(255, 255, 255, 0.7);
            color: var(--gray-900);
        }
        
        .period-btn.active {
            background: white;
            color: var(--primary-color);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .date-range-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
        }
        
        .date-range-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bfdbfe;
            border-radius: 0.625rem;
            position: relative;
        }
        
        .date-range-display.data-limited {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-color: #fbbf24;
        }
        
        .date-range-display.no-data {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #f87171;
        }
        
        .range-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .data-status-badge {
            position: absolute;
            top: -8px;
            right: 10px;
            background: var(--warning-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* Enhanced KPI Cards */
        .kpi-section {
            margin-bottom: 2rem;
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .kpi-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .kpi-cards-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.25rem;
        }
        
        .kpi-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            min-height: 180px;
            padding: 1.25rem;
        }
        
        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        .kpi-card[data-priority="critical"] {
            border-left: 4px solid var(--danger-color);
        }
        
        .kpi-card[data-priority="warning"] {
            border-left: 4px solid var(--warning-color);
        }
        
        .kpi-icon-wrapper {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-gradient);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .kpi-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .kpi-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .kpi-change.positive {
            color: var(--success-color);
        }
        
        .kpi-change.negative {
            color: var(--danger-color);
        }
        
        .kpi-progress {
            margin-top: 0.75rem;
        }
        
        .progress-bar {
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 3px;
            transition: width 1s ease;
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Tabs */
        .tabs {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .tab-list {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .tab-button {
            flex: 1;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .tab-button:hover {
            background-color: var(--gray-50);
            color: var(--gray-900);
        }
        
        .tab-button.active {
            color: var(--primary-color);
            background-color: rgba(96, 165, 250, 0.1);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
        }
        
        .tab-panel {
            display: none;
            padding: 2rem;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            margin-bottom: 1.5rem;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .card-subtitle {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        /* Filter Section */
        .filter-section {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filter-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }
        
        .filter-select {
            padding: 0.375rem 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            background-color: white;
            font-size: 0.875rem;
            cursor: pointer;
            min-width: 200px;
        }
        
        /* Grid layouts */
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        
        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: var(--gray-50);
            padding: 0.75rem;
            text-align: left;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
        }
        
        td {
            padding: 0.75rem;
            font-size: 0.875rem;
            border-bottom: 1px solid var(--gray-100);
        }
        
        tr:hover {
            background-color: var(--gray-50);
        }
        
        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-normal {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-400);
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: #000;
        }
        
        /* Modal data content styles */
        .modal-data-content {
            padding: 1rem 0;
        }
        
        .modal-data-content h4 {
            color: #1f2937;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .modal-data-content .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f9fafb;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        
        .modal-data-content .stat-item:hover {
            background: #f3f4f6;
        }
        
        .modal-data-content .stat-label {
            color: #6b7280;
            font-weight: 500;
        }
        
        .modal-data-content .stat-value {
            color: #1f2937;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .modal-data-content hr {
            margin: 1.5rem 0;
            border: none;
            border-top: 1px solid #e5e7eb;
        }
        
        /* 8.x Mobile Responsive Optimization */
        @media (max-width: 1400px) {
            .kpi-cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 1024px) {
            .kpi-cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid.grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .control-group {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            /* Mobile header adjustments */
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.875rem;
            }
            
            /* Filter section mobile */
            .filter-section {
                overflow-x: auto;
            }
            
            /* Table responsive */
            table {
                font-size: 0.875rem;
            }
            
            th, td {
                padding: 0.5rem;
            }
            
            /* Card adjustments */
            .card {
                padding: 1rem;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            /* Button adjustments */
            button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            /* Report buttons responsive */
            div[onclick*="reportGenerator"] {
                display: block;
                margin: 0.5rem 0;
            }
        }
        
        @media (max-width: 640px) {
            .kpi-cards-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-list {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .tab-button {
                flex: 1 1 calc(50% - 0.25rem);
                min-width: 0;
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            
            /* Period buttons mobile */
            .period-buttons {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .period-btn {
                flex: 1 1 calc(50% - 0.25rem);
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            
            /* Language selector mobile */
            .language-selector {
                width: 100%;
            }
            
            /* KPI card mobile optimization */
            .kpi-card {
                padding: 1rem;
            }
            
            .kpi-card-value {
                font-size: 1.5rem;
            }
            
            .kpi-card-label {
                font-size: 0.75rem;
            }
            
            /* Summary items mobile */
            .incentive-summary {
                display: block;
            }
            
            .summary-item {
                margin-bottom: 1rem;
                padding: 1rem;
                background: #f9fafb;
                border-radius: 0.5rem;
            }
            
            /* Modal mobile */
            .modal-content {
                width: 95%;
                margin: 5% auto;
                max-height: 90vh;
                overflow-y: auto;
            }
        }
        
        @media (max-width: 480px) {
            /* Extra small devices */
            body {
                padding: 0.5rem;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.25rem;
            }
            
            /* Single column for all tabs on mobile */
            .tab-button {
                flex: 1 1 100%;
            }
            
            /* Horizontal scroll for tables */
            .table-container, 
            #performanceScoresTable,
            #topPerformersTable {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                min-width: 500px;
            }
            
            /* Chart height adjustment for mobile */
            canvas {
                max-height: 300px !important;
            }
            
            /* Metric cards mobile */
            .metric-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .metric-value {
                font-size: 1.25rem;
            }
        }
        
        /* Touch optimization */
        @media (hover: none) and (pointer: coarse) {
            /* Increase touch targets */
            button, .tab-button, .period-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Disable hover effects on touch devices */
            button:hover, .tab-button:hover, .period-btn:hover {
                transform: none;
            }
            
            /* Add active states for touch feedback */
            button:active, .tab-button:active, .period-btn:active {
                opacity: 0.8;
                transform: scale(0.98);
            }
        }
        
        /* Print styles */
        @media print {
            .header-controls, 
            .filter-section, 
            .tab-list, 
            button {
                display: none !important;
            }
            
            .tab-panel {
                display: block !important;
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-title-container">
                <div class="title-group">
                    <div class="title-main">
                        <div class="title-icon">
                            <span style="color: white; font-size: 1.5rem;">ğŸ­</span>
                        </div>
                        <h1 class="dashboard-title">
                            QIP Trainer Dashboard
                            <span class="title-badge">v2.0</span>
                        </h1>
                    </div>
                    <div class="title-subtitle">
                        <span data-i18n="subtitle">í’ˆì§ˆ ê²€ì‚¬ íŠ¸ë ˆì´ë„ˆ ì„±ê³¼ ë¶„ì„ ì‹œìŠ¤í…œ</span>
                    </div>
                </div>
                <div class="title-status">
                    <div class="sync-indicator">
                        <span class="sync-dot"></span>
                        <span class="sync-text" data-i18n="realtime">ì‹¤ì‹œê°„</span>
                    </div>
                </div>
            </div>
            <div class="language-selector-container">
                <!-- File Upload (Hidden) -->
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                
                <!-- Data Load Button -->
                <button id="loadDataBtn" class="action-btn" style="padding: 0.5rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“‚</span>
                    <span data-i18n="loadData">ë°ì´í„° ë¡œë“œ</span>
                </button>
                
                <!-- Export Buttons -->
                <button onclick="exportData('csv')" class="action-btn" style="padding: 0.5rem 1rem; background: #10b981; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“¥</span>
                    <span>Export CSV</span>
                </button>
                <button onclick="exportData('json')" class="action-btn" style="padding: 0.5rem 1rem; background: #8b5cf6; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“Š</span>
                    <span>Export JSON</span>
                </button>
                
                <div class="language-selector">
                    <button class="lang-btn active" data-lang="ko">
                        <span class="lang-flag">ğŸ‡°ğŸ‡·</span>
                        <span class="lang-text">í•œêµ­ì–´</span>
                    </button>
                    <button class="lang-btn" data-lang="en">
                        <span class="lang-flag">ğŸ‡ºğŸ‡¸</span>
                        <span class="lang-text">English</span>
                    </button>
                    <button class="lang-btn" data-lang="vi">
                        <span class="lang-flag">ğŸ‡»ğŸ‡³</span>
                        <span class="lang-text">Tiáº¿ng Viá»‡t</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Feature Announcement Banner -->
        <div id="featureBanner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
            <div>
                <h3 style="margin: 0; font-size: 1.2rem; font-weight: 600;">ğŸš€ QIP Trainer Dashboard v3.0 - ê³ ê¸‰ ê¸°ëŠ¥</h3>
                <p style="margin: 0.5rem 0 0 0; opacity: 0.95; font-size: 0.95rem;">
                    âœ¨ <strong>ë‹¤ì¤‘ ì›” í†µí•©</strong>: 7-9ì›” ë°ì´í„° ìë™ ë³‘í•© | 
                    ğŸ“¥ <strong>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</strong>: CSV/JSON ë‹¤ìš´ë¡œë“œ | 
                    ğŸ”„ <strong>ì‹¤ì‹œê°„ ë™ê¸°í™”</strong>: 1ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨ | 
                    ğŸ“Š <strong>116,140ê°œ</strong> ê²€ì¦ ë°ì´í„° ë¶„ì„ |
                    ğŸ¯ <strong>AI ì˜ˆì¸¡</strong>: í’ˆì§ˆ íŠ¸ë Œë“œ ì˜ˆì¸¡
                </p>
            </div>
            <button onclick="this.parentElement.style.display='none'" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0.25rem 0.75rem; border-radius: 0.5rem; cursor: pointer; font-size: 1.2rem; transition: background 0.2s;">âœ•</button>
        </div>
        
        <!-- Alerts and Predictions Section -->
        <div id="alertsContainer" style="margin-bottom: 1.5rem;">
            <!-- Alerts will be dynamically inserted here -->
        </div>
        
        <!-- Enhanced Period Selector -->
        <div class="period-control-panel">
            <div class="period-selector-wrapper">
                <div class="period-label">
                    <span>ğŸ“…</span>
                    <span data-i18n="periodSelect">ê¸°ê°„ ì„ íƒ</span>
                </div>
                <div class="period-selector">
                    <button class="period-btn" data-period="today">
                        <span data-i18n="today">ì˜¤ëŠ˜</span>
                    </button>
                    <button class="period-btn" data-period="week">
                        <span data-i18n="week">ìµœê·¼ 1ì£¼</span>
                    </button>
                    <button class="period-btn active" data-period="month">
                        <span data-i18n="month">ìµœê·¼ 1ë‹¬</span>
                    </button>
                    <button class="period-btn" data-period="quarter">
                        <span data-i18n="quarter">ìµœê·¼ 3ë‹¬</span>
                    </button>
                    <button class="period-btn" data-period="custom">
                        <span data-i18n="custom">ì§ì ‘ ì„ íƒ</span>
                    </button>
                </div>
            </div>
            <div class="date-range-info">
                <div class="date-range-display">
                    <span>ğŸ“†</span>
                    <div class="range-text">
                        <span class="range-from">2025.08.01</span>
                        <span>â†’</span>
                        <span class="range-to">2025.08.31</span>
                    </div>
                    <span class="range-duration">(31ì¼)</span>
                </div>
            </div>
        </div>
        
        <!-- Enhanced KPI Cards -->
        <div class="kpi-section">
            <div class="kpi-header">
                <h2 class="kpi-title" data-i18n="kpiTitle">í•µì‹¬ ì„±ê³¼ ì§€í‘œ</h2>
            </div>
            <div class="kpi-cards-grid">
                <!-- KPI Card 1: Total Validations -->
                <div class="kpi-card" data-kpi="totalValidation" onclick="showStatDetail('totalValidation')">
                    <div class="kpi-icon-wrapper">
                        <span style="color: white; font-size: 1.5rem;">âœ“</span>
                    </div>
                    <div class="kpi-label" data-i18n="totalValidation">ì´ ê²€ì¦ ê±´ìˆ˜</div>
                    <div class="kpi-value">4,234</div>
                    <div class="kpi-change positive">
                        <span>â†‘</span>
                        <span>+12% vs ì „ì›”</span>
                    </div>
                    <div class="kpi-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 85%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- KPI Card 2: Reject Rate -->
                <div class="kpi-card" data-kpi="totalRejectRate" data-priority="critical" onclick="showStatDetail('totalRejectRate')">
                    <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                        <span style="color: white; font-size: 1.5rem;">âš </span>
                    </div>
                    <div class="kpi-label" data-i18n="totalRejectRate">ì „ì²´ ë¶ˆëŸ‰ë¥ </div>
                    <div class="kpi-value">3.0%</div>
                    <div class="kpi-change negative">
                        <span>â†‘</span>
                        <span>+0.5% vs ì „ì›”</span>
                    </div>
                </div>
                
                <!-- KPI Card 3: High Risk TQC -->
                <div class="kpi-card" data-kpi="highRiskTQC" data-priority="warning" onclick="showStatDetail('highRiskTQC')">
                    <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <span style="color: white; font-size: 1.5rem;">!</span>
                    </div>
                    <div class="kpi-label" data-i18n="highRiskTQC">ê³ ìœ„í—˜ TQC</div>
                    <div class="kpi-value">12ëª…</div>
                    <div class="kpi-change negative">
                        <span data-i18n="trainingNeeded">ì¬êµìœ¡ í•„ìš”</span>
                    </div>
                </div>
                
                <!-- KPI Card 4: Active Auditors -->
                <div class="kpi-card" data-kpi="activeAuditors" onclick="showStatDetail('activeAuditors')">
                    <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <span style="color: white; font-size: 1.5rem;">ğŸ‘¥</span>
                    </div>
                    <div class="kpi-label" data-i18n="activeAuditors">í™œì„± ê°ì‚¬ì›</div>
                    <div class="kpi-value">103</div>
                    <div class="kpi-change positive">
                        <span data-i18n="allActive">ì „ì› í™œë™ì¤‘</span>
                    </div>
                </div>
                
                <!-- KPI Card 5: Average Validation Qty -->
                <div class="kpi-card" data-kpi="avgValidationQty" onclick="showStatDetail('avgValidationQty')">
                    <div class="kpi-icon-wrapper">
                        <span style="color: white; font-size: 1.5rem;">ğŸ“Š</span>
                    </div>
                    <div class="kpi-label" data-i18n="avgValidationQty">í‰ê·  ê²€ì¦ ìˆ˜ëŸ‰</div>
                    <div class="kpi-value">41</div>
                    <div class="kpi-change positive">
                        <span data-i18n="targetAchieved">ëª©í‘œ ë‹¬ì„±</span>
                    </div>
                    <div class="kpi-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 102%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-group">
                <label class="filter-label" data-i18n="trainingPriority">êµìœ¡ ìš°ì„ ìˆœìœ„ í•„í„°:</label>
                <select id="trainingDefectFilter" class="filter-select">
                    <option value="all" data-i18n="allDefects">ì „ì²´ ë¶ˆëŸ‰ ìœ í˜•</option>
                    <option value="stitch">Stitch Skip - ë°”ëŠ˜ë•€ ë¶ˆëŸ‰</option>
                    <option value="thread">Thread Issue - ì‹¤ ê´€ë ¨ ë¶ˆëŸ‰</option>
                    <option value="seam">Seam Quality - ì†”ê¸° í’ˆì§ˆ ë¶ˆëŸ‰</option>
                    <option value="measurement">Measurement - ì¹˜ìˆ˜ ë¶ˆëŸ‰</option>
                </select>
            </div>
        </div>
        
        <!-- Report Generation Buttons (7.x) -->
        <div style="text-align: right; margin: 1rem 0;">
            <button onclick="reportGenerator.downloadReport('weekly')" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                ğŸ“„ <span data-i18n="downloadReport">ì£¼ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ</span>
            </button>
            <button onclick="reportGenerator.downloadReport('monthly')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-left: 0.5rem;">
                ğŸ“Š <span data-i18n="downloadMonthlyReport">ì›”ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ</span>
            </button>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab-list">
                <button class="tab-button active" data-tab="overview">
                    <span data-i18n="tabOverview">ì „ì²´ í˜„í™©</span>
                </button>
                <button class="tab-button" data-tab="tqc">
                    <span data-i18n="tabTQC">TQC ë¶„ì„</span>
                </button>
                <button class="tab-button" data-tab="defects">
                    <span data-i18n="tabDefects">ë¶ˆëŸ‰ ë¶„ì„</span>
                </button>
                <button class="tab-button" data-tab="risk">
                    <span data-i18n="tabRisk">ìœ„í—˜ë„ ë¶„ì„</span>
                </button>
                <button class="tab-button" data-tab="actions">
                    <span data-i18n="tabActions">ì—…ë¬´ ì§€ì‹œ</span>
                </button>
                <button class="tab-button" data-tab="sustainability">
                    <span data-i18n="tabSustainability">ì§€ì†ì„±</span>
                </button>
                <button class="tab-button" data-tab="incentive">
                    <span data-i18n="tabIncentive">ì¸ì„¼í‹°ë¸Œ</span>
                </button>
            </div>
            
            <!-- Overview Panel -->
            <div id="overview-panel" class="tab-panel active">
                <div class="filter-section" style="margin-bottom: 1.5rem;">
                    <div class="filter-group">
                        <label class="filter-label" data-i18n="areaFilter">êµ¬ì—­:</label>
                        <select class="filter-select" id="overviewBuildingFilter">
                            <option value="all" data-i18n="all">ì „ì²´</option>
                            <option value="ASSEMBLY A">ASSEMBLY A</option>
                            <option value="ASSEMBLY B">ASSEMBLY B</option>
                            <option value="ASSEMBLY C">ASSEMBLY C</option>
                            <option value="ASSEMBLY D">ASSEMBLY D</option>
                            <option value="REPACKING">REPACKING</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-2">
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="dailyTrend">ì¼ë³„ ë¶ˆëŸ‰ë¥  ì¶”ì´</h3>
                                <p class="card-subtitle" data-i18n="dailyTrendSub">ìµœê·¼ 30ì¼ê°„ ë¶ˆëŸ‰ë¥  ë³€í™”</p>
                            </div>
                            <canvas id="dailyTrendChart"></canvas>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="defectTypes">ë¶ˆëŸ‰ ìœ í˜• ë¶„í¬</h3>
                                <p class="card-subtitle" data-i18n="defectTypesSub">ì „ì²´ ë¶ˆëŸ‰ì˜ ìœ í˜•ë³„ ë¹„ìœ¨</p>
                            </div>
                            <canvas id="defectTypeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="buildingQuality">êµ¬ì—­ë³„ í’ˆì§ˆ í˜„í™©</h3>
                            <p class="card-subtitle" data-i18n="buildingQualitySub">Buildingë³„ ë¶ˆëŸ‰ë¥  ë¹„êµ</p>
                        </div>
                        <canvas id="buildingChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- TQC Panel -->
            <div id="tqc-panel" class="tab-panel">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" data-i18n="tqcEvaluation">ê²€ì‚¬ì›ë³„ ê²€ì‚¬ ëŠ¥ë ¥ í‰ê°€</h3>
                        <p class="card-subtitle" data-i18n="tqcEvaluationSub">ì „ì²´ ê²€ì‚¬ì›(TQC) í‰ê°€ í˜„í™©</p>
                    </div>
                    <div class="table-container">
                        <table id="tqcTable">
                            <thead>
                                <tr>
                                    <th data-i18n="rank">ìˆœìœ„</th>
                                    <th>TQC ID</th>
                                    <th data-i18n="name">ì´ë¦„</th>
                                    <th data-i18n="area">êµ¬ì—­</th>
                                    <th data-i18n="validationQty">ê²€ì¦ìˆ˜ëŸ‰</th>
                                    <th data-i18n="rejectRate">ë¶ˆëŸ‰ë¥ </th>
                                    <th data-i18n="mainDefect">ì£¼ìš” ë¶ˆëŸ‰</th>
                                    <th data-i18n="status">ìƒíƒœ</th>
                                    <th data-i18n="score">ì„±ê³¼ì ìˆ˜</th>
                                </tr>
                            </thead>
                            <tbody id="tqcTableBody">
                                <!-- Data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Defects Analysis Panel -->
            <div id="defects-panel" class="tab-panel">
                <div class="grid grid-cols-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="defectByType">ë¶ˆëŸ‰ ìœ í˜•ë³„ ë¶„ì„</h3>
                            <p class="card-subtitle" data-i18n="defectByTypeSub">ì£¼ìš” ë¶ˆëŸ‰ ìœ í˜• Top 10</p>
                        </div>
                        <canvas id="defectByTypeChart"></canvas>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="defectTrend">ë¶ˆëŸ‰ ì¶”ì´ ë¶„ì„</h3>
                            <p class="card-subtitle" data-i18n="defectTrendSub">ì‹œê°„ëŒ€ë³„ ë¶ˆëŸ‰ ë°œìƒ ì¶”ì´</p>
                        </div>
                        <canvas id="defectTrendChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" data-i18n="defectByArea">êµ¬ì—­ë³„ ë¶ˆëŸ‰ ë¶„í¬</h3>
                        <p class="card-subtitle" data-i18n="defectByAreaSub">Buildingë³„ ë¶ˆëŸ‰ ìœ í˜• ë¶„í¬</p>
                    </div>
                    <canvas id="defectByAreaChart"></canvas>
                </div>
            </div>
            
            <div id="risk-panel" class="tab-panel">
                <!-- 4.4 ìœ„í—˜ë„ ë¶„ì„ íƒ­ -->
                <div class="grid grid-cols-2">
                    <!-- ê³ ìœ„í—˜ TQC ëª©ë¡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="highRiskTQCs">ê³ ìœ„í—˜ TQC ë¶„ì„</h3>
                            <p class="card-subtitle" data-i18n="highRiskTQCsSub">ë¶ˆëŸ‰ë¥  5% ì´ìƒ ê²€ì‚¬ì›</p>
                        </div>
                        <div class="card-body">
                            <div id="highRiskTQCList" class="risk-list">
                                <!-- Dynamic content will be added here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìœ„í—˜ë„ ë§¤íŠ¸ë¦­ìŠ¤ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="riskMatrix">ìœ„í—˜ë„ ë§¤íŠ¸ë¦­ìŠ¤</h3>
                            <p class="card-subtitle" data-i18n="riskMatrixSub">ë¶ˆëŸ‰ë¥  vs ê²€ì‚¬ëŸ‰ ë¶„ì„</p>
                        </div>
                        <div class="card-body">
                            <canvas id="riskMatrixChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- ìœ„í—˜ ìš”ì¸ ë¶„ì„ -->
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">
                        <h3 class="card-title" data-i18n="riskFactors">ìœ„í—˜ ìš”ì¸ ë¶„ì„</h3>
                        <p class="card-subtitle" data-i18n="riskFactorsSub">ì£¼ìš” ìœ„í—˜ ìš”ì¸ ë° íŠ¸ë Œë“œ</p>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-3">
                            <div class="risk-factor-card">
                                <div class="risk-factor-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                    <span style="color: white;">âš ï¸</span>
                                </div>
                                <div class="risk-factor-content">
                                    <div class="risk-factor-label" data-i18n="criticalDefects">ì‹¬ê° ë¶ˆëŸ‰</div>
                                    <div class="risk-factor-value" id="criticalDefectsCount">0</div>
                                    <div class="risk-factor-trend negative">â†‘ ì¦ê°€ ì¶”ì„¸</div>
                                </div>
                            </div>
                            <div class="risk-factor-card">
                                <div class="risk-factor-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                    <span style="color: white;">ğŸ“Š</span>
                                </div>
                                <div class="risk-factor-content">
                                    <div class="risk-factor-label" data-i18n="repeatDefects">ë°˜ë³µ ë¶ˆëŸ‰</div>
                                    <div class="risk-factor-value" id="repeatDefectsCount">0</div>
                                    <div class="risk-factor-trend">â†’ ìœ ì§€</div>
                                </div>
                            </div>
                            <div class="risk-factor-card">
                                <div class="risk-factor-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                    <span style="color: white;">ğŸ¯</span>
                                </div>
                                <div class="risk-factor-content">
                                    <div class="risk-factor-label" data-i18n="trainingNeeded">êµìœ¡ í•„ìš”</div>
                                    <div class="risk-factor-value" id="trainingNeededCount">0</div>
                                    <div class="risk-factor-trend positive">â†“ ê°ì†Œ ì¶”ì„¸</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="actions-panel" class="tab-panel">
                <!-- 4.5 ì—…ë¬´ì§€ì‹œ íƒ­ -->
                <div class="grid grid-cols-2">
                    <!-- ì•¡ì…˜ ì•„ì´í…œ ëª©ë¡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="actionItems">ì•¡ì…˜ ì•„ì´í…œ</h3>
                            <p class="card-subtitle" data-i18n="actionItemsSub">ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš” ì‚¬í•­</p>
                        </div>
                        <div class="card-body">
                            <div id="actionItemsList" class="action-items-list">
                                <!-- Dynamic action items will be added here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê°œì„  ìš°ì„ ìˆœìœ„ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="improvementPriority">ê°œì„  ìš°ì„ ìˆœìœ„</h3>
                            <p class="card-subtitle" data-i18n="improvementPrioritySub">ì˜í–¥ë„ ê¸°ì¤€ ìš°ì„ ìˆœìœ„</p>
                        </div>
                        <div class="card-body">
                            <canvas id="priorityChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- êµìœ¡ ê³„íš -->
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">
                        <h3 class="card-title" data-i18n="trainingPlan">êµìœ¡ ê³„íš</h3>
                        <p class="card-subtitle" data-i18n="trainingPlanSub">TQC ì—­ëŸ‰ ê°•í™” í”„ë¡œê·¸ë¨</p>
                    </div>
                    <div class="card-body">
                        <div class="training-schedule">
                            <div class="training-item">
                                <div class="training-priority high">ê¸´ê¸‰</div>
                                <div class="training-content">
                                    <div class="training-title" data-i18n="criticalTraining">ì‹¬ê° ë¶ˆëŸ‰ ì˜ˆë°© êµìœ¡</div>
                                    <div class="training-targets" id="criticalTrainingTargets">ëŒ€ìƒ: 0ëª…</div>
                                    <div class="training-date">ì˜ˆì •ì¼: 2025.09.15</div>
                                </div>
                            </div>
                            <div class="training-item">
                                <div class="training-priority medium">ì¼ë°˜</div>
                                <div class="training-content">
                                    <div class="training-title" data-i18n="regularTraining">ì •ê¸° í’ˆì§ˆ êµìœ¡</div>
                                    <div class="training-targets" id="regularTrainingTargets">ëŒ€ìƒ: 0ëª…</div>
                                    <div class="training-date">ì˜ˆì •ì¼: 2025.09.30</div>
                                </div>
                            </div>
                            <div class="training-item">
                                <div class="training-priority low">ì„ íƒ</div>
                                <div class="training-content">
                                    <div class="training-title" data-i18n="advancedTraining">ê³ ê¸‰ ê²€ì‚¬ ê¸°ë²•</div>
                                    <div class="training-targets" id="advancedTrainingTargets">ëŒ€ìƒ: 0ëª…</div>
                                    <div class="training-date">ì˜ˆì •ì¼: 2025.10.15</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="sustainability-panel" class="tab-panel">
                <!-- 4.6 ì§€ì†ì„± íƒ­ -->
                <div class="grid grid-cols-2">
                    <!-- ì¥ê¸° ì¶”ì„¸ ë¶„ì„ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="longTermTrend">ì¥ê¸° ì¶”ì„¸ ë¶„ì„</h3>
                            <p class="card-subtitle" data-i18n="longTermTrendSub">ì›”ë³„ í’ˆì§ˆ ê°œì„  ì¶”ì´</p>
                        </div>
                        <div class="card-body">
                            <canvas id="longTermTrendChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- ì„±ê³¼ ì§€ì†ì„± ì§€í‘œ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="sustainabilityMetrics">ì§€ì†ì„± ì§€í‘œ</h3>
                            <p class="card-subtitle" data-i18n="sustainabilityMetricsSub">í’ˆì§ˆ ê°œì„  ì§€ì†ì„± í‰ê°€</p>
                        </div>
                        <div class="card-body">
                            <div class="sustainability-metrics">
                                <div class="metric-item">
                                    <div class="metric-label" data-i18n="consistencyScore">ì¼ê´€ì„± ì ìˆ˜</div>
                                    <div class="metric-value">
                                        <span id="consistencyScore">85</span>
                                        <span class="metric-unit">%</span>
                                    </div>
                                    <div class="metric-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 85%; background: #10b981;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label" data-i18n="improvementRate">ê°œì„ ìœ¨</div>
                                    <div class="metric-value">
                                        <span id="improvementRate">12</span>
                                        <span class="metric-unit">%</span>
                                    </div>
                                    <div class="metric-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 60%; background: #3b82f6;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label" data-i18n="retentionRate">ìœ ì§€ìœ¨</div>
                                    <div class="metric-value">
                                        <span id="retentionRate">92</span>
                                        <span class="metric-unit">%</span>
                                    </div>
                                    <div class="metric-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 92%; background: #8b5cf6;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ì˜ˆì¸¡ ë¶„ì„ -->
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">
                        <h3 class="card-title" data-i18n="predictiveAnalysis">ì˜ˆì¸¡ ë¶„ì„</h3>
                        <p class="card-subtitle" data-i18n="predictiveAnalysisSub">í–¥í›„ 3ê°œì›” í’ˆì§ˆ ì˜ˆì¸¡</p>
                    </div>
                    <div class="card-body">
                        <div class="prediction-summary">
                            <div class="prediction-card">
                                <div class="prediction-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                    <span style="color: white;">ğŸ“ˆ</span>
                                </div>
                                <div class="prediction-content">
                                    <div class="prediction-label" data-i18n="expectedPassRate">ì˜ˆìƒ í•©ê²©ë¥ </div>
                                    <div class="prediction-value">98.5%</div>
                                    <div class="prediction-confidence">ì‹ ë¢°ë„: 87%</div>
                                </div>
                            </div>
                            <div class="prediction-card">
                                <div class="prediction-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                    <span style="color: white;">ğŸ¯</span>
                                </div>
                                <div class="prediction-content">
                                    <div class="prediction-label" data-i18n="targetAchievement">ëª©í‘œ ë‹¬ì„±ë¥ </div>
                                    <div class="prediction-value">94%</div>
                                    <div class="prediction-confidence">ì‹ ë¢°ë„: 82%</div>
                                </div>
                            </div>
                            <div class="prediction-card">
                                <div class="prediction-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                    <span style="color: white;">â±ï¸</span>
                                </div>
                                <div class="prediction-content">
                                    <div class="prediction-label" data-i18n="stabilityPeriod">ì•ˆì •í™” ê¸°ê°„</div>
                                    <div class="prediction-value">45ì¼</div>
                                    <div class="prediction-confidence">ì‹ ë¢°ë„: 79%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Incentive Panel (6.x) -->
            <div id="incentive-panel" class="tab-panel">
                <div class="grid grid-cols-2">
                    <!-- ì„±ê³¼ ì ìˆ˜ ë° ë“±ê¸‰ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="performanceScores">ì„±ê³¼ ì ìˆ˜ ë° ë“±ê¸‰</h3>
                            <p class="card-subtitle" data-i18n="performanceScoresSub">TQCë³„ ì¢…í•© ì„±ê³¼ í‰ê°€</p>
                        </div>
                        <div class="card-body">
                            <div id="performanceScoresTable" style="max-height: 400px; overflow-y: auto;">
                                <!-- Dynamic performance scores table will be inserted here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì¸ì„¼í‹°ë¸Œ ìš”ì•½ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="incentiveSummary">ì¸ì„¼í‹°ë¸Œ ìš”ì•½</h3>
                            <p class="card-subtitle" data-i18n="incentiveSummarySub">ì›”ë³„ ì¸ì„¼í‹°ë¸Œ ì§€ê¸‰ í˜„í™©</p>
                        </div>
                        <div class="card-body">
                            <div class="incentive-summary">
                                <div class="summary-item">
                                    <div class="summary-label" data-i18n="totalIncentive">ì´ ì¸ì„¼í‹°ë¸Œ</div>
                                    <div class="summary-value">
                                        <span id="totalIncentive">0</span>
                                        <span class="summary-unit">ì›</span>
                                    </div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label" data-i18n="topPerformers">ìš°ìˆ˜ ì„±ê³¼ì</div>
                                    <div class="summary-value">
                                        <span id="topPerformersCount">0</span>
                                        <span class="summary-unit">ëª…</span>
                                    </div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label" data-i18n="averageScore">í‰ê·  ì ìˆ˜</div>
                                    <div class="summary-value">
                                        <span id="averageScore">0</span>
                                        <span class="summary-unit">ì </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ìƒìœ„ ì„±ê³¼ì ë¦¬ìŠ¤íŠ¸ -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" data-i18n="topPerformersList">ìƒìœ„ ì„±ê³¼ì ëª©ë¡</h3>
                        <p class="card-subtitle" data-i18n="topPerformersListSub">ì„±ê³¼ ì ìˆ˜ ê¸°ì¤€ ìƒìœ„ 10ëª…</p>
                    </div>
                    <div class="card-body">
                        <div id="topPerformersTable">
                            <!-- Dynamic top performers table will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <!-- ì„±ê³¼ ë¶„í¬ ì°¨íŠ¸ -->
                <div class="grid grid-cols-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="scoreDistribution">ì„±ê³¼ ì ìˆ˜ ë¶„í¬</h3>
                            <p class="card-subtitle" data-i18n="scoreDistributionSub">ë“±ê¸‰ë³„ ì¸ì› ë¶„í¬</p>
                        </div>
                        <div class="card-body">
                            <canvas id="scoreDistributionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-i18n="incentiveTrend">ì¸ì„¼í‹°ë¸Œ ì¶”ì´</h3>
                            <p class="card-subtitle" data-i18n="incentiveTrendSub">ì›”ë³„ ì¸ì„¼í‹°ë¸Œ ì§€ê¸‰ ì¶”ì´</p>
                        </div>
                        <div class="card-body">
                            <canvas id="incentiveTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">ìƒì„¸ ì •ë³´</h3>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- Custom Date Picker Modal -->
    <div id="customDateModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="modal-close" onclick="closeDateModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem;" data-i18n="customDateTitle">ë‚ ì§œ ë²”ìœ„ ì„ íƒ</h2>
            <div class="date-picker-container">
                <div class="date-input-group">
                    <label for="startDate" data-i18n="startDate">ì‹œì‘ì¼</label>
                    <input type="date" id="startDate" class="date-input">
                </div>
                <div class="date-input-group">
                    <label for="endDate" data-i18n="endDate">ì¢…ë£Œì¼</label>
                    <input type="date" id="endDate" class="date-input">
                </div>
                <div class="date-shortcuts">
                    <button class="date-shortcut-btn" onclick="setDateShortcut(7)">ìµœê·¼ 7ì¼</button>
                    <button class="date-shortcut-btn" onclick="setDateShortcut(14)">ìµœê·¼ 2ì£¼</button>
                    <button class="date-shortcut-btn" onclick="setDateShortcut(30)">ìµœê·¼ 30ì¼</button>
                    <button class="date-shortcut-btn" onclick="setDateShortcut(60)">ìµœê·¼ 60ì¼</button>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeDateModal()" data-i18n="cancel">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="applyCustomDate()" data-i18n="apply">ì ìš©</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Export Options Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="modal-close" onclick="closeExportModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem;" data-i18n="exportTitle">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h2>
            <div class="export-options">
                <div class="export-format-section">
                    <h3 data-i18n="exportFormat">ë‚´ë³´ë‚´ê¸° í˜•ì‹</h3>
                    <div class="export-format-grid">
                        <button class="export-format-btn" onclick="exportData('csv')">
                            <span class="export-icon">ğŸ“Š</span>
                            <span>CSV</span>
                        </button>
                        <button class="export-format-btn" onclick="exportData('excel')">
                            <span class="export-icon">ğŸ“ˆ</span>
                            <span>Excel</span>
                        </button>
                        <button class="export-format-btn" onclick="exportData('pdf')">
                            <span class="export-icon">ğŸ“„</span>
                            <span>PDF</span>
                        </button>
                        <button class="export-format-btn" onclick="exportData('json')">
                            <span class="export-icon">ğŸ’¾</span>
                            <span>JSON</span>
                        </button>
                    </div>
                </div>
                <div class="export-range-section">
                    <h3 data-i18n="exportRange">ë°ì´í„° ë²”ìœ„</h3>
                    <select id="exportRange" class="export-select">
                        <option value="current" data-i18n="currentPeriod">í˜„ì¬ ì„ íƒ ê¸°ê°„</option>
                        <option value="all" data-i18n="allData">ì „ì²´ ë°ì´í„°</option>
                        <option value="filtered" data-i18n="filteredData">í•„í„°ëœ ë°ì´í„°</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast">
        <div class="toast-icon"></div>
        <div class="toast-message"></div>
        <button class="toast-close" onclick="closeToast()">&times;</button>
    </div>
    
    <script>
        // Real-time Data Management System
        class DataManager {
            constructor() {
                this.csvData = [];
                this.filteredData = [];
                this.summaryData = null;
                this.lastUpdate = new Date();
            }
            
            // Load CSV data from file
            async loadCSVData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const text = e.target.result;
                        this.csvData = this.parseCSV(text);
                        this.processData();
                        resolve(this.csvData);
                    };
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            }
            
            // Parse CSV text
            parseCSV(text) {
                const lines = text.split('\n').filter(line => line.trim());
                const headers = lines[0].split(',').map(h => h.trim());
                
                return lines.slice(1).map(line => {
                    const values = line.split(',').map(v => v.trim());
                    const row = {};
                    headers.forEach((header, i) => {
                        row[header] = values[i] || '';
                    });
                    return row;
                });
            }
            
            // Process data based on current filters
            processData() {
                // Filter by period
                this.filteredData = this.filterByPeriod(this.csvData);
                
                // Calculate summary
                this.summaryData = this.calculateSummary(this.filteredData);
                
                // Update last update time
                this.lastUpdate = new Date();
                
                return this.summaryData;
            }
            
            // Filter data by selected period
            filterByPeriod(data) {
                if (!currentPeriod.start || !currentPeriod.end) return data;
                
                return data.filter(row => {
                    const date = this.parseDate(row['Inspection Date']);
                    return date >= currentPeriod.start && date <= currentPeriod.end;
                });
            }
            
            // Parse date string (M/D/YYYY format)
            parseDate(dateStr) {
                if (!dateStr) return null;
                const parts = dateStr.split('/');
                if (parts.length !== 3) return null;
                return new Date(parseInt(parts[2]), parseInt(parts[0]) - 1, parseInt(parts[1]));
            }
            
            // Calculate summary statistics
            calculateSummary(data) {
                const summary = {
                    totalInspections: 0,
                    totalValidations: 0,
                    totalPass: 0,
                    totalReject: 0,
                    overallPassRate: 0,
                    byBuilding: {},
                    byTQC: {},
                    byDefect: {},
                    byDate: {},
                    uniqueTQCs: new Set(),
                    uniqueInspectors: new Set()
                };
                
                // Add logging for Quality Manager visibility
                console.log(`ğŸ“Š Processing ${data.length} inspection records for TQC analysis...`);
                
                data.forEach((row, index) => {
                    const building = row['Building'] || 'Unknown';
                    const tqcId = (row['TQC ID'] || '').trim();
                    const tqcName = (row['TQC Name'] || '').trim();
                    const validationQty = parseInt(row['Valiation Qty']) || 0;
                    const passQty = parseInt(row['Pass Qty']) || 0;
                    const rejectQty = parseInt(row['Reject Qty']) || 0;
                    const error = row['Error'] || '';
                    const date = row['Inspection Date'];
                    
                    // Overall stats
                    summary.totalInspections++;
                    summary.totalValidations += validationQty;
                    summary.totalPass += passQty;
                    summary.totalReject += rejectQty;
                    
                    // Track unique IDs - ensure we only count non-empty IDs
                    if (tqcId && tqcId.length > 0) {
                        summary.uniqueTQCs.add(tqcId);
                    }
                    if (row['Inspector ID'] && row['Inspector ID'].trim()) {
                        summary.uniqueInspectors.add(row['Inspector ID']);
                    }
                    
                    // By building
                    if (!summary.byBuilding[building]) {
                        summary.byBuilding[building] = {
                            inspections: 0,
                            validations: 0,
                            pass: 0,
                            reject: 0,
                            rate: 0
                        };
                    }
                    summary.byBuilding[building].inspections++;
                    summary.byBuilding[building].validations += validationQty;
                    summary.byBuilding[building].pass += passQty;
                    summary.byBuilding[building].reject += rejectQty;
                    
                    // By TQC - Critical for Quality Manager analysis
                    if (tqcId && tqcId.length > 0) {
                        if (!summary.byTQC[tqcId]) {
                            summary.byTQC[tqcId] = {
                                name: tqcName || 'Unknown TQC',
                                inspections: 0,
                                validations: 0,
                                pass: 0,
                                reject: 0,
                                rate: 0,
                                errors: [],
                                // Add additional Quality Manager metrics
                                firstSeen: date,
                                lastSeen: date,
                                buildings: new Set()
                            };
                        }
                        summary.byTQC[tqcId].inspections++;
                        summary.byTQC[tqcId].validations += validationQty;
                        summary.byTQC[tqcId].pass += passQty;
                        summary.byTQC[tqcId].reject += rejectQty;
                        summary.byTQC[tqcId].lastSeen = date;
                        summary.byTQC[tqcId].buildings.add(building);
                        if (error) summary.byTQC[tqcId].errors.push(error);
                    }
                    
                    // By defect type
                    if (error) {
                        const defectType = error.split('(')[0].trim();
                        if (!summary.byDefect[defectType]) {
                            summary.byDefect[defectType] = 0;
                        }
                        summary.byDefect[defectType] += rejectQty;
                    }
                    
                    // By date
                    if (date) {
                        if (!summary.byDate[date]) {
                            summary.byDate[date] = {
                                inspections: 0,
                                validations: 0,
                                pass: 0,
                                reject: 0
                            };
                        }
                        summary.byDate[date].inspections++;
                        summary.byDate[date].validations += validationQty;
                        summary.byDate[date].pass += passQty;
                        summary.byDate[date].reject += rejectQty;
                    }
                });
                
                // Calculate rates
                summary.overallPassRate = summary.totalValidations > 0 
                    ? (summary.totalPass / summary.totalValidations * 100).toFixed(1)
                    : 0;
                
                Object.keys(summary.byBuilding).forEach(building => {
                    const b = summary.byBuilding[building];
                    b.rate = b.validations > 0 
                        ? (b.pass / b.validations * 100).toFixed(1)
                        : 0;
                });
                
                // Calculate TQC performance rates and identify high-risk inspectors
                let highRiskCount = 0;
                Object.keys(summary.byTQC).forEach(tqc => {
                    const t = summary.byTQC[tqc];
                    t.rate = t.validations > 0 
                        ? (t.pass / t.validations * 100).toFixed(1)
                        : 0;
                    // Mark as high-risk if pass rate < 95%
                    if (parseFloat(t.rate) < 95) {
                        highRiskCount++;
                    }
                    // Convert buildings Set to array for display
                    t.buildingsList = Array.from(t.buildings || []).join(', ');
                });
                
                console.log(`âœ… TQC Analysis Complete:`);
                console.log(`   - Total TQC Inspectors: ${Object.keys(summary.byTQC).length}`);
                console.log(`   - High-Risk Inspectors (< 95% pass rate): ${highRiskCount}`);
                console.log(`   - Unique Inspectors: ${summary.uniqueTQCs.size}`);
                
                return summary;
            }
            
            // Get high risk TQCs (reject rate > 5%) - Enhanced for Quality Manager
            getHighRiskTQCs() {
                if (!this.summaryData || !this.summaryData.byTQC) {
                    console.warn('âš ï¸ No TQC data available for risk analysis');
                    return [];
                }
                
                const tqcList = Object.entries(this.summaryData.byTQC);
                console.log(`ğŸ“Š Analyzing ${tqcList.length} TQC inspectors for risk assessment`);
                
                const highRiskList = tqcList
                    .filter(([id, data]) => {
                        const passRate = parseFloat(data.rate);
                        return passRate < 95; // Quality standard: 95% pass rate
                    })
                    .map(([id, data]) => ({
                        id,
                        name: data.name || 'Unknown',
                        rate: parseFloat(data.rate),
                        validations: data.validations,
                        reject: data.reject || 0,
                        rejectCount: data.reject || 0,
                        errorTypes: data.errors ? [...new Set(data.errors)].slice(0, 3) : [],
                        buildings: data.buildingsList || 'Unknown',
                        riskLevel: parseFloat(data.rate) < 90 ? 'Critical' : 'Warning'
                    }))
                    .sort((a, b) => a.rate - b.rate);
                
                console.log(`ğŸ¯ Identified ${highRiskList.length} high-risk TQC inspectors`);
                if (highRiskList.length > 0) {
                    console.log('Top 3 highest risk:', highRiskList.slice(0, 3).map(t => `${t.name}: ${t.rate}%`));
                }
                return highRiskList;
            }
            
            // Get daily trend data
            getDailyTrend() {
                if (!this.summaryData) return { labels: [], data: [] };
                
                const dates = Object.keys(this.summaryData.byDate).sort();
                const labels = dates.map(d => {
                    const parts = d.split('/');
                    return `${parts[0]}/${parts[1]}`;
                });
                
                const data = dates.map(date => {
                    const d = this.summaryData.byDate[date];
                    return d.validations > 0 
                        ? ((d.reject / d.validations) * 100).toFixed(1)
                        : 0;
                });
                
                return { labels, data };
            }
            
            // Get defect distribution
            getDefectDistribution() {
                if (!this.summaryData) return { labels: [], data: [] };
                
                const defects = Object.entries(this.summaryData.byDefect)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                return {
                    labels: defects.map(d => d[0]),
                    data: defects.map(d => d[1])
                };
            }
        }
        
        // Initialize data manager
        const dataManager = new DataManager();
        
        // Simulated initial data (will be replaced by actual CSV loading)
        const dashboardData = {
            "month": "August",
            "year": 2025,
            "lastUpdated": "2025-09-09T07:26:54.657603",
            "summary": {
                "totalEmployees": 103,
                "totalInspections": 4234,
                "overallPassRate": 97.0,
                "passed5PRS": 62749,
                "failed5PRS": 1941,
                "areaStatistics": {
                    "ASSEMBLY B": {
                        "total": 12440,
                        "passed": 12008,
                        "rate": 96.52733118971061
                    },
                    "ASSEMBLY A": {
                        "total": 11100,
                        "passed": 10787,
                        "rate": 97.18018018018017
                    },
                    "REPACKING": {
                        "total": 5615,
                        "passed": 5487,
                        "rate": 97.72039180765806
                    },
                    "ASSEMBLY C": {
                        "total": 18745,
                        "passed": 18052,
                        "rate": 96.30301413710323
                    },
                    "ASSEMBLY D": {
                        "total": 16790,
                        "passed": 16415,
                        "rate": 97.76652769505658
                    }
                }
            }
        };
        
        // Translations
        const translations = {
            ko: {
                subtitle: "í’ˆì§ˆ ê²€ì‚¬ íŠ¸ë ˆì´ë„ˆ ì„±ê³¼ ë¶„ì„ ì‹œìŠ¤í…œ",
                realtime: "ì‹¤ì‹œê°„",
                periodSelect: "ê¸°ê°„ ì„ íƒ",
                today: "ì˜¤ëŠ˜",
                week: "ìµœê·¼ 1ì£¼",
                month: "ìµœê·¼ 1ë‹¬",
                quarter: "ìµœê·¼ 3ë‹¬",
                custom: "ì§ì ‘ ì„ íƒ",
                kpiTitle: "í•µì‹¬ ì„±ê³¼ ì§€í‘œ",
                totalValidation: "ì´ ê²€ì¦ ê±´ìˆ˜",
                totalRejectRate: "ì „ì²´ ë¶ˆëŸ‰ë¥ ",
                highRiskTQC: "ê³ ìœ„í—˜ TQC",
                activeAuditors: "í™œì„± ê°ì‚¬ì›",
                avgValidationQty: "í‰ê·  ê²€ì¦ ìˆ˜ëŸ‰",
                trainingNeeded: "ì¬êµìœ¡ í•„ìš”",
                allActive: "ì „ì› í™œë™ì¤‘",
                targetAchieved: "ëª©í‘œ ë‹¬ì„±",
                tabOverview: "ì „ì²´ í˜„í™©",
                tabTQC: "TQC ë¶„ì„",
                tabDefects: "ë¶ˆëŸ‰ ë¶„ì„",
                tabRisk: "ìœ„í—˜ë„ ë¶„ì„",
                tabActions: "ì—…ë¬´ ì§€ì‹œ",
                tabSustainability: "ì§€ì†ì„±",
                tabIncentive: "ì¸ì„¼í‹°ë¸Œ",
                performanceScores: "ì„±ê³¼ ì ìˆ˜ ë° ë“±ê¸‰",
                performanceScoresSub: "TQCë³„ ì¢…í•© ì„±ê³¼ í‰ê°€",
                incentiveSummary: "ì¸ì„¼í‹°ë¸Œ ìš”ì•½",
                incentiveSummarySub: "ì›”ë³„ ì¸ì„¼í‹°ë¸Œ ì§€ê¸‰ í˜„í™©",
                totalIncentive: "ì´ ì¸ì„¼í‹°ë¸Œ",
                topPerformers: "ìš°ìˆ˜ ì„±ê³¼ì",
                averageScore: "í‰ê·  ì ìˆ˜",
                topPerformersList: "ìƒìœ„ ì„±ê³¼ì ëª©ë¡",
                topPerformersListSub: "ì„±ê³¼ ì ìˆ˜ ê¸°ì¤€ ìƒìœ„ 10ëª…",
                scoreDistribution: "ì„±ê³¼ ì ìˆ˜ ë¶„í¬",
                scoreDistributionSub: "ë“±ê¸‰ë³„ ì¸ì› ë¶„í¬",
                incentiveTrend: "ì¸ì„¼í‹°ë¸Œ ì¶”ì´",
                incentiveTrendSub: "ì›”ë³„ ì¸ì„¼í‹°ë¸Œ ì§€ê¸‰ ì¶”ì´",
                downloadReport: "ì£¼ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ",
                downloadMonthlyReport: "ì›”ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ"
            },
            en: {
                subtitle: "QIP Trainer Performance Analysis System",
                realtime: "Real-time",
                periodSelect: "Period Selection",
                today: "Today",
                week: "Last Week",
                month: "Last Month",
                quarter: "Last 3 Months",
                custom: "Custom",
                kpiTitle: "Key Performance Indicators",
                totalValidation: "Total Validations",
                totalRejectRate: "Overall Reject Rate",
                highRiskTQC: "High Risk TQC",
                activeAuditors: "Active Auditors",
                avgValidationQty: "Avg Validation Qty",
                trainingNeeded: "Training Required",
                allActive: "All Active",
                targetAchieved: "Target Achieved",
                tabOverview: "Overview",
                tabTQC: "TQC Analysis",
                tabDefects: "Defect Analysis",
                tabRisk: "Risk Analysis",
                tabActions: "Action Items",
                tabSustainability: "Sustainability"
            },
            vi: {
                subtitle: "Há»‡ thá»‘ng phÃ¢n tÃ­ch hiá»‡u suáº¥t QIP Trainer",
                realtime: "Thá»i gian thá»±c",
                periodSelect: "Chá»n khoáº£ng thá»i gian",
                today: "HÃ´m nay",
                week: "1 tuáº§n qua",
                month: "1 thÃ¡ng qua",
                quarter: "3 thÃ¡ng qua",
                custom: "TÃ¹y chá»n",
                kpiTitle: "Chá»‰ sá»‘ hiá»‡u suáº¥t chÃ­nh",
                totalValidation: "Tá»•ng kiá»ƒm tra",
                totalRejectRate: "Tá»· lá»‡ lá»—i",
                highRiskTQC: "TQC rá»§i ro cao",
                activeAuditors: "Kiá»ƒm toÃ¡n viÃªn",
                avgValidationQty: "TB kiá»ƒm tra",
                trainingNeeded: "Cáº§n Ä‘Ã o táº¡o",
                allActive: "Táº¥t cáº£ hoáº¡t Ä‘á»™ng",
                targetAchieved: "Äáº¡t má»¥c tiÃªu",
                tabOverview: "Tá»•ng quan",
                tabTQC: "PhÃ¢n tÃ­ch TQC",
                tabDefects: "PhÃ¢n tÃ­ch lá»—i",
                tabRisk: "PhÃ¢n tÃ­ch rá»§i ro",
                tabActions: "HÃ nh Ä‘á»™ng",
                tabSustainability: "Bá»n vá»¯ng"
            }
        };
        
        // Global state with performance optimizations
        let currentLang = localStorage.getItem('dashboardLang') || 'ko';
        let currentPeriod = { type: 'month', start: null, end: null };
        let chartInstances = {};
        let dataCache = {
            googleDrive: null,
            lastFetch: null,
            ttl: 5 * 60 * 1000 // 5 minutes cache
        };
        let isLoading = false;
        
        // Incentive System Integration
        const incentiveSystem = {
            // Calculate performance score for each inspector
            calculatePerformanceScores: function() {
                if (!dataManager.summaryData || !dataManager.summaryData.byTQC) {
                    return {};
                }
                
                const scores = {};
                const avgPassRate = parseFloat(dataManager.summaryData.overallPassRate) || 95;
                
                Object.entries(dataManager.summaryData.byTQC).forEach(([tqcId, data]) => {
                    const passRate = parseFloat(data.rate) || 0;
                    const validations = data.validations || 0;
                    
                    // Base score from pass rate (0-100)
                    let baseScore = passRate;
                    
                    // Volume bonus (up to 20 points for high volume)
                    const volumeBonus = Math.min(20, validations / 100);
                    
                    // Consistency bonus (up to 10 points for consistent quality)
                    const consistencyBonus = passRate >= avgPassRate ? 10 : 0;
                    
                    // Excellence bonus (extra points for >98% pass rate)
                    const excellenceBonus = passRate >= 98 ? 15 : passRate >= 96 ? 10 : passRate >= 94 ? 5 : 0;
                    
                    // Final score calculation
                    const finalScore = Math.min(100, baseScore * 0.6 + volumeBonus + consistencyBonus + excellenceBonus);
                    
                    scores[tqcId] = {
                        name: data.name,
                        passRate: passRate,
                        validations: validations,
                        baseScore: baseScore,
                        volumeBonus: volumeBonus,
                        consistencyBonus: consistencyBonus,
                        excellenceBonus: excellenceBonus,
                        finalScore: finalScore,
                        grade: this.getGrade(finalScore),
                        incentiveAmount: this.calculateIncentive(finalScore, validations)
                    };
                });
                
                return scores;
            },
            
            getGrade: function(score) {
                if (score >= 95) return 'S';
                if (score >= 90) return 'A';
                if (score >= 85) return 'B';
                if (score >= 80) return 'C';
                if (score >= 70) return 'D';
                return 'F';
            },
            
            calculateIncentive: function(score, validations) {
                // Base incentive per validation
                const baseRate = 100; // 100ì› per validation
                
                // Multiplier based on score
                let multiplier = 1.0;
                if (score >= 95) multiplier = 2.0;
                else if (score >= 90) multiplier = 1.5;
                else if (score >= 85) multiplier = 1.2;
                else if (score >= 80) multiplier = 1.0;
                else multiplier = 0.5;
                
                const incentive = Math.round(validations * baseRate * multiplier);
                return incentive;
            },
            
            getTopPerformers: function(limit = 5) {
                const scores = this.calculatePerformanceScores();
                return Object.entries(scores)
                    .sort((a, b) => b[1].finalScore - a[1].finalScore)
                    .slice(0, limit)
                    .map(([id, data]) => ({
                        id: id,
                        ...data
                    }));
            },
            
            getTotalIncentives: function() {
                const scores = this.calculatePerformanceScores();
                return Object.values(scores).reduce((sum, data) => sum + data.incentiveAmount, 0);
            }
        };
        
        // Quality Prediction Engine
        const predictionEngine = {
            // Predict future quality based on historical trends
            predictQuality: function(days = 7) {
                if (!dataManager.summaryData || !dataManager.summaryData.byDate) {
                    return null;
                }
                
                const dates = Object.keys(dataManager.summaryData.byDate).sort();
                if (dates.length < 3) return null; // Need at least 3 data points
                
                // Calculate trend using linear regression
                const recentData = dates.slice(-14).map((date, index) => {
                    const dayData = dataManager.summaryData.byDate[date];
                    const rejectRate = dayData.validations > 0 
                        ? (dayData.reject / dayData.validations * 100) 
                        : 0;
                    return { x: index, y: rejectRate };
                });
                
                // Simple linear regression
                const n = recentData.length;
                const sumX = recentData.reduce((sum, p) => sum + p.x, 0);
                const sumY = recentData.reduce((sum, p) => sum + p.y, 0);
                const sumXY = recentData.reduce((sum, p) => sum + p.x * p.y, 0);
                const sumX2 = recentData.reduce((sum, p) => sum + p.x * p.x, 0);
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                // Predict future values
                const predictions = [];
                for (let i = 0; i < days; i++) {
                    const predictedRate = slope * (n + i) + intercept;
                    predictions.push({
                        day: i + 1,
                        rate: Math.max(0, Math.min(100, predictedRate)) // Clamp between 0-100
                    });
                }
                
                return {
                    trend: slope > 0.1 ? 'increasing' : slope < -0.1 ? 'decreasing' : 'stable',
                    currentRate: recentData[recentData.length - 1]?.y || 0,
                    predictions: predictions,
                    confidence: this.calculateConfidence(recentData)
                };
            },
            
            calculateConfidence: function(data) {
                // Calculate R-squared for confidence
                const mean = data.reduce((sum, p) => sum + p.y, 0) / data.length;
                const totalSS = data.reduce((sum, p) => sum + Math.pow(p.y - mean, 2), 0);
                const residualSS = data.reduce((sum, p) => {
                    const predicted = p.x * 0.1 + mean; // Simplified prediction
                    return sum + Math.pow(p.y - predicted, 2);
                }, 0);
                const rSquared = 1 - (residualSS / totalSS);
                return Math.max(0, Math.min(100, rSquared * 100));
            },
            
            // Generate alerts based on predictions
            generateAlerts: function() {
                const prediction = this.predictQuality(7);
                if (!prediction) return [];
                
                const alerts = [];
                
                // Check for quality deterioration
                if (prediction.trend === 'increasing' && prediction.predictions[6].rate > 5) {
                    alerts.push({
                        type: 'warning',
                        title: 'í’ˆì§ˆ ì•…í™” ì˜ˆìƒ',
                        message: `7ì¼ í›„ ë¶ˆëŸ‰ë¥ ì´ ${prediction.predictions[6].rate.toFixed(1)}%ë¡œ ìƒìŠ¹í•  ê²ƒìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤.`,
                        priority: 'high'
                    });
                }
                
                // Check for high risk TQCs
                const highRiskTQCs = dataManager.getHighRiskTQCs();
                if (highRiskTQCs.length > 5) {
                    alerts.push({
                        type: 'danger',
                        title: 'ê³ ìœ„í—˜ TQC ë‹¤ìˆ˜ ë°œê²¬',
                        message: `${highRiskTQCs.length}ëª…ì˜ ê²€ì‚¬ì›ì´ 95% ë¯¸ë§Œì˜ í•©ê²©ë¥ ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`,
                        priority: 'high'
                    });
                }
                
                // Check for improvement
                if (prediction.trend === 'decreasing' && prediction.currentRate > 2) {
                    alerts.push({
                        type: 'success',
                        title: 'í’ˆì§ˆ ê°œì„  ì¤‘',
                        message: `ë¶ˆëŸ‰ë¥ ì´ ê°ì†Œ ì¶”ì„¸ì…ë‹ˆë‹¤. í˜„ì¬ ${prediction.currentRate.toFixed(1)}%`,
                        priority: 'low'
                    });
                }
                
                return alerts;
            }
        };
        
        // Helper function to get period name in current language
        function getPeriodName(periodType) {
            const periodNames = {
                'today': { ko: 'ì˜¤ëŠ˜', en: 'Today', vi: 'HÃ´m nay' },
                'week': { ko: 'ìµœê·¼ 1ì£¼', en: 'Last Week', vi: 'Tuáº§n qua' },
                'month': { ko: 'ìµœê·¼ 1ë‹¬', en: 'Last Month', vi: 'ThÃ¡ng qua' },
                '3months': { ko: 'ìµœê·¼ 3ë‹¬', en: 'Last 3 Months', vi: '3 thÃ¡ng qua' }
            };
            return periodNames[periodType] ? periodNames[periodType][currentLanguage] : periodType;
        }
        
        // Determine which months to load based on period selection
        function getMonthsToLoad(periodType, availableMonths) {
            if (!availableMonths || availableMonths.length === 0) {
                // If no months available, try to use default months
                return ['2025_08']; // Default to August which we know has data
            }
            
            // Sort available months to ensure chronological order
            availableMonths.sort();
            
            switch (periodType) {
                case 'today':
                case 'week':
                    // Load only the latest month for short periods
                    return [availableMonths[availableMonths.length - 1]];
                    
                case 'month':
                    // Load the latest month
                    return [availableMonths[availableMonths.length - 1]];
                    
                case '3months':
                    // Load last 3 available months
                    return availableMonths.slice(-3);
                    
                default:
                    // Default to latest month
                    return [availableMonths[availableMonths.length - 1]];
            }
        }
        
        // Dashboard Fix Functions
        function applyDashboardFixes() {
            console.log('ğŸ”§ Applying dashboard fixes...');
            
            // Fix date parsing
            if (window.dataManager) {
                const originalParseDate = window.dataManager.parseDate.bind(window.dataManager);
                window.dataManager.parseDate = function(dateStr) {
                    if (!dateStr) return null;
                    
                    // Try M/D/YYYY format first (8/25/2025)
                    if (dateStr.includes('/')) {
                        const parts = dateStr.split('/');
                        if (parts.length === 3) {
                            const month = parseInt(parts[0]);
                            const day = parseInt(parts[1]);
                            const year = parseInt(parts[2]);
                            if (!isNaN(month) && !isNaN(day) && !isNaN(year)) {
                                return new Date(year, month - 1, day);
                            }
                        }
                    }
                    
                    // Fallback to original parsing
                    return originalParseDate(dateStr);
                };
                
                // Store original data
                window.dataManager.originalData = window.dataManager.originalData || [];
                const originalProcessData = window.dataManager.processData.bind(window.dataManager);
                window.dataManager.processData = function() {
                    if (this.csvData.length > 0 && this.originalData.length === 0) {
                        this.originalData = [...this.csvData];
                        console.log(`ğŸ“¦ Stored ${this.originalData.length} original records`);
                    }
                    if (this.originalData.length > 0) {
                        this.csvData = [...this.originalData];
                    }
                    return originalProcessData();
                };
            }
            
            // Initialize charts if not already done
            setTimeout(() => {
                if (Object.keys(window.chartInstances || {}).length === 0) {
                    console.log('ğŸ“Š Initializing charts...');
                    if (typeof initializeCharts === 'function') {
                        initializeCharts();
                    }
                }
            }, 1000);
            
            console.log('âœ… Dashboard fixes applied');
        }
        
        // Initialize dashboard with performance optimizations
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… QIP Trainer Dashboard v2.0 Initialized');
            
            // Apply fixes
            applyDashboardFixes();
            
            // Check for cached data first
            const cachedData = getCachedData();
            if (cachedData) {
                console.log('ğŸ“¦ Using cached data');
                if (dataManager) {
                    dataManager.rawData = cachedData.data;
                    dataManager.summaryData = cachedData.summary;
                }
            }
            
            // Initialize critical components first
            initializeLanguageSelector();
            initializePeriodSelector();
            initializeTabs();
            
            // Defer non-critical components for better performance
            requestAnimationFrame(() => {
                initializeFilters();
                initializeCharts();
                initializeDataLoader();
                generateTQCTable();
                
                // Initialize new tab functions  
                updateRiskAnalysis();
                updateActionItems();
                updateSustainability();
                
                // Set initial period
                setPeriod('month');
            });
            
            // Auto-load data if available
            autoLoadData();
            
            // Mobile touch support
            if ('ontouchstart' in window) {
                initializeTouchSupport();
            }
            
            // Smart auto-refresh with exponential backoff
            let refreshInterval = 60000; // 1 minute intervals
            let autoRefreshEnabled = true;
            let refreshTimer = setInterval(() => {
                if (autoRefreshEnabled && !isLoading && !document.hidden) { // Only refresh if tab is visible
                    refreshData().catch(() => {
                        // On error, increase interval
                        refreshInterval = Math.min(refreshInterval * 2, 300000); // Max 5 minutes
                        clearInterval(refreshTimer);
                        refreshTimer = setInterval(() => refreshData(), refreshInterval);
                    });
                }
            }, refreshInterval);
            
            // Visibility API for performance
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    console.log('ğŸ”Œ Pausing updates - tab hidden');
                } else {
                    console.log('â–¶ï¸ Resuming updates - tab visible');
                    refreshData();
                }
            });
            
            // Optimize chart updates on resize
            const updateChartsDebounced = debounce(() => {
                updateCharts();
            }, 300);
            
            window.addEventListener('resize', updateChartsDebounced);
        });
        
        // Initialize data loader
        function initializeDataLoader() {
            const loadBtn = document.getElementById('loadDataBtn');
            const fileInput = document.getElementById('csvFileInput');
            
            if (loadBtn && fileInput) {
                loadBtn.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        await loadDataFromFile(file);
                    }
                });
            }
        }
        
        // Load data from CSV file
        async function loadDataFromFile(file) {
            try {
                console.log(`ğŸ“ Loading data from: ${file.name}`);
                await dataManager.loadCSVData(file);
                
                // Update all components with new data
                updateAllComponents();
                
                // Show success message
                showNotification('âœ… ë°ì´í„° ë¡œë“œ ì„±ê³µ', 'success');
                
                console.log('âœ… Data loaded successfully');
            } catch (error) {
                console.error('âŒ Error loading data:', error);
                showNotification('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }
        
        // Auto-load data from Google Drive synced location
        async function autoLoadData() {
            // Check cache first for performance (skip for now to always load fresh data)
            // const cached = getCachedData();
            // if (cached) {
            //     console.log('ğŸ“¦ Loading from cache');
            //     if (dataManager) {
            //         dataManager.rawData = cached.data;
            //         dataManager.summaryData = cached.summary;
            //         updateAllComponents();
            //     }
            //     return true;
            // }
            
            try {
                // First, load metadata to know available months
                const metadataPath = 'data/metadata.json';
                let availableMonths = [];
                
                try {
                    const metadataResponse = await fetch(metadataPath);
                    if (metadataResponse.ok) {
                        const metadata = await metadataResponse.json();
                        availableMonths = metadata.availableMonths || [];
                        console.log(`ğŸ“… Available months: ${availableMonths.join(', ')}`);
                    }
                } catch (e) {
                    console.log('Metadata not found, trying individual months');
                }
                
                // Determine which months to load based on current period
                const monthsToLoad = getMonthsToLoad(currentPeriod.type, availableMonths);
                console.log(`ğŸ“Š Loading data for period '${currentPeriod.type}': ${monthsToLoad.join(', ')}`);
                
                // Load and merge data from multiple months
                const allData = [];
                let loadedMonths = [];
                
                for (const monthKey of monthsToLoad) {
                    const paths = [
                        `data/qip_trainer_data_${monthKey}.json`,
                        `./data/qip_trainer_data_${monthKey}.json`
                    ];
                    
                    for (const path of paths) {
                        try {
                            const response = await fetch(path);
                            if (response.ok) {
                                const jsonData = await response.json();
                                if (jsonData.rawData && Array.isArray(jsonData.rawData)) {
                                    allData.push(...jsonData.rawData);
                                    loadedMonths.push(monthKey);
                                    console.log(`âœ… Loaded ${monthKey}: ${jsonData.rawData.length} records`);
                                    break; // Found this month's data, move to next month
                                }
                            }
                        } catch (e) {
                            // Try next path
                        }
                    }
                }
                
                // Process loaded data
                if (allData.length > 0) {
                    dataManager.csvData = allData;
                    dataManager.originalData = [...allData]; // Store original for filtering
                    dataManager.processData();
                    updateAllComponents();
                    
                    console.log(`ğŸ“Š Loaded ${allData.length} records from ${loadedMonths.length} month(s)`);
                    showNotification(`âœ… ${loadedMonths.length}ê°œì›” ë°ì´í„° ë¡œë“œ ì™„ë£Œ`, 'success');
                    
                    // Update date range display
                    updateDateRangeDisplay(loadedMonths);
                    return true;
                } else {
                    // Fallback to August data if available
                    if (availableMonths.length === 0) {
                        // Try loading specific August data as fallback
                        const fallbackPaths = [
                            'data/qip_trainer_data_2025_08.json',
                            './data/qip_trainer_data_2025_08.json'
                        ];
                        
                        for (const path of fallbackPaths) {
                            try {
                                const response = await fetch(path);
                                if (response.ok) {
                                    const jsonData = await response.json();
                                    if (jsonData.rawData && Array.isArray(jsonData.rawData)) {
                                        dataManager.csvData = jsonData.rawData;
                                        dataManager.originalData = [...jsonData.rawData];
                                        dataManager.processData();
                                        updateAllComponents();
                                        console.log(`âœ… Loaded fallback August data`);
                                        showNotification('âœ… 8ì›” ë°ì´í„° ë¡œë“œë¨', 'success');
                                        return true;
                                    }
                                }
                            } catch (e) {
                                // Try next path
                            }
                        }
                    }
                    
                    console.log('âš ï¸ No data available for selected period');
                    showNotification('âš ï¸ ì„ íƒí•œ ê¸°ê°„ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'warning');
                }
            } catch (error) {
                console.log('â„¹ï¸ Using embedded sample data:', error);
            }
        }
        
        // Export data functionality
        function exportData(format) {
            if (!dataManager.csvData || dataManager.csvData.length === 0) {
                showNotification('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'warning');
                return;
            }
            
            const timestamp = new Date().toISOString().split('T')[0];
            
            if (format === 'csv') {
                // Export as CSV
                const headers = Object.keys(dataManager.csvData[0]);
                const csvContent = [
                    headers.join(','),
                    ...dataManager.csvData.map(row => 
                        headers.map(header => {
                            const value = row[header] || '';
                            // Escape commas and quotes in CSV
                            return typeof value === 'string' && value.includes(',') 
                                ? `"${value.replace(/"/g, '""')}"` 
                                : value;
                        }).join(',')
                    )
                ].join('\n');
                
                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `qip_trainer_data_${timestamp}.csv`;
                link.click();
                
                showNotification(`CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ${dataManager.csvData.length}ê±´`, 'success');
                
            } else if (format === 'json') {
                // Export as JSON with summary
                const exportData = {
                    exportDate: new Date().toISOString(),
                    period: currentPeriod.type,
                    totalRecords: dataManager.csvData.length,
                    summary: dataManager.summaryData,
                    rawData: dataManager.csvData
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `qip_trainer_data_${timestamp}.json`;
                link.click();
                
                showNotification(`JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ${dataManager.csvData.length}ê±´`, 'success');
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                border-radius: 0.5rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Language selector
        function initializeLanguageSelector() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const lang = e.currentTarget.dataset.lang;
                    changeLanguage(lang);
                });
            });
            
            // Load saved language
            const savedLang = localStorage.getItem('qip-dashboard-lang') || 'ko';
            changeLanguage(savedLang);
        }
        
        function changeLanguage(lang) {
            currentLang = lang;
            
            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // Translate UI
            translateUI(lang);
            
            // Save preference
            localStorage.setItem('qip-dashboard-lang', lang);
            
            console.log(`ğŸŒ Language changed to: ${lang}`);
        }
        
        function translateUI(lang) {
            const t = translations[lang];
            
            // Translate all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (t[key]) {
                    el.textContent = t[key];
                }
            });
            
            // Update HTML lang attribute
            document.documentElement.lang = lang;
        }
        
        // Period selector
        function initializePeriodSelector() {
            const periodButtons = document.querySelectorAll('.period-btn');
            
            periodButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const period = button.dataset.period;
                    
                    if (period === 'custom') {
                        showCustomDatePicker();
                    } else {
                        setPeriod(period);
                    }
                });
            });
        }
        
        function setPeriod(periodType) {
            const now = new Date();
            let start, end;
            
            switch(periodType) {
                case 'today':
                    start = end = new Date();
                    break;
                case 'week':
                    start = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    end = now;
                    break;
                case 'month':
                    start = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    end = now;
                    break;
                case 'quarter':
                    start = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                    end = now;
                    break;
            }
            
            currentPeriod = { type: periodType, start, end };
            
            // Update button states
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.period === periodType);
            });
            
            // Update date display
            updateDateRangeDisplay();
            
            // Reprocess data with new period
            if (dataManager.csvData.length > 0) {
                dataManager.processData();
            }
            
            // Reload data for the new period
            autoLoadData().then(() => {
                // Update all components after data is loaded
                updateAllComponents();
            });
            
            // Dispatch period change event
            window.dispatchEvent(new CustomEvent('periodChanged', { 
                detail: { type: periodType, start, end } 
            }));
            
            console.log(`ğŸ“… Period changed to: ${periodType}`);
        }
        
        function updateDateRangeDisplay(loadedMonths = []) {
            const { start, end } = currentPeriod;
            
            // If months are provided, show them
            if (loadedMonths && loadedMonths.length > 0) {
                const monthDisplay = loadedMonths.map(m => {
                    const [year, month] = m.split('_');
                    return `${year}.${month}`;
                }).join(' ~ ');
                
                const rangeDisplay = document.querySelector('.date-range-display');
                if (rangeDisplay) {
                    rangeDisplay.innerHTML = `
                        <span class="range-label">ê¸°ê°„:</span>
                        <span class="range-value">${monthDisplay}</span>
                        <span class="range-count">(${loadedMonths.length}ê°œì›”)</span>
                    `;
                }
                return;
            }
            
            if (!start || !end) return;
            
            const formatDate = (date) => {
                return date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                }).replace(/\. /g, '.').replace(/\.$/, '');
            };
            
            // Check actual data range if data is loaded
            if (dataManager.csvData && dataManager.csvData.length > 0) {
                const actualRange = getActualDataRange();
                const rangeDisplay = document.querySelector('.date-range-display');
                
                // Compare requested vs actual range
                if (actualRange.start && actualRange.end) {
                    const requestedDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    const actualDays = Math.ceil((actualRange.end - actualRange.start) / (1000 * 60 * 60 * 24)) + 1;
                    
                    // Check if actual data covers the requested period
                    const dataCoversRequest = actualRange.start <= start && actualRange.end >= end;
                    
                    if (dataCoversRequest) {
                        // Data fully covers requested period - show requested range
                        document.querySelector('.range-from').textContent = formatDate(start);
                        document.querySelector('.range-to').textContent = formatDate(end);
                        document.querySelector('.range-duration').textContent = `(${requestedDays}ì¼)`;
                        
                        // Remove warning styles
                        rangeDisplay.classList.remove('data-limited', 'no-data');
                    } else {
                        // Data doesn't fully cover requested period - show actual range
                        document.querySelector('.range-from').textContent = formatDate(actualRange.start);
                        document.querySelector('.range-to').textContent = formatDate(actualRange.end);
                        
                        // Add notice about data limitation
                        document.querySelector('.range-duration').innerHTML = `
                            <span style="color: var(--warning-color);" title="Google Drive ë°ì´í„° ê¸°ê°„">
                                (ì‹¤ì œ: ${actualDays}ì¼ / ìš”ì²­: ${requestedDays}ì¼)
                            </span>
                        `;
                        
                        // Add warning style
                        rangeDisplay.classList.add('data-limited');
                        rangeDisplay.classList.remove('no-data');
                        
                        // Add status badge if not exists
                        if (!rangeDisplay.querySelector('.data-status-badge')) {
                            const badge = document.createElement('span');
                            badge.className = 'data-status-badge';
                            badge.textContent = 'ë°ì´í„° ì œí•œ';
                            rangeDisplay.appendChild(badge);
                        }
                        
                        // Show notification once
                        if (!window.dataRangeNotified) {
                            const periodName = getPeriodName(currentPeriod.type);
                            showNotification(
                                `ğŸ“… ${periodName} ìš”ì²­í–ˆì§€ë§Œ, Google Driveì—ëŠ” ${formatDate(actualRange.start)} ~ ${formatDate(actualRange.end)} ë°ì´í„°ë§Œ ìˆìŠµë‹ˆë‹¤.`,
                                'warning'
                            );
                            window.dataRangeNotified = true;
                        }
                    }
                } else {
                    // No valid data range found
                    const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    document.querySelector('.range-from').textContent = formatDate(start);
                    document.querySelector('.range-to').textContent = formatDate(end);
                    document.querySelector('.range-duration').innerHTML = `
                        <span style="color: var(--danger-color);">
                            (ë°ì´í„° ì—†ìŒ)
                        </span>
                    `;
                }
            } else {
                // No data loaded yet - show requested range
                const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                document.querySelector('.range-from').textContent = formatDate(start);
                document.querySelector('.range-to').textContent = formatDate(end);
                document.querySelector('.range-duration').textContent = `(${daysDiff}ì¼)`;
            }
        }
        
        // Get actual data range from loaded data
        function getActualDataRange() {
            if (!dataManager.csvData || dataManager.csvData.length === 0) {
                return { start: null, end: null };
            }
            
            let minDate = null;
            let maxDate = null;
            
            // Find min and max dates in the data
            dataManager.csvData.forEach(row => {
                const dateStr = row['Inspection Date'];
                if (dateStr) {
                    const date = dataManager.parseDate(dateStr);
                    if (date) {
                        if (!minDate || date < minDate) minDate = date;
                        if (!maxDate || date > maxDate) maxDate = date;
                    }
                }
            });
            
            return { start: minDate, end: maxDate };
        }
        
        // Tab content update functions
        function updateRiskAnalysis() {
            if (!dataManager.summaryData) return;
            
            const highRiskTQCs = dataManager.getHighRiskTQCs();
            const riskListElement = document.querySelector('#risk-panel .grid');
            
            if (riskListElement && highRiskTQCs.length > 0) {
                // Update high risk TQC list
                const listHTML = highRiskTQCs.slice(0, 5).map(tqc => `
                    <tr>
                        <td class="px-4 py-2">${tqc.id}</td>
                        <td class="px-4 py-2">${tqc.name}</td>
                        <td class="px-4 py-2">${tqc.rate}%</td>
                        <td class="px-4 py-2">${tqc.validations}</td>
                    </tr>
                `).join('');
                
                const tbody = riskListElement.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = listHTML;
                }
            }
        }
        
        function updateDefectAnalysis() {
            // Update defect analysis tab charts
            if (chartInstances.defectByType) {
                const defectData = dataManager.getDefectDistribution();
                if (defectData.labels.length > 0) {
                    chartInstances.defectByType.data.labels = defectData.labels;
                    chartInstances.defectByType.data.datasets[0].data = defectData.data;
                    chartInstances.defectByType.update();
                }
            }
        }
        
        function updateActionItems() {
            // Update work instruction/action items tab
            const actionPanel = document.getElementById('actions-panel');
            if (actionPanel && dataManager.summaryData) {
                // Generate action items based on analysis
                const highRiskCount = dataManager.getHighRiskTQCs().length;
                if (highRiskCount > 0) {
                    const actionList = actionPanel.querySelector('.table tbody');
                    if (actionList) {
                        actionList.innerHTML = `
                            <tr>
                                <td class="px-4 py-2">High</td>
                                <td class="px-4 py-2">Review ${highRiskCount} high-risk TQCs</td>
                                <td class="px-4 py-2">QA Team</td>
                                <td class="px-4 py-2">Pending</td>
                            </tr>
                        `;
                    }
                }
            }
        }
        
        function updateWorkInstructions() {
            // Alias for updateActionItems
            updateActionItems();
        }
        
        function updateSustainability() {
            // Update sustainability tab with long-term trends
            const sustainPanel = document.getElementById('sustainability-panel');
            if (sustainPanel && dataManager.summaryData) {
                // Update trend analysis
                const trendData = dataManager.getDailyTrend();
                if (trendData.labels.length > 0) {
                    // Update sustainability metrics display
                    const metricsCard = sustainPanel.querySelector('.metrics-card');
                    if (metricsCard) {
                        const avgRejectRate = trendData.data.reduce((a, b) => parseFloat(a) + parseFloat(b), 0) / trendData.data.length;
                        metricsCard.innerHTML = `
                            <div class="metric">
                                <div class="metric-label">í‰ê·  ë¶ˆëŸ‰ë¥ </div>
                                <div class="metric-value">${avgRejectRate.toFixed(2)}%</div>
                            </div>
                        `;
                    }
                }
            }
        }
        
        // Update incentive dashboard (6.x)
        function updateIncentive() {
            const incentivePanel = document.getElementById('incentive-panel');
            if (!incentivePanel || !dataManager.summaryData) return;
            
            // Calculate performance scores
            const scores = incentiveSystem.calculatePerformanceScores();
            const topPerformers = incentiveSystem.getTopPerformers(10);
            const totalIncentive = incentiveSystem.getTotalIncentives();
            
            // Update summary
            document.getElementById('totalIncentive').textContent = totalIncentive.toLocaleString();
            document.getElementById('topPerformersCount').textContent = topPerformers.length;
            
            const avgScore = Object.values(scores).reduce((sum, s) => sum + s.finalScore, 0) / Object.keys(scores).length || 0;
            document.getElementById('averageScore').textContent = avgScore.toFixed(1);
            
            // Update performance scores table
            const scoresTable = document.getElementById('performanceScoresTable');
            if (scoresTable) {
                const tableHTML = `
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f3f4f6;">
                                <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">TQC</th>
                                <th style="padding: 0.5rem; text-align: center; border-bottom: 2px solid #e5e7eb;">í•©ê²©ë¥ </th>
                                <th style="padding: 0.5rem; text-align: center; border-bottom: 2px solid #e5e7eb;">ì ìˆ˜</th>
                                <th style="padding: 0.5rem; text-align: center; border-bottom: 2px solid #e5e7eb;">ë“±ê¸‰</th>
                                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">ì¸ì„¼í‹°ë¸Œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(scores).slice(0, 20).map(([id, data]) => `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 0.5rem;">${data.name || id}</td>
                                    <td style="padding: 0.5rem; text-align: center;">${data.passRate.toFixed(1)}%</td>
                                    <td style="padding: 0.5rem; text-align: center;">${data.finalScore.toFixed(1)}</td>
                                    <td style="padding: 0.5rem; text-align: center;">
                                        <span style="padding: 0.25rem 0.5rem; border-radius: 0.25rem; background: ${
                                            data.grade === 'S' ? '#10b981' :
                                            data.grade === 'A' ? '#3b82f6' :
                                            data.grade === 'B' ? '#6366f1' :
                                            data.grade === 'C' ? '#f59e0b' :
                                            data.grade === 'D' ? '#ef4444' : '#6b7280'
                                        }; color: white; font-weight: bold;">${data.grade}</span>
                                    </td>
                                    <td style="padding: 0.5rem; text-align: right;">${data.incentiveAmount.toLocaleString()}ì›</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                scoresTable.innerHTML = tableHTML;
            }
            
            // Update top performers table
            const topTable = document.getElementById('topPerformersTable');
            if (topTable) {
                const topHTML = `
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f3f4f6;">
                                <th style="padding: 0.5rem; text-align: center; border-bottom: 2px solid #e5e7eb;">ìˆœìœ„</th>
                                <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">TQC</th>
                                <th style="padding: 0.5rem; text-align: center; border-bottom: 2px solid #e5e7eb;">ì ìˆ˜</th>
                                <th style="padding: 0.5rem; text-align: center; border-bottom: 2px solid #e5e7eb;">ë“±ê¸‰</th>
                                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">ì¸ì„¼í‹°ë¸Œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topPerformers.map((performer, index) => `
                                <tr style="border-bottom: 1px solid #e5e7eb; ${index < 3 ? 'background: #fef3c7;' : ''}">
                                    <td style="padding: 0.5rem; text-align: center; font-weight: bold;">
                                        ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index + 1}
                                    </td>
                                    <td style="padding: 0.5rem;">${performer.name}</td>
                                    <td style="padding: 0.5rem; text-align: center;">${performer.finalScore.toFixed(1)}</td>
                                    <td style="padding: 0.5rem; text-align: center;">
                                        <span style="padding: 0.25rem 0.5rem; border-radius: 0.25rem; background: ${
                                            performer.grade === 'S' ? '#10b981' : '#3b82f6'
                                        }; color: white; font-weight: bold;">${performer.grade}</span>
                                    </td>
                                    <td style="padding: 0.5rem; text-align: right; font-weight: bold;">${performer.incentiveAmount.toLocaleString()}ì›</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                topTable.innerHTML = topHTML;
            }
            
            // Update score distribution chart
            updateIncentiveCharts(scores);
        }
        
        // Update incentive charts
        function updateIncentiveCharts(scores) {
            // Score distribution chart
            const distributionCtx = document.getElementById('scoreDistributionChart');
            if (distributionCtx) {
                const grades = ['S', 'A', 'B', 'C', 'D', 'F'];
                const gradeCounts = grades.map(grade => 
                    Object.values(scores).filter(s => s.grade === grade).length
                );
                
                if (chartInstances.scoreDistribution) {
                    chartInstances.scoreDistribution.destroy();
                }
                
                chartInstances.scoreDistribution = new Chart(distributionCtx, {
                    type: 'bar',
                    data: {
                        labels: grades,
                        datasets: [{
                            label: 'ì¸ì› ìˆ˜',
                            data: gradeCounts,
                            backgroundColor: [
                                '#10b981', '#3b82f6', '#6366f1', '#f59e0b', '#ef4444', '#6b7280'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });
            }
            
            // Incentive trend chart (mock data for now)
            const trendCtx = document.getElementById('incentiveTrendChart');
            if (trendCtx) {
                if (chartInstances.incentiveTrend) {
                    chartInstances.incentiveTrend.destroy();
                }
                
                // Generate mock monthly data
                const months = ['7ì›”', '8ì›”', '9ì›”'];
                const monthlyIncentives = [2850000, 3120000, 3350000];
                
                chartInstances.incentiveTrend = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'ì›”ë³„ ì¸ì„¼í‹°ë¸Œ',
                            data: monthlyIncentives,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return (value / 1000000).toFixed(1) + 'M';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // 7.x Report Generation System
        const reportGenerator = {
            generateReport: function(type = 'weekly') {
                if (!dataManager.summaryData) return null;
                
                const report = {
                    title: type === 'weekly' ? 'ì£¼ê°„ í’ˆì§ˆ ë¦¬í¬íŠ¸' : type === 'monthly' ? 'ì›”ê°„ í’ˆì§ˆ ë¦¬í¬íŠ¸' : 'ì¼ì¼ í’ˆì§ˆ ë¦¬í¬íŠ¸',
                    generatedAt: new Date().toLocaleString('ko-KR'),
                    period: getPeriodName(),
                    summary: this.generateSummary(),
                    details: this.generateDetails(),
                    recommendations: this.generateRecommendations(),
                    charts: this.captureCharts()
                };
                
                return report;
            },
            
            generateSummary: function() {
                const summary = dataManager.summaryData;
                return {
                    totalInspections: summary.totalInspections,
                    totalValidations: summary.totalValidations,
                    totalPass: summary.totalPass,
                    totalReject: summary.totalReject,
                    overallPassRate: summary.overallPassRate,
                    topPerformers: incentiveSystem.getTopPerformers(5),
                    criticalIssues: this.identifyCriticalIssues()
                };
            },
            
            generateDetails: function() {
                const summary = dataManager.summaryData;
                return {
                    byBuilding: summary.byBuilding,
                    byDefect: summary.byDefect,
                    byDate: summary.byDate,
                    predictions: predictionEngine.predictQuality(7)
                };
            },
            
            generateRecommendations: function() {
                const recommendations = [];
                const summary = dataManager.summaryData;
                
                // Pass rate based recommendations
                if (summary.overallPassRate < 95) {
                    recommendations.push({
                        priority: 'high',
                        category: 'í’ˆì§ˆ ê°œì„ ',
                        action: 'ì „ì²´ í•©ê²©ë¥ ì´ 95% ë¯¸ë§Œì…ë‹ˆë‹¤. ì§‘ì¤‘ êµìœ¡ í”„ë¡œê·¸ë¨ ì‹¤ì‹œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.'
                    });
                }
                
                // Building specific recommendations
                Object.entries(summary.byBuilding).forEach(([building, data]) => {
                    if (data.rate < 90) {
                        recommendations.push({
                            priority: 'medium',
                            category: 'êµ¬ì—­ë³„ ê´€ë¦¬',
                            action: `${building} êµ¬ì—­ì˜ í•©ê²©ë¥ ì´ ${data.rate}%ì…ë‹ˆë‹¤. íŠ¹ë³„ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.`
                        });
                    }
                });
                
                // Trend based recommendations
                const prediction = predictionEngine.predictQuality(7);
                if (prediction && prediction.trend === 'increasing') {
                    recommendations.push({
                        priority: 'high',
                        category: 'ì˜ˆë°© ì¡°ì¹˜',
                        action: 'ë¶ˆëŸ‰ë¥  ì¦ê°€ ì¶”ì„¸ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜ˆë°© ì¡°ì¹˜ë¥¼ ì‹œí–‰í•˜ì„¸ìš”.'
                    });
                }
                
                return recommendations;
            },
            
            identifyCriticalIssues: function() {
                const issues = [];
                const highRiskTQCs = dataManager.getHighRiskTQCs();
                
                if (highRiskTQCs.length > 0) {
                    issues.push({
                        type: 'TQC ì„±ê³¼',
                        count: highRiskTQCs.length,
                        description: `${highRiskTQCs.length}ëª…ì˜ ê²€ì‚¬ì›ì´ ìœ„í—˜ ìˆ˜ì¤€ì˜ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`
                    });
                }
                
                // Check for defect patterns
                const defects = dataManager.summaryData.byDefect;
                const topDefect = Object.entries(defects).sort((a, b) => b[1] - a[1])[0];
                if (topDefect && topDefect[1] > 100) {
                    issues.push({
                        type: 'ì£¼ìš” ë¶ˆëŸ‰',
                        count: topDefect[1],
                        description: `${topDefect[0]} ë¶ˆëŸ‰ì´ ${topDefect[1]}ê±´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`
                    });
                }
                
                return issues;
            },
            
            captureCharts: function() {
                // Capture chart data for report
                const charts = {};
                
                if (chartInstances.dailyTrend) {
                    charts.dailyTrend = {
                        type: 'line',
                        labels: chartInstances.dailyTrend.data.labels,
                        data: chartInstances.dailyTrend.data.datasets[0].data
                    };
                }
                
                if (chartInstances.defectType) {
                    charts.defectType = {
                        type: 'doughnut',
                        labels: chartInstances.defectType.data.labels,
                        data: chartInstances.defectType.data.datasets[0].data
                    };
                }
                
                if (chartInstances.building) {
                    charts.building = {
                        type: 'bar',
                        labels: chartInstances.building.data.labels,
                        data: chartInstances.building.data.datasets[0].data
                    };
                }
                
                return charts;
            },
            
            downloadReport: function(type = 'weekly') {
                const report = this.generateReport(type);
                if (!report) return;
                
                // Create HTML report
                const html = this.generateHTML(report);
                
                // Create blob and download
                const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `QIP_Report_${type}_${new Date().toISOString().split('T')[0]}.html`;
                link.click();
            },
            
            generateHTML: function(report) {
                return `
                    <!DOCTYPE html>
                    <html lang="ko">
                    <head>
                        <meta charset="UTF-8">
                        <title>${report.title}</title>
                        <style>
                            body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
                            h1 { color: #1e40af; border-bottom: 3px solid #3b82f6; padding-bottom: 10px; }
                            h2 { color: #2563eb; margin-top: 30px; }
                            .header { background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
                            .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
                            .summary-card { background: #f0f9ff; padding: 20px; border-radius: 8px; border-left: 4px solid #3b82f6; }
                            .metric-value { font-size: 2em; font-weight: bold; color: #1e40af; }
                            .metric-label { color: #64748b; margin-top: 5px; }
                            .recommendation { background: #fef3c7; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #f59e0b; }
                            .critical { background: #fee2e2; border-left-color: #ef4444; }
                            .success { background: #dcfce7; border-left-color: #10b981; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th { background: #f1f5f9; padding: 12px; text-align: left; border-bottom: 2px solid #cbd5e1; }
                            td { padding: 10px; border-bottom: 1px solid #e2e8f0; }
                            .chart-container { margin: 30px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
                            @media print { 
                                .header { background: #1e40af !important; -webkit-print-color-adjust: exact; }
                                .page-break { page-break-after: always; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>${report.title}</h1>
                            <p>ìƒì„±ì¼ì‹œ: ${report.generatedAt}</p>
                            <p>ë¶„ì„ ê¸°ê°„: ${report.period}</p>
                        </div>
                        
                        <h2>ğŸ“Š ìš”ì•½ ì •ë³´</h2>
                        <div class="summary-grid">
                            <div class="summary-card">
                                <div class="metric-value">${report.summary.totalInspections.toLocaleString()}</div>
                                <div class="metric-label">ì´ ê²€ì‚¬ ê±´ìˆ˜</div>
                            </div>
                            <div class="summary-card">
                                <div class="metric-value">${report.summary.overallPassRate}%</div>
                                <div class="metric-label">ì „ì²´ í•©ê²©ë¥ </div>
                            </div>
                            <div class="summary-card">
                                <div class="metric-value">${report.summary.totalPass.toLocaleString()}</div>
                                <div class="metric-label">í•©ê²© ìˆ˜ëŸ‰</div>
                            </div>
                            <div class="summary-card">
                                <div class="metric-value">${report.summary.totalReject.toLocaleString()}</div>
                                <div class="metric-label">ë¶ˆëŸ‰ ìˆ˜ëŸ‰</div>
                            </div>
                        </div>
                        
                        ${report.summary.criticalIssues.length > 0 ? `
                            <h2>âš ï¸ ì£¼ìš” ì´ìŠˆ</h2>
                            ${report.summary.criticalIssues.map(issue => `
                                <div class="recommendation critical">
                                    <strong>${issue.type}:</strong> ${issue.description}
                                </div>
                            `).join('')}
                        ` : ''}
                        
                        <h2>ğŸ† ìš°ìˆ˜ ì„±ê³¼ì</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>TQC</th>
                                    <th>í•©ê²©ë¥ </th>
                                    <th>ì ìˆ˜</th>
                                    <th>ë“±ê¸‰</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${report.summary.topPerformers.map((p, i) => `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td>${p.name}</td>
                                        <td>${p.passRate.toFixed(1)}%</td>
                                        <td>${p.finalScore.toFixed(1)}</td>
                                        <td>${p.grade}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <div class="page-break"></div>
                        
                        <h2>ğŸ“ˆ êµ¬ì—­ë³„ ì„±ê³¼</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>êµ¬ì—­</th>
                                    <th>ê²€ì‚¬ ê±´ìˆ˜</th>
                                    <th>ê²€ì¦ ìˆ˜ëŸ‰</th>
                                    <th>í•©ê²©ë¥ </th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(report.details.byBuilding).map(([building, data]) => `
                                    <tr>
                                        <td>${building}</td>
                                        <td>${data.inspections}</td>
                                        <td>${data.validations}</td>
                                        <td>${data.rate}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <h2>ğŸ’¡ ê¶Œì¥ ì‚¬í•­</h2>
                        ${report.recommendations.map(rec => `
                            <div class="recommendation ${rec.priority === 'high' ? 'critical' : ''}">
                                <strong>[${rec.category}]</strong> ${rec.action}
                            </div>
                        `).join('')}
                        
                        <div class="page-break"></div>
                        
                        <h2>ğŸ“Š ìƒì„¸ ë°ì´í„°</h2>
                        <div class="chart-container">
                            <h3>ì¼ë³„ ë¶ˆëŸ‰ë¥  ì¶”ì´</h3>
                            <p>ê¸°ê°„ ë‚´ ì¼ë³„ ë¶ˆëŸ‰ë¥  ë³€í™”ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                            ${report.charts.dailyTrend ? `
                                <p>ìµœê³ : ${Math.max(...report.charts.dailyTrend.data)}% | 
                                   ìµœì €: ${Math.min(...report.charts.dailyTrend.data)}% | 
                                   í‰ê· : ${(report.charts.dailyTrend.data.reduce((a,b) => a+b, 0) / report.charts.dailyTrend.data.length).toFixed(1)}%</p>
                            ` : ''}
                        </div>
                        
                        <div class="chart-container">
                            <h3>ë¶ˆëŸ‰ ìœ í˜• ë¶„í¬</h3>
                            ${report.charts.defectType ? `
                                <table>
                                    <thead>
                                        <tr><th>ë¶ˆëŸ‰ ìœ í˜•</th><th>ë°œìƒ ê±´ìˆ˜</th><th>ë¹„ìœ¨</th></tr>
                                    </thead>
                                    <tbody>
                                        ${report.charts.defectType.labels.map((label, i) => `
                                            <tr>
                                                <td>${label}</td>
                                                <td>${report.charts.defectType.data[i]}</td>
                                                <td>${((report.charts.defectType.data[i] / report.charts.defectType.data.reduce((a,b) => a+b, 0)) * 100).toFixed(1)}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            ` : ''}
                        </div>
                        
                        <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #e2e8f0; text-align: center; color: #64748b;">
                            <p>QIP Trainer Dashboard - ${report.generatedAt}</p>
                            <p>ë³¸ ë¦¬í¬íŠ¸ëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        </footer>
                    </body>
                    </html>
                `;
            }
        };
        
        // Display alerts and predictions
        function displayAlerts() {
            const container = document.getElementById('alertsContainer');
            if (!container) return;
            
            const alerts = predictionEngine.generateAlerts();
            if (alerts.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const alertsHTML = alerts.map(alert => {
                const colors = {
                    'success': '#10b981',
                    'warning': '#f59e0b',
                    'danger': '#ef4444',
                    'info': '#3b82f6'
                };
                
                const icons = {
                    'success': 'âœ…',
                    'warning': 'âš ï¸',
                    'danger': 'ğŸš¨',
                    'info': 'â„¹ï¸'
                };
                
                return `
                    <div style="background: ${colors[alert.type]}; color: white; padding: 0.75rem 1rem; border-radius: 0.5rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <span style="font-size: 1.5rem;">${icons[alert.type]}</span>
                        <div style="flex: 1;">
                            <strong style="display: block; margin-bottom: 0.25rem;">${alert.title}</strong>
                            <span style="opacity: 0.95; font-size: 0.9rem;">${alert.message}</span>
                        </div>
                        <button onclick="this.parentElement.style.display='none'" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; cursor: pointer;">âœ•</button>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = alertsHTML;
        }
        
        function updateAllComponents() {
            // Update KPI cards
            updateKPICards();
            
            // Update charts
            updateCharts();
            
            // Update tab content
            updateRiskAnalysis();
            updateDefectAnalysis();
            updateActionItems();
            updateSustainability();
            updateIncentive(); // 6.x incentive dashboard
            
            // Update alerts and predictions
            displayAlerts();
            
            // Update TQC table
            generateTQCTable();
            
            // Update timestamp
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR');
            console.log(`ğŸ”„ All components updated at ${timeStr}`);
        }
        
        function updateKPICards() {
            // Update KPI cards with real data
            const summary = dataManager.summaryData || dashboardData.summary;
            
            // Total Validations
            const totalValidationsCard = document.querySelector('[data-kpi="totalValidation"] .kpi-value');
            if (totalValidationsCard && summary) {
                const totalVal = summary.totalValidations || summary.totalInspections || 4234;
                animateValue(totalValidationsCard, 
                    parseInt(totalValidationsCard.textContent.replace(/[^0-9]/g, '')) || 0,
                    totalVal, 1000);
            }
            
            // Reject Rate
            const rejectRateCard = document.querySelector('[data-kpi="totalRejectRate"] .kpi-value');
            if (rejectRateCard && summary) {
                const rejectRate = summary.overallPassRate ? (100 - parseFloat(summary.overallPassRate)) : 3.0;
                rejectRateCard.textContent = rejectRate.toFixed(1) + '%';
            }
            
            // High Risk TQC
            const highRiskCard = document.querySelector('[data-kpi="highRiskTQC"] .kpi-value');
            if (highRiskCard) {
                const highRiskTQCs = dataManager.getHighRiskTQCs();
                highRiskCard.textContent = highRiskTQCs.length + 'ëª…';
            }
            
            // Active Auditors
            const auditorsCard = document.querySelector('[data-kpi="activeAuditors"] .kpi-value');
            if (auditorsCard && summary) {
                const auditorCount = summary.uniqueTQCs ? summary.uniqueTQCs.size : 103;
                animateValue(auditorsCard,
                    parseInt(auditorsCard.textContent.replace(/[^0-9]/g, '')) || 0,
                    auditorCount, 1000);
            }
            
            // Average Validation Qty
            const avgCard = document.querySelector('[data-kpi="avgValidationQty"] .kpi-value');
            if (avgCard && summary) {
                const avgQty = summary.totalInspections > 0 
                    ? Math.round(summary.totalValidations / summary.totalInspections)
                    : 41;
                animateValue(avgCard,
                    parseInt(avgCard.textContent.replace(/[^0-9]/g, '')) || 0,
                    avgQty, 1000);
            }
        }
        
        function animateValue(element, start, end, duration) {
            const startTime = performance.now();
            const isPercentage = element.textContent.includes('%');
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const current = start + (end - start) * progress;
                
                if (isPercentage) {
                    element.textContent = current.toFixed(1) + '%';
                } else {
                    element.textContent = Math.floor(current).toLocaleString();
                }
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
        
        // Tab functionality
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    
                    // Update buttons
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update panels
                    tabPanels.forEach(panel => panel.classList.remove('active'));
                    document.getElementById(targetTab + '-panel').classList.add('active');
                    
                    console.log(`ğŸ“‘ Switched to tab: ${targetTab}`);
                });
            });
        }
        
        // Initialize filters
        function initializeFilters() {
            const overviewFilter = document.getElementById('overviewBuildingFilter');
            if (overviewFilter) {
                overviewFilter.addEventListener('change', function() {
                    console.log(`ğŸ“ Building filter: ${this.value}`);
                    updateCharts();
                });
            }
            
            const trainingFilter = document.getElementById('trainingDefectFilter');
            if (trainingFilter) {
                trainingFilter.addEventListener('change', function() {
                    console.log(`ğŸ¯ Training filter: ${this.value}`);
                });
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Destroy existing charts before creating new ones
            Object.keys(chartInstances).forEach(key => {
                if (chartInstances[key]) {
                    try {
                        chartInstances[key].destroy();
                    } catch (e) {
                        console.log('Chart destroy error:', e);
                    }
                    delete chartInstances[key];
                }
            });
            
            // Daily Trend Chart
            const dailyTrendCtx = document.getElementById('dailyTrendChart');
            if (dailyTrendCtx && !chartInstances.dailyTrend) {
                chartInstances.dailyTrend = new Chart(dailyTrendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Week 31', 'Week 32', 'Week 33', 'Week 34'],
                        datasets: [{
                            label: 'ë¶ˆëŸ‰ë¥  (%)',
                            data: [1.4, 2.9, 3.1, 3.5],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
            
            // Defect Type Chart
            const defectTypeCtx = document.getElementById('defectTypeChart');
            if (defectTypeCtx && !chartInstances.defectType) {
                chartInstances.defectType = new Chart(defectTypeCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Thread Issue', 'Stitch Skip', 'Seam Quality', 'Measurement', 'Others'],
                        datasets: [{
                            data: [35, 25, 20, 15, 5],
                            backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            // Building Chart
            const buildingCtx = document.getElementById('buildingChart');
            if (buildingCtx && !chartInstances.building) {
                const buildingData = dashboardData.summary.areaStatistics;
                chartInstances.building = new Chart(buildingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(buildingData),
                        datasets: [{
                            label: 'í•©ê²©ë¥  (%)',
                            data: Object.values(buildingData).map(area => area.rate),
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
            
            // Initialize defect analysis charts
            initializeDefectCharts();
        }
        
        function initializeDefectCharts() {
            // Defect by Type Chart
            const defectByTypeCtx = document.getElementById('defectByTypeChart');
            if (defectByTypeCtx && !chartInstances.defectByType) {
                chartInstances.defectByType = new Chart(defectByTypeCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'ë¶ˆëŸ‰ ê±´ìˆ˜',
                            data: [],
                            backgroundColor: '#ef4444',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
            
            // Defect Trend Chart
            const defectTrendCtx = document.getElementById('defectTrendChart');
            if (defectTrendCtx && !chartInstances.defectTrend) {
                chartInstances.defectTrend = new Chart(defectTrendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'ë¶ˆëŸ‰ ë°œìƒ',
                            data: [],
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
            
            // Defect by Area Chart
            const defectByAreaCtx = document.getElementById('defectByAreaChart');
            if (defectByAreaCtx && !chartInstances.defectByArea) {
                chartInstances.defectByArea = new Chart(defectByAreaCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { stacked: true },
                            y: { stacked: true }
                        }
                    }
                });
            }
        }
        
        function updateCharts() {
            // Update charts with real data
            const summary = dataManager.summaryData || dashboardData.summary;
            const selectedBuilding = document.getElementById('overviewBuildingFilter')?.value || 'all';
            
            // Update Daily Trend Chart
            if (chartInstances.dailyTrend) {
                const trendData = dataManager.getDailyTrend();
                if (trendData.labels.length > 0) {
                    chartInstances.dailyTrend.data.labels = trendData.labels;
                    chartInstances.dailyTrend.data.datasets[0].data = trendData.data;
                    chartInstances.dailyTrend.update();
                }
            }
            
            // Update Defect Type Chart
            if (chartInstances.defectType) {
                const defectData = dataManager.getDefectDistribution();
                if (defectData.labels.length > 0) {
                    chartInstances.defectType.data.labels = defectData.labels;
                    chartInstances.defectType.data.datasets[0].data = defectData.data;
                    chartInstances.defectType.update();
                }
            }
            
            // Update Building Chart
            if (chartInstances.building && summary) {
                let buildingData;
                
                if (selectedBuilding === 'all') {
                    // Show all buildings
                    buildingData = summary.byBuilding || summary.areaStatistics || {};
                } else {
                    // Show only selected building
                    const allData = summary.byBuilding || summary.areaStatistics || {};
                    buildingData = {};
                    if (allData[selectedBuilding]) {
                        buildingData[selectedBuilding] = allData[selectedBuilding];
                    }
                }
                
                const labels = Object.keys(buildingData);
                const data = labels.map(building => {
                    const b = buildingData[building];
                    return parseFloat(b.rate) || 0;
                });
                
                chartInstances.building.data.labels = labels;
                chartInstances.building.data.datasets[0].data = data;
                chartInstances.building.update();
            }
            
            // Update Defect Analysis Charts
            updateDefectCharts();
        }
        
        function updateDefectCharts() {
            const summary = dataManager.summaryData;
            
            // Update Defect by Type Chart
            if (chartInstances.defectByType && summary && summary.byDefect) {
                const defectData = dataManager.getDefectDistribution();
                chartInstances.defectByType.data.labels = defectData.labels;
                chartInstances.defectByType.data.datasets[0].data = defectData.data;
                chartInstances.defectByType.update();
            }
            
            // Update Defect Trend Chart
            if (chartInstances.defectTrend && summary && summary.byDate) {
                const trendData = dataManager.getDailyTrend();
                chartInstances.defectTrend.data.labels = trendData.labels;
                chartInstances.defectTrend.data.datasets[0].data = trendData.data;
                chartInstances.defectTrend.update();
            }
            
            // Update Defect by Area Chart
            if (chartInstances.defectByArea && summary && summary.byBuilding) {
                const buildings = Object.keys(summary.byBuilding);
                const defectTypes = summary.byDefect ? Object.keys(summary.byDefect).slice(0, 5) : [];
                
                if (buildings.length > 0 && defectTypes.length > 0) {
                    const datasets = defectTypes.map((defect, index) => ({
                        label: defect,
                        data: buildings.map(() => Math.floor(Math.random() * 20)), // Placeholder data
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6'][index]
                    }));
                    
                    chartInstances.defectByArea.data.labels = buildings;
                    chartInstances.defectByArea.data.datasets = datasets;
                    chartInstances.defectByArea.update();
                }
            }
        }
        
        // Generate TQC Table
        function generateTQCTable() {
            const tbody = document.getElementById('tqcTableBody');
            if (!tbody) return;
            
            const summary = dataManager.summaryData;
            
            if (summary && summary.byTQC) {
                // Convert TQC data to array and sort by pass rate
                const tqcArray = Object.entries(summary.byTQC)
                    .map(([id, data]) => {
                        const rejectRate = 100 - parseFloat(data.rate);
                        let status = 'normal';
                        let score = 100;
                        
                        if (rejectRate > 5) {
                            status = 'danger';
                            score = 60;
                        } else if (rejectRate > 3) {
                            status = 'warning';
                            score = 75;
                        } else if (rejectRate > 1) {
                            status = 'normal';
                            score = 90;
                        }
                        
                        // Find most common defect
                        const defectCounts = {};
                        data.errors.forEach(error => {
                            const type = error.split('(')[0].trim();
                            defectCounts[type] = (defectCounts[type] || 0) + 1;
                        });
                        const mainDefect = Object.keys(defectCounts).length > 0
                            ? Object.entries(defectCounts).sort((a, b) => b[1] - a[1])[0][0]
                            : 'None';
                        
                        // Get building from first inspection (simplified)
                        const building = 'ASSEMBLY A'; // This would need to be tracked in the data
                        
                        return {
                            id,
                            name: data.name,
                            building,
                            qty: data.validations,
                            rate: rejectRate.toFixed(1),
                            defect: mainDefect,
                            status,
                            score,
                            passRate: parseFloat(data.rate)
                        };
                    })
                    .sort((a, b) => b.passRate - a.passRate);
                
                // Add rank and render
                tbody.innerHTML = tqcArray.map((tqc, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${tqc.id}</td>
                        <td>${tqc.name}</td>
                        <td>${tqc.building}</td>
                        <td>${tqc.qty.toLocaleString()}</td>
                        <td>${tqc.rate}%</td>
                        <td>${tqc.defect}</td>
                        <td><span class="status-badge status-${tqc.status}">${getStatusText(tqc.status)}</span></td>
                        <td>${tqc.score}</td>
                    </tr>
                `).join('');
                
                console.log(`ğŸ“Š TQC table updated with ${tqcArray.length} records`);
            } else {
                // Use sample data if no real data available
                const tqcData = [
                    { rank: 1, id: '620090001', name: 'NGUYEN VAN A', building: 'ASSEMBLY A', qty: 1200, rate: 0.8, defect: 'Minor', status: 'normal', score: 95 },
                    { rank: 2, id: '620090002', name: 'TRAN THI B', building: 'ASSEMBLY B', qty: 1100, rate: 1.2, defect: 'Stitch', status: 'normal', score: 92 },
                    { rank: 3, id: '620090003', name: 'LE VAN C', building: 'ASSEMBLY C', qty: 950, rate: 3.5, defect: 'Thread', status: 'warning', score: 75 }
                ];
                
                tbody.innerHTML = tqcData.map(tqc => `
                    <tr>
                        <td>${tqc.rank}</td>
                        <td>${tqc.id}</td>
                        <td>${tqc.name}</td>
                        <td>${tqc.building}</td>
                        <td>${tqc.qty}</td>
                        <td>${tqc.rate}%</td>
                        <td>${tqc.defect}</td>
                        <td><span class="status-badge status-${tqc.status}">${getStatusText(tqc.status)}</span></td>
                        <td>${tqc.score}</td>
                    </tr>
                `).join('');
            }
        }
        
        function getStatusText(status) {
            const statusMap = {
                'normal': 'ìš°ìˆ˜',
                'warning': 'ê°œì„  í•„ìš”',
                'danger': 'ì¬êµìœ¡ í•„ìš”'
            };
            return statusMap[status] || status;
        }
        
        // Modal functions
        function showStatDetail(statType) {
            const modal = document.getElementById('detailModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            
            const titles = {
                'totalValidation': 'ì´ ê²€ì¦ ê±´ìˆ˜ ìƒì„¸',
                'totalRejectRate': 'ì „ì²´ ë¶ˆëŸ‰ë¥  ìƒì„¸',
                'highRiskTQC': 'ê³ ìœ„í—˜ TQC ìƒì„¸',
                'activeAuditors': 'í™œì„± ê°ì‚¬ì› ìƒì„¸',
                'avgValidationQty': 'í‰ê·  ê²€ì¦ ìˆ˜ëŸ‰ ìƒì„¸'
            };
            
            title.textContent = titles[statType] || 'ìƒì„¸ ì •ë³´';
            
            // Add real data content based on statType
            const summary = dataManager.summaryData || dashboardData.summary;
            let content = '';
            
            switch(statType) {
                case 'totalValidation':
                    const totalVal = summary.totalValidations || summary.totalInspections || 4234;
                    content = `
                        <div class="modal-data-content">
                            <h4>ê²€ì¦ í†µê³„</h4>
                            <div class="stat-item">
                                <span class="stat-label">ì´ ê²€ì¦ ê±´ìˆ˜:</span>
                                <span class="stat-value">${totalVal.toLocaleString()}ê±´</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ì¼ì¼ í‰ê· :</span>
                                <span class="stat-value">${Math.round(totalVal / 30).toLocaleString()}ê±´</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ì „ì›” ëŒ€ë¹„:</span>
                                <span class="stat-value">+12%</span>
                            </div>
                            <hr>
                            <h4>êµ¬ì—­ë³„ ë¶„í¬</h4>
                            ${Object.entries(summary.byBuilding || {}).map(([building, data]) => `
                                <div class="stat-item">
                                    <span class="stat-label">${building}:</span>
                                    <span class="stat-value">${data.validations.toLocaleString()}ê±´</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'totalRejectRate':
                    const rejectRate = summary.overallPassRate ? (100 - parseFloat(summary.overallPassRate)) : 3.0;
                    content = `
                        <div class="modal-data-content">
                            <h4>ë¶ˆëŸ‰ë¥  ë¶„ì„</h4>
                            <div class="stat-item">
                                <span class="stat-label">ì „ì²´ ë¶ˆëŸ‰ë¥ :</span>
                                <span class="stat-value">${rejectRate.toFixed(1)}%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">í•©ê²©ë¥ :</span>
                                <span class="stat-value">${(100 - rejectRate).toFixed(1)}%</span>
                            </div>
                            <hr>
                            <h4>ì£¼ìš” ë¶ˆëŸ‰ ìœ í˜•</h4>
                            ${Object.entries(summary.byDefect || {}).slice(0, 5).map(([defect, count]) => `
                                <div class="stat-item">
                                    <span class="stat-label">${defect}:</span>
                                    <span class="stat-value">${count}ê±´</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'highRiskTQC':
                    const highRiskTQCs = dataManager.getHighRiskTQCs ? dataManager.getHighRiskTQCs() : [];
                    content = `
                        <div class="modal-data-content">
                            <h4>ê³ ìœ„í—˜ TQC í˜„í™©</h4>
                            <div class="stat-item">
                                <span class="stat-label">ê³ ìœ„í—˜ ì¸ì›:</span>
                                <span class="stat-value">${highRiskTQCs.length}ëª…</span>
                            </div>
                            ${highRiskTQCs.length > 0 ? `
                                <hr>
                                <h4>ì¬êµìœ¡ ëŒ€ìƒì</h4>
                                ${highRiskTQCs.slice(0, 5).map(tqc => `
                                    <div class="stat-item">
                                        <span class="stat-label">${tqc.name}:</span>
                                        <span class="stat-value">ë¶ˆëŸ‰ë¥  ${tqc.rejectRate}%</span>
                                    </div>
                                `).join('')}
                            ` : '<p>í˜„ì¬ ê³ ìœ„í—˜ TQCê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                        </div>
                    `;
                    break;
                    
                case 'activeAuditors':
                    const auditorCount = summary.uniqueTQCs || summary.uniqueInspectors || 103;
                    content = `
                        <div class="modal-data-content">
                            <h4>ê°ì‚¬ì› í˜„í™©</h4>
                            <div class="stat-item">
                                <span class="stat-label">í™œì„± ê°ì‚¬ì›:</span>
                                <span class="stat-value">${auditorCount}ëª…</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ì‹ ê·œ ê°ì‚¬ì›:</span>
                                <span class="stat-value">5ëª…</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">êµìœ¡ ì´ìˆ˜ìœ¨:</span>
                                <span class="stat-value">98%</span>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'avgValidationQty':
                    const avgQty = summary.totalInspections > 0 
                        ? Math.round(summary.totalValidations / summary.totalInspections)
                        : 41;
                    content = `
                        <div class="modal-data-content">
                            <h4>ê²€ì¦ ìˆ˜ëŸ‰ ë¶„ì„</h4>
                            <div class="stat-item">
                                <span class="stat-label">í‰ê·  ê²€ì¦ ìˆ˜ëŸ‰:</span>
                                <span class="stat-value">${avgQty}ê°œ</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ëª©í‘œ ìˆ˜ëŸ‰:</span>
                                <span class="stat-value">40ê°œ</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ë‹¬ì„±ë¥ :</span>
                                <span class="stat-value">${Math.round(avgQty / 40 * 100)}%</span>
                            </div>
                        </div>
                    `;
                    break;
                    
                default:
                    content = '<p>ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>';
            }
            
            body.innerHTML = content;
            modal.classList.add('active');
        }
        
        function closeModal() {
            const modal = document.getElementById('detailModal');
            modal.classList.remove('active');
        }
        
        // Enhanced modal functionality - ESC key and outside click
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('detailModal');
            
            // ESC key to close modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal && modal.classList.contains('active')) {
                    closeModal();
                }
            });
            
            // Click outside modal to close
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
            }
        });
        
        function showCustomDatePicker() {
            alert('ì»¤ìŠ¤í…€ ë‚ ì§œ ì„ íƒ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }
        
        // Cache management functions
        function getCachedData() {
            if (dataCache.googleDrive && dataCache.lastFetch) {
                const age = Date.now() - dataCache.lastFetch;
                if (age < dataCache.ttl) {
                    return dataCache.googleDrive;
                }
            }
            
            // Check localStorage fallback
            try {
                const stored = localStorage.getItem('dashboardCache');
                if (stored) {
                    const cached = JSON.parse(stored);
                    const age = Date.now() - cached.timestamp;
                    if (age < 24 * 60 * 60 * 1000) { // 24 hours for localStorage
                        return cached.data;
                    }
                }
            } catch (e) {}
            
            return null;
        }
        
        function setCachedData(data) {
            dataCache.googleDrive = data;
            dataCache.lastFetch = Date.now();
            
            // Store in localStorage for offline support
            try {
                localStorage.setItem('dashboardCache', JSON.stringify({
                    data: data,
                    timestamp: Date.now()
                }));
            } catch (e) {
                console.warn('Failed to cache data:', e);
            }
        }
        
        // Debounce utility for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Optimized refresh with loading state
        async function refreshData() {
            if (isLoading) return;
            
            isLoading = true;
            showNotification('info', 'ğŸ”„ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨ ì¤‘...');
            
            try {
                // Clear cache to force refresh
                dataCache.googleDrive = null;
                await autoLoadData();
                updateAllComponents();
                showNotification('success', 'âœ… ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('Refresh error:', error);
                showNotification('error', 'âŒ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
            } finally {
                isLoading = false;
            }
        }
        
        // Touch support for mobile devices
        function initializeTouchSupport() {
            let touchStartX = 0;
            let touchEndX = 0;
            
            const tabContainer = document.querySelector('.tab-list');
            if (!tabContainer) return;
            
            tabContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            }, {passive: true});
            
            tabContainer.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, {passive: true});
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > swipeThreshold) {
                    const activeTab = document.querySelector('.tab-button.active');
                    const tabs = Array.from(document.querySelectorAll('.tab-button'));
                    const currentIndex = tabs.indexOf(activeTab);
                    
                    if (diff > 0 && currentIndex < tabs.length - 1) {
                        tabs[currentIndex + 1].click();
                    } else if (diff < 0 && currentIndex > 0) {
                        tabs[currentIndex - 1].click();
                    }
                }
            }
        }
    </script>
</body>
</html>