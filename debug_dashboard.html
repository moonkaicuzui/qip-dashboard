<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Debug Tool</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .error { color: red; background: #fee; padding: 10px; margin: 5px 0; }
        .warning { color: orange; background: #ffa; padding: 10px; margin: 5px 0; }
        .success { color: green; background: #efe; padding: 10px; margin: 5px 0; }
        .info { color: blue; background: #eef; padding: 10px; margin: 5px 0; }
        button { margin: 5px; padding: 10px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ” Dashboard Debug Tool</h1>
    <button onclick="checkDashboard()">ëŒ€ì‹œë³´ë“œ ë””ë²„ê·¸ ì‹œì‘</button>
    <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function checkDashboard() {
            log('Dashboard ë””ë²„ê·¸ ì‹œì‘...', 'info');

            // ëŒ€ì‹œë³´ë“œ íŒŒì¼ ì—´ê¸°
            const dashboardPath = '/Users/ksmoon/Downloads/ëŒ€ì‹œë³´ë“œ ì¸ì„¼í‹°ë¸Œ í…ŒìŠ¤íŠ¸12_9ì›” 25ì¼/output_files/Incentive_Dashboard_2025_09_Version_6.html';

            // iframeìœ¼ë¡œ ëŒ€ì‹œë³´ë“œ ë¡œë“œ
            const iframe = document.createElement('iframe');
            iframe.src = `file://${dashboardPath}`;
            iframe.style.display = 'none';
            document.body.appendChild(iframe);

            // iframeì´ ë¡œë“œë˜ë©´ ì²´í¬
            iframe.onload = function() {
                try {
                    const iframeWindow = iframe.contentWindow;
                    const iframeDoc = iframe.contentDocument;

                    // 1. ê¸€ë¡œë²Œ ë³€ìˆ˜ ì²´í¬
                    log('=== ê¸€ë¡œë²Œ ë³€ìˆ˜ ì²´í¬ ===', 'info');

                    if (iframeWindow.employeeData) {
                        const isArray = Array.isArray(iframeWindow.employeeData);
                        log(`employeeData ì¡´ì¬: ${isArray ? 'ë°°ì—´' : 'íƒ€ì… ì˜¤ë¥˜'}`, isArray ? 'success' : 'error');

                        if (isArray && iframeWindow.employeeData.length > 0) {
                            const firstEmp = iframeWindow.employeeData[0];
                            log(`ì²« ì§ì› ë°ì´í„°: ${JSON.stringify(Object.keys(firstEmp).slice(0, 5))}`, 'info');
                            log(`type í•„ë“œ: ${firstEmp.type || 'undefined'}`, firstEmp.type ? 'success' : 'error');
                            log(`name í•„ë“œ: ${firstEmp.name || 'undefined'}`, firstEmp.name ? 'success' : 'error');
                            log(`position í•„ë“œ: ${firstEmp.position || 'undefined'}`, firstEmp.position ? 'success' : 'error');
                        }
                    } else {
                        log('employeeDataê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
                    }

                    // 2. í•„ìˆ˜ í•¨ìˆ˜ ì²´í¬
                    log('=== í•„ìˆ˜ í•¨ìˆ˜ ì²´í¬ ===', 'info');
                    const requiredFunctions = [
                        'updateTypeSummaryTable',
                        'showTab',
                        'generatePositionTables',
                        'drawOrgChart',
                        'initValidationTab',
                        'changeLanguage',
                        'getIncentiveAmount'
                    ];

                    requiredFunctions.forEach(funcName => {
                        if (typeof iframeWindow[funcName] === 'function') {
                            log(`âœ“ ${funcName} í•¨ìˆ˜ ì¡´ì¬`, 'success');
                        } else {
                            log(`âœ— ${funcName} í•¨ìˆ˜ ì—†ìŒ`, 'error');
                        }
                    });

                    // 3. DOM ìš”ì†Œ ì²´í¬
                    log('=== DOM ìš”ì†Œ ì²´í¬ ===', 'info');
                    const requiredElements = [
                        'typeSummaryBody',
                        'positionContent',
                        'detailTable',
                        'criteriaContent',
                        'orgChartContent',
                        'validationContent'
                    ];

                    requiredElements.forEach(id => {
                        const elem = iframeDoc.getElementById(id);
                        if (elem) {
                            const hasContent = elem.innerHTML.trim().length > 0;
                            log(`âœ“ #${id}: ${hasContent ? 'ë‚´ìš© ìˆìŒ' : 'ë¹„ì–´ìˆìŒ'}`, hasContent ? 'success' : 'warning');
                        } else {
                            log(`âœ— #${id}: ìš”ì†Œ ì—†ìŒ`, 'error');
                        }
                    });

                    // 4. ì½˜ì†” ì—ëŸ¬ ì²´í¬
                    log('=== ì½˜ì†” ì—ëŸ¬ ì²´í¬ ===', 'info');

                    // iframeì˜ ì½˜ì†” ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ì—ëŸ¬ ìº¡ì²˜
                    const originalError = iframeWindow.console.error;
                    iframeWindow.console.error = function(...args) {
                        log(`ì½˜ì†” ì—ëŸ¬: ${args.join(' ')}`, 'error');
                        originalError.apply(iframeWindow.console, args);
                    };

                    // 5. ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
                    log('=== ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ ===', 'info');

                    try {
                        if (typeof iframeWindow.updateTypeSummaryTable === 'function') {
                            iframeWindow.updateTypeSummaryTable();
                            log('updateTypeSummaryTable() ì‹¤í–‰ ì„±ê³µ', 'success');
                        }
                    } catch(e) {
                        log(`updateTypeSummaryTable() ì‹¤í–‰ ì‹¤íŒ¨: ${e.message}`, 'error');
                    }

                    // 6. Typeë³„ ë°ì´í„° ì²´í¬
                    if (iframeWindow.employeeData && Array.isArray(iframeWindow.employeeData)) {
                        log('=== Typeë³„ ë°ì´í„° ë¶„ì„ ===', 'info');
                        const typeCount = {};
                        iframeWindow.employeeData.forEach(emp => {
                            const type = emp.type || 'UNKNOWN';
                            typeCount[type] = (typeCount[type] || 0) + 1;
                        });

                        Object.entries(typeCount).forEach(([type, count]) => {
                            log(`${type}: ${count}ëª…`, 'info');
                        });
                    }

                } catch(e) {
                    log(`ë””ë²„ê·¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${e.message}`, 'error');
                    console.error(e);
                }

                // iframe ì œê±°
                setTimeout(() => {
                    document.body.removeChild(iframe);
                }, 1000);
            };

            iframe.onerror = function() {
                log('ëŒ€ì‹œë³´ë“œ íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            };
        }
    </script>
</body>
</html>