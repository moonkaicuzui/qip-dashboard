<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
        }
        #console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 20px;
        }
        .log-entry {
            margin: 2px 0;
        }
        .log-error {
            color: #f00;
        }
        .log-warning {
            color: #ff0;
        }
        .log-info {
            color: #0ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ëŒ€ì‹œë³´ë“œ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h2>
            <button onclick="loadDashboard()">ëŒ€ì‹œë³´ë“œ ë¡œë“œ</button>
            <button onclick="testTeamDetail('ASSEMBLY')">ASSEMBLY íŒ€ ìƒì„¸ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testTeamDetail('OSC')">OSC íŒ€ ìƒì„¸ í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearConsole()">ì½˜ì†” í´ë¦¬ì–´</button>
        </div>
        
        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>ì½˜ì†” ì¶œë ¥</h2>
            <div id="console-output"></div>
        </div>
        
        <div class="test-section">
            <h2>ëŒ€ì‹œë³´ë“œ ë·°</h2>
            <iframe id="dashboard-frame" src=""></iframe>
        </div>
    </div>
    
    <script>
        let consoleOutput = [];
        const outputDiv = document.getElementById('console-output');
        const resultsDiv = document.getElementById('test-results');
        
        function logToConsole(msg, type = 'info') {
            const timestamp = new Date().toTimeString().split(' ')[0];
            const entry = `[${timestamp}] ${msg}`;
            consoleOutput.push({msg: entry, type: type});
            updateConsoleDisplay();
        }
        
        function updateConsoleDisplay() {
            outputDiv.innerHTML = consoleOutput.map(entry => {
                const className = `log-${entry.type}`;
                return `<div class="log-entry ${className}">${entry.msg}</div>`;
            }).join('');
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        function clearConsole() {
            consoleOutput = [];
            updateConsoleDisplay();
        }
        
        function loadDashboard() {
            const iframe = document.getElementById('dashboard-frame');
            iframe.src = 'output_files/management_dashboard_2025_08.html';
            
            logToConsole('ëŒ€ì‹œë³´ë“œ ë¡œë”© ì‹œì‘...', 'info');
            
            iframe.onload = function() {
                logToConsole('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì™„ë£Œ', 'info');
                
                try {
                    const iframeWindow = iframe.contentWindow;
                    const iframeDocument = iframe.contentDocument;
                    
                    // ì½˜ì†” ë©”ì‹œì§€ ê°€ë¡œì±„ê¸°
                    const originalConsoleLog = iframeWindow.console.log;
                    const originalConsoleError = iframeWindow.console.error;
                    const originalConsoleWarn = iframeWindow.console.warn;
                    
                    iframeWindow.console.log = function(...args) {
                        logToConsole('Dashboard: ' + args.join(' '), 'info');
                        originalConsoleLog.apply(iframeWindow.console, args);
                    };
                    
                    iframeWindow.console.error = function(...args) {
                        logToConsole('Dashboard Error: ' + args.join(' '), 'error');
                        originalConsoleError.apply(iframeWindow.console, args);
                    };
                    
                    iframeWindow.console.warn = function(...args) {
                        logToConsole('Dashboard Warning: ' + args.join(' '), 'warning');
                        originalConsoleWarn.apply(iframeWindow.console, args);
                    };
                    
                    // ì—ëŸ¬ í•¸ë“¤ëŸ¬
                    iframeWindow.addEventListener('error', function(event) {
                        logToConsole(`Error at ${event.filename}:${event.lineno}:${event.colno} - ${event.message}`, 'error');
                    });
                    
                    // ì°¨íŠ¸ ì²´í¬
                    setTimeout(() => {
                        checkChartElements(iframeDocument);
                    }, 2000);
                    
                } catch (e) {
                    logToConsole('ì—ëŸ¬: ' + e.message, 'error');
                }
            };
            
            iframe.onerror = function() {
                logToConsole('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨', 'error');
            };
        }
        
        function checkChartElements(doc) {
            logToConsole('ì°¨íŠ¸ ìš”ì†Œ ì²´í¬ ì‹œì‘...', 'info');
            
            // Canvas ìš”ì†Œ ì²´í¬
            const canvases = doc.querySelectorAll('canvas');
            logToConsole(`Canvas ìš”ì†Œ: ${canvases.length}ê°œ ë°œê²¬`, 'info');
            
            // ê° canvasì˜ ìƒíƒœ ì²´í¬
            canvases.forEach((canvas, index) => {
                const ctx = canvas.getContext('2d');
                const hasContent = ctx && ctx.canvas.width > 0 && ctx.canvas.height > 0;
                logToConsole(`Canvas ${index + 1} (${canvas.id}): ${hasContent ? 'âœ“ ë Œë”ë§ë¨' : 'âœ— ë¹„ì–´ìˆìŒ'}`, hasContent ? 'info' : 'warning');
            });
            
            // Plotly ì°¨íŠ¸ ì²´í¬
            const plotlyDivs = doc.querySelectorAll('[id*="sunburst"]');
            logToConsole(`Sunburst ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ: ${plotlyDivs.length}ê°œ ë°œê²¬`, 'info');
            
            plotlyDivs.forEach((div, index) => {
                const hasContent = div.children.length > 0;
                logToConsole(`Sunburst ${index + 1} (${div.id}): ${hasContent ? 'âœ“ ë Œë”ë§ë¨' : 'âœ— ë¹„ì–´ìˆìŒ'}`, hasContent ? 'info' : 'warning');
            });
            
            // ê²°ê³¼ í‘œì‹œ
            const totalCanvases = canvases.length;
            const renderedCanvases = Array.from(canvases).filter(c => {
                const ctx = c.getContext('2d');
                return ctx && ctx.canvas.width > 0 && ctx.canvas.height > 0;
            }).length;
            
            resultsDiv.innerHTML = `
                <div class="${renderedCanvases === totalCanvases ? 'success' : 'error'}">
                    <h3>ì°¨íŠ¸ ë Œë”ë§ ìƒíƒœ</h3>
                    <p>Canvas ì°¨íŠ¸: ${renderedCanvases}/${totalCanvases} ë Œë”ë§ë¨</p>
                    <p>Sunburst ì°¨íŠ¸: ${plotlyDivs.length}ê°œ ë°œê²¬</p>
                </div>
            `;
        }
        
        function testTeamDetail(teamName) {
            const iframe = document.getElementById('dashboard-frame');
            
            if (!iframe.src) {
                logToConsole('ë¨¼ì € ëŒ€ì‹œë³´ë“œë¥¼ ë¡œë“œí•˜ì„¸ìš”', 'warning');
                return;
            }
            
            logToConsole(`${teamName} íŒ€ ìƒì„¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...`, 'info');
            
            try {
                const iframeWindow = iframe.contentWindow;
                
                // showTeamDetails í•¨ìˆ˜ í˜¸ì¶œ
                if (iframeWindow.showTeamDetails) {
                    iframeWindow.showTeamDetails(teamName);
                    logToConsole(`${teamName} íŒ€ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸° ì„±ê³µ`, 'info');
                    
                    // ì°¨íŠ¸ ë Œë”ë§ ì²´í¬
                    setTimeout(() => {
                        const modal = iframeWindow.document.querySelector('.modal');
                        if (modal) {
                            const modalCanvases = modal.querySelectorAll('canvas');
                            logToConsole(`ëª¨ë‹¬ ë‚´ Canvas: ${modalCanvases.length}ê°œ`, 'info');
                            
                            modalCanvases.forEach((canvas, index) => {
                                const ctx = canvas.getContext('2d');
                                const hasContent = ctx && ctx.canvas.width > 0 && ctx.canvas.height > 0;
                                logToConsole(`ëª¨ë‹¬ Canvas ${index + 1} (${canvas.id}): ${hasContent ? 'âœ“ ë Œë”ë§ë¨' : 'âœ— ë¹„ì–´ìˆìŒ'}`, hasContent ? 'info' : 'error');
                            });
                            
                            // Sunburst ì°¨íŠ¸ ì²´í¬
                            const sunburstDiv = modal.querySelector('[id*="sunburst"]');
                            if (sunburstDiv) {
                                const hasContent = sunburstDiv.children.length > 0;
                                logToConsole(`Sunburst ì°¨íŠ¸: ${hasContent ? 'âœ“ ë Œë”ë§ë¨' : 'âœ— ë¹„ì–´ìˆìŒ'}`, hasContent ? 'info' : 'error');
                            }
                        } else {
                            logToConsole('ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                        }
                    }, 1000);
                } else {
                    logToConsole('showTeamDetails í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                }
            } catch (e) {
                logToConsole('íŒ€ ìƒì„¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + e.message, 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œ ë¡œë“œ
        window.onload = function() {
            logToConsole('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ', 'info');
        };
    </script>
</body>
</html>