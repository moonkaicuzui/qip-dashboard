<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íŠ¸ë¦¬ë§µ ìµœì¢… í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        iframe {
            width: 100%;
            height: 800px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        #console-output {
            background: #2b2b2b;
            color: #4ade80;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” íŠ¸ë¦¬ë§µ ìµœì¢… í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ í•­ëª©</h2>
            <p>âœ… íŠ¸ë¦¬ë§µ í•¨ìˆ˜ê°€ _createVisualization ë‚´ë¶€ë¡œ ì´ë™ë¨</p>
            <p>âœ… julyTeamStatsê°€ ì˜¬ë°”ë¥¸ ìŠ¤ì½”í”„ì— ì •ì˜ë¨</p>
            <p>âœ… ì¤‘ë³µëœ ê³ ì•„ ì½”ë“œê°€ ì œê±°ë¨</p>
            <p>âœ… íŠ¸ë¦¬ë§µì´ ëª¨ë‹¬ í•˜ë‹¨ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •ë¨</p>
            <p>âœ… ë°•ìŠ¤ í¬ê¸°ê°€ íŒ€ ì¸ì›ìˆ˜ì— ë¹„ë¡€í•˜ë„ë¡ êµ¬í˜„ë¨</p>
        </div>
        
        <div class="test-section">
            <h2>ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testModal()">ì´ ì¸ì› ëª¨ë‹¬ ì—´ê¸° í…ŒìŠ¤íŠ¸</button>
            <button onclick="checkTreemap()">íŠ¸ë¦¬ë§µ ìš”ì†Œ í™•ì¸</button>
            <button onclick="checkConsole()">ì½˜ì†” ì—ëŸ¬ í™•ì¸</button>
            
            <div id="console-output"></div>
        </div>
        
        <div class="test-section">
            <h2>ëŒ€ì‹œë³´ë“œ ë¯¸ë¦¬ë³´ê¸°</h2>
            <iframe id="dashboard" src="output_files/management_dashboard_2025_08.html"></iframe>
        </div>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f87171' : type === 'success' ? '#4ade80' : '#60a5fa';
            output.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function testModal() {
            try {
                const iframe = document.getElementById('dashboard');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Find and click the total employees metric
                const metrics = iframeDoc.querySelectorAll('.metric-card');
                let totalEmployeesCard = null;
                
                metrics.forEach(metric => {
                    if (metric.textContent.includes('ì´ ì¸ì›')) {
                        totalEmployeesCard = metric;
                    }
                });
                
                if (totalEmployeesCard) {
                    totalEmployeesCard.click();
                    log('âœ… ì´ ì¸ì› ëª¨ë‹¬ ì—´ê¸° ì„±ê³µ', 'success');
                    
                    // Check for treemap after a delay
                    setTimeout(() => {
                        checkTreemapInModal();
                    }, 500);
                } else {
                    log('âŒ ì´ ì¸ì› ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                }
            } catch (e) {
                log('âŒ ì—ëŸ¬: ' + e.message, 'error');
            }
        }
        
        function checkTreemapInModal() {
            try {
                const iframe = document.getElementById('dashboard');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const modal = iframeDoc.getElementById('modal-total-employees');
                if (!modal || modal.style.display === 'none') {
                    log('âŒ ëª¨ë‹¬ì´ ì—´ë¦¬ì§€ ì•ŠìŒ', 'error');
                    return;
                }
                
                const treemaps = modal.querySelectorAll('[id^="treemap-"]');
                if (treemaps.length > 0) {
                    log(`âœ… íŠ¸ë¦¬ë§µ ë°œê²¬! (${treemaps.length}ê°œ)`, 'success');
                    
                    // Check if treemap has content
                    treemaps.forEach(treemap => {
                        const boxes = treemap.querySelectorAll('div[style*="position: absolute"]');
                        log(`  - íŠ¸ë¦¬ë§µ ë°•ìŠ¤ ìˆ˜: ${boxes.length}ê°œ`, 'info');
                    });
                } else {
                    log('âŒ íŠ¸ë¦¬ë§µì´ ëª¨ë‹¬ì— ì—†ìŒ', 'error');
                }
                
                // Check modal structure
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    log(`  ëª¨ë‹¬ ë°”ë”” ìì‹ ìš”ì†Œ: ${modalBody.children.length}ê°œ`, 'info');
                    
                    // Check if treemap is at bottom
                    const lastChild = modalBody.lastElementChild;
                    if (lastChild && lastChild.textContent.includes('íŒ€ë³„ ì¸ì› ë¶„í¬')) {
                        log('âœ… íŠ¸ë¦¬ë§µì´ ëª¨ë‹¬ í•˜ë‹¨ì— ìœ„ì¹˜í•¨', 'success');
                    }
                }
            } catch (e) {
                log('âŒ íŠ¸ë¦¬ë§µ í™•ì¸ ì¤‘ ì—ëŸ¬: ' + e.message, 'error');
            }
        }
        
        function checkTreemap() {
            try {
                const iframe = document.getElementById('dashboard');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Check for treemap elements
                const treemaps = iframeDoc.querySelectorAll('[id^="treemap-"]');
                log(`íŠ¸ë¦¬ë§µ ìš”ì†Œ ìˆ˜: ${treemaps.length}`, 'info');
                
                // Check for treemap containers
                const containers = iframeDoc.querySelectorAll('.chart-container');
                let treemapContainers = 0;
                containers.forEach(container => {
                    if (container.textContent.includes('íŒ€ë³„ ì¸ì› ë¶„í¬')) {
                        treemapContainers++;
                    }
                });
                log(`íŠ¸ë¦¬ë§µ ì»¨í…Œì´ë„ˆ ìˆ˜: ${treemapContainers}`, 'info');
                
                if (treemaps.length > 0 || treemapContainers > 0) {
                    log('âœ… íŠ¸ë¦¬ë§µ ìš”ì†Œê°€ ì¡´ì¬í•¨', 'success');
                } else {
                    log('âš ï¸ íŠ¸ë¦¬ë§µ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                }
            } catch (e) {
                log('âŒ ì—ëŸ¬: ' + e.message, 'error');
            }
        }
        
        function checkConsole() {
            try {
                const iframe = document.getElementById('dashboard');
                const iframeWin = iframe.contentWindow;
                
                // Intercept console errors
                const originalError = iframeWin.console.error;
                let errorCount = 0;
                
                iframeWin.console.error = function(...args) {
                    errorCount++;
                    log(`âŒ ì½˜ì†” ì—ëŸ¬: ${args.join(' ')}`, 'error');
                    originalError.apply(iframeWin.console, args);
                };
                
                // Check for existing errors
                if (errorCount === 0) {
                    log('âœ… ì½˜ì†” ì—ëŸ¬ ì—†ìŒ', 'success');
                } else {
                    log(`âš ï¸ ${errorCount}ê°œì˜ ì½˜ì†” ì—ëŸ¬ ë°œê²¬`, 'error');
                }
                
                // Also check for warnings
                const originalWarn = iframeWin.console.warn;
                iframeWin.console.warn = function(...args) {
                    log(`âš ï¸ ì½˜ì†” ê²½ê³ : ${args.join(' ')}`, 'info');
                    originalWarn.apply(iframeWin.console, args);
                };
                
            } catch (e) {
                log('âŒ ì½˜ì†” í™•ì¸ ì¤‘ ì—ëŸ¬: ' + e.message, 'error');
            }
        }
        
        // Initial check when page loads
        window.addEventListener('load', () => {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'info');
            setTimeout(() => {
                checkTreemap();
                checkConsole();
            }, 1000);
        });
    </script>
</body>
</html>