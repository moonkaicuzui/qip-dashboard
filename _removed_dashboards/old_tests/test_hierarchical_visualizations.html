<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Position ê³„ì¸µ êµ¬ì¡° ì‹œê°í™” í…ŒìŠ¤íŠ¸</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        h3 {
            color: #555;
            margin-top: 0;
        }
        #treemap3level {
            position: relative;
            height: 600px;
            border: 1px solid #ddd;
        }
        .level1-sector {
            position: absolute;
            border: 3px solid #333;
            background: rgba(200, 200, 200, 0.1);
            overflow: hidden;
        }
        .level1-label {
            position: absolute;
            top: 2px;
            left: 2px;
            font-weight: bold;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 5px;
            border-radius: 3px;
            z-index: 100;
        }
        .level2-container {
            position: absolute;
            border: 2px solid #666;
            background: rgba(100, 150, 200, 0.1);
            overflow: hidden;
        }
        .level2-label {
            position: absolute;
            top: 1px;
            left: 1px;
            font-size: 11px;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.8);
            padding: 1px 3px;
            z-index: 50;
            border-radius: 2px;
        }
        .level3-box {
            position: absolute;
            border: 1px solid #999;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .level3-box:hover {
            transform: scale(1.05);
            z-index: 200;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        #sunburst {
            width: 600px;
            height: 600px;
        }
        #icicle {
            width: 100%;
            height: 600px;
        }
        .pros-cons {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .pros-cons h4 {
            color: #333;
            margin-top: 0;
        }
        .pros {
            color: #28a745;
        }
        .cons {
            color: #dc3545;
        }
        ul {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Position ê³„ì¸µ êµ¬ì¡° ì‹œê°í™” ë°©ë²• ë¹„êµ</h1>
    <p>Position_1st â†’ Position_2nd â†’ Position_3rd 3ë‹¨ê³„ ê³„ì¸µ êµ¬ì¡°ë¥¼ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.</p>

    <div class="container">
        <!-- 3ë‹¨ê³„ íŠ¸ë¦¬ë§µ -->
        <div class="chart-container">
            <h2>ë°©ë²• 1: 3ë‹¨ê³„ ì¤‘ì²© íŠ¸ë¦¬ë§µ</h2>
            <div id="treemap3level"></div>
            <div class="pros-cons">
                <h4>ì¥ì :</h4>
                <ul class="pros">
                    <li>ê³µê°„ í™œìš©ë„ê°€ ë†’ìŒ</li>
                    <li>í¬ê¸° ë¹„êµê°€ ì§ê´€ì </li>
                    <li>ì „ì²´ êµ¬ì¡°ë¥¼ í•œëˆˆì— íŒŒì•… ê°€ëŠ¥</li>
                </ul>
                <h4>ë‹¨ì :</h4>
                <ul class="cons">
                    <li>3ë‹¨ê³„ê°€ ë˜ë©´ ë„ˆë¬´ ë³µì¡í•´ ë³´ì„</li>
                    <li>ì‘ì€ ê·¸ë£¹ì€ ë¼ë²¨ í‘œì‹œê°€ ì–´ë ¤ì›€</li>
                    <li>ê¹Šì€ ê³„ì¸µì˜ ê²½ìš° ì‹ë³„ì´ ì–´ë ¤ì›€</li>
                </ul>
            </div>
        </div>

        <!-- Sunburst Chart -->
        <div class="chart-container">
            <h2>ë°©ë²• 2: Sunburst Chart (ë™ì‹¬ì›)</h2>
            <div id="sunburst"></div>
            <div class="pros-cons">
                <h4>ì¥ì :</h4>
                <ul class="pros">
                    <li>ê³„ì¸µ êµ¬ì¡°ê°€ ëª…í™•í•¨</li>
                    <li>ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ ì¶”ê°€ ìš©ì´</li>
                    <li>í´ë¦­í•˜ì—¬ í™•ëŒ€/ì¶•ì†Œ ê°€ëŠ¥</li>
                </ul>
                <h4>ë‹¨ì :</h4>
                <ul class="cons">
                    <li>í¬ê¸° ë¹„êµê°€ ê°ë„ë¡œ í‘œí˜„ë˜ì–´ ëœ ì§ê´€ì </li>
                    <li>í…ìŠ¤íŠ¸ í‘œì‹œ ê³µê°„ì´ ì œí•œì </li>
                </ul>
            </div>
        </div>

        <!-- Icicle Chart -->
        <div class="chart-container">
            <h2>ë°©ë²• 3: Icicle Chart (ê³„ì¸µí˜• ë§‰ëŒ€)</h2>
            <div id="icicle"></div>
            <div class="pros-cons">
                <h4>ì¥ì :</h4>
                <ul class="pros">
                    <li>ê³„ì¸µì´ ìˆ˜í‰ìœ¼ë¡œ ëª…í™•íˆ êµ¬ë¶„ë¨</li>
                    <li>ë¼ë²¨ í‘œì‹œ ê³µê°„ì´ ì¶©ë¶„í•¨</li>
                    <li>ë¹„êµê°€ ìš©ì´í•¨</li>
                </ul>
                <h4>ë‹¨ì :</h4>
                <ul class="cons">
                    <li>ê¹Šì€ ê³„ì¸µì¼ìˆ˜ë¡ í­ì´ ì¢ì•„ì§</li>
                    <li>ê³µê°„ í™œìš©ë„ê°€ íŠ¸ë¦¬ë§µë³´ë‹¤ ë‚®ìŒ</li>
                </ul>
            </div>
        </div>

        <!-- Collapsible Tree -->
        <div class="chart-container">
            <h2>ë°©ë²• 4: Collapsible Tree (ì ‘ì´ì‹ íŠ¸ë¦¬)</h2>
            <div id="tree"></div>
            <div class="pros-cons">
                <h4>ì¥ì :</h4>
                <ul class="pros">
                    <li>ê³„ì¸µ êµ¬ì¡°ê°€ ê°€ì¥ ëª…í™•í•¨</li>
                    <li>í•„ìš”í•œ ë¶€ë¶„ë§Œ í¼ì³ë³¼ ìˆ˜ ìˆìŒ</li>
                    <li>ë¬´í•œ ê¹Šì´ ì§€ì›</li>
                </ul>
                <h4>ë‹¨ì :</h4>
                <ul class="cons">
                    <li>í¬ê¸° ë¹„êµê°€ ì–´ë ¤ì›€</li>
                    <li>ì „ì²´ êµ¬ì¡°ë¥¼ í•œëˆˆì— ë³´ê¸° ì–´ë ¤ì›€</li>
                    <li>ê³µê°„ í™œìš©ë„ê°€ ë‚®ìŒ</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        const sampleData = {
            name: "ì „ì²´",
            children: [
                {
                    name: "ASSEMBLY INSPECTOR",
                    value: 120,
                    children: [
                        {
                            name: "LINE A",
                            value: 50,
                            children: [
                                { name: "TEAM 1", value: 20 },
                                { name: "TEAM 2", value: 15 },
                                { name: "TEAM 3", value: 15 }
                            ]
                        },
                        {
                            name: "LINE B",
                            value: 40,
                            children: [
                                { name: "TEAM 1", value: 25 },
                                { name: "TEAM 2", value: 15 }
                            ]
                        },
                        {
                            name: "LINE C",
                            value: 30,
                            children: [
                                { name: "TEAM 1", value: 30 }
                            ]
                        }
                    ]
                },
                {
                    name: "QA INSPECTOR",
                    value: 80,
                    children: [
                        {
                            name: "QUALITY",
                            value: 45,
                            children: [
                                { name: "AUDIT", value: 20 },
                                { name: "CONTROL", value: 25 }
                            ]
                        },
                        {
                            name: "TESTING",
                            value: 35,
                            children: [
                                { name: "MANUAL", value: 20 },
                                { name: "AUTO", value: 15 }
                            ]
                        }
                    ]
                },
                {
                    name: "TEAM LEADER",
                    value: 40,
                    children: [
                        {
                            name: "SENIOR",
                            value: 25,
                            children: [
                                { name: "SHIFT A", value: 15 },
                                { name: "SHIFT B", value: 10 }
                            ]
                        },
                        {
                            name: "JUNIOR",
                            value: 15,
                            children: [
                                { name: "SHIFT A", value: 8 },
                                { name: "SHIFT B", value: 7 }
                            ]
                        }
                    ]
                }
            ]
        };

        // 1. 3ë‹¨ê³„ ì¤‘ì²© íŠ¸ë¦¬ë§µ
        function create3LevelTreemap() {
            const container = document.getElementById('treemap3level');
            const width = container.offsetWidth;
            const height = 600;
            
            // ê°„ë‹¨í•œ squarify ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
            function squarify(items, x, y, dx, dy) {
                const total = items.reduce((sum, item) => sum + item.value, 0);
                const rects = [];
                
                let currentX = x;
                let currentY = y;
                
                items.forEach(item => {
                    const ratio = item.value / total;
                    let itemWidth, itemHeight;
                    
                    if (dx > dy) {
                        itemWidth = dx * ratio;
                        itemHeight = dy;
                        rects.push({
                            ...item,
                            x: currentX,
                            y: currentY,
                            width: itemWidth,
                            height: itemHeight
                        });
                        currentX += itemWidth;
                    } else {
                        itemWidth = dx;
                        itemHeight = dy * ratio;
                        rects.push({
                            ...item,
                            x: currentX,
                            y: currentY,
                            width: itemWidth,
                            height: itemHeight
                        });
                        currentY += itemHeight;
                    }
                });
                
                return rects;
            }
            
            // Level 1 (Position_1st)
            const level1Rects = squarify(sampleData.children, 0, 0, width, height);
            
            level1Rects.forEach(pos1 => {
                const sector = document.createElement('div');
                sector.className = 'level1-sector';
                sector.style.left = pos1.x + 'px';
                sector.style.top = pos1.y + 'px';
                sector.style.width = pos1.width + 'px';
                sector.style.height = pos1.height + 'px';
                
                const label1 = document.createElement('div');
                label1.className = 'level1-label';
                label1.textContent = pos1.name + ' (' + pos1.value + 'ëª…)';
                sector.appendChild(label1);
                
                // Level 2 (Position_2nd)
                if (pos1.children && pos1.children.length > 0) {
                    const level2Rects = squarify(
                        pos1.children, 
                        4, 
                        25, 
                        pos1.width - 8, 
                        pos1.height - 29
                    );
                    
                    level2Rects.forEach(pos2 => {
                        const level2Div = document.createElement('div');
                        level2Div.className = 'level2-container';
                        level2Div.style.left = pos2.x + 'px';
                        level2Div.style.top = pos2.y + 'px';
                        level2Div.style.width = pos2.width + 'px';
                        level2Div.style.height = pos2.height + 'px';
                        
                        const label2 = document.createElement('div');
                        label2.className = 'level2-label';
                        label2.textContent = pos2.name;
                        level2Div.appendChild(label2);
                        
                        // Level 3 (Position_3rd)
                        if (pos2.children && pos2.children.length > 0) {
                            const level3Rects = squarify(
                                pos2.children,
                                2,
                                18,
                                pos2.width - 4,
                                pos2.height - 20
                            );
                            
                            level3Rects.forEach(pos3 => {
                                const level3Box = document.createElement('div');
                                level3Box.className = 'level3-box';
                                level3Box.style.left = pos3.x + 'px';
                                level3Box.style.top = pos3.y + 'px';
                                level3Box.style.width = pos3.width + 'px';
                                level3Box.style.height = pos3.height + 'px';
                                
                                // ìƒ‰ìƒ ì„¤ì • (ì¸ì›ìˆ˜ì— ë”°ë¼)
                                const intensity = Math.min(pos3.value / 30, 1);
                                const hue = 120; // ë…¹ìƒ‰
                                level3Box.style.background = `hsl(${hue}, 70%, ${70 - intensity * 30}%)`;
                                level3Box.style.color = intensity > 0.5 ? 'white' : 'black';
                                
                                // í¬ê¸°ì— ë”°ë¼ í…ìŠ¤íŠ¸ í‘œì‹œ
                                if (pos3.width > 30 && pos3.height > 20) {
                                    level3Box.innerHTML = `<div>${pos3.name}<br/>${pos3.value}ëª…</div>`;
                                } else if (pos3.width > 20 && pos3.height > 15) {
                                    level3Box.textContent = pos3.value;
                                }
                                
                                level3Box.title = `${pos3.name}: ${pos3.value}ëª…`;
                                level2Div.appendChild(level3Box);
                            });
                        }
                        
                        sector.appendChild(level2Div);
                    });
                }
                
                container.appendChild(sector);
            });
        }

        // 2. Sunburst Chart (Plotly ì‚¬ìš©)
        function createSunburst() {
            // ë°ì´í„°ë¥¼ Plotly í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const labels = [];
            const parents = [];
            const values = [];
            const colors = [];
            
            function processNode(node, parentName = '') {
                labels.push(node.name);
                parents.push(parentName);
                values.push(node.value);
                
                // ê¹Šì´ì— ë”°ë¼ ìƒ‰ìƒ ì„¤ì •
                const depth = parentName.split(' - ').length;
                const hue = depth * 60 + 120;
                colors.push(`hsl(${hue}, 70%, 50%)`);
                
                if (node.children) {
                    node.children.forEach(child => {
                        processNode(child, node.name);
                    });
                }
            }
            
            processNode(sampleData, '');
            
            const data = [{
                type: "sunburst",
                labels: labels,
                parents: parents,
                values: values,
                marker: { colors: colors },
                textinfo: "label+value",
                hovertemplate: '%{label}<br>ì¸ì›: %{value}ëª…<extra></extra>',
                branchvalues: "total"
            }];
            
            const layout = {
                width: 600,
                height: 600,
                margin: { t: 10, l: 10, r: 10, b: 10 }
            };
            
            Plotly.newPlot('sunburst', data, layout);
        }

        // 3. Icicle Chart (Plotly ì‚¬ìš©)
        function createIcicle() {
            const labels = [];
            const parents = [];
            const values = [];
            
            function processNode(node, parentName = '') {
                labels.push(node.name);
                parents.push(parentName);
                values.push(node.value);
                
                if (node.children) {
                    node.children.forEach(child => {
                        processNode(child, node.name);
                    });
                }
            }
            
            processNode(sampleData, '');
            
            const data = [{
                type: "icicle",
                labels: labels,
                parents: parents,
                values: values,
                textposition: 'middle',
                marker: {
                    colorscale: 'Viridis'
                }
            }];
            
            const layout = {
                width: 600,
                height: 600,
                margin: { t: 10, l: 10, r: 10, b: 10 }
            };
            
            Plotly.newPlot('icicle', data, layout);
        }

        // 4. Collapsible Tree (D3.js ì‚¬ìš©)
        function createTree() {
            const width = 600;
            const height = 600;
            
            const svg = d3.select("#tree")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const g = svg.append("g")
                .attr("transform", "translate(50,50)");
            
            const tree = d3.tree()
                .size([height - 100, width - 100]);
            
            const root = d3.hierarchy(sampleData);
            
            function update(source) {
                const treeData = tree(root);
                const nodes = treeData.descendants();
                const links = treeData.links();
                
                // ë…¸ë“œ ê·¸ë¦¬ê¸°
                const node = g.selectAll(".node")
                    .data(nodes, d => d.id || (d.id = Math.random()));
                
                const nodeEnter = node.enter().append("g")
                    .attr("class", "node")
                    .attr("transform", d => `translate(${d.y},${d.x})`);
                
                nodeEnter.append("circle")
                    .attr("r", d => Math.sqrt(d.data.value || 1) * 2)
                    .style("fill", d => d.children ? "#69b3a2" : "#404080")
                    .style("cursor", "pointer")
                    .on("click", function(event, d) {
                        if (d.children) {
                            d._children = d.children;
                            d.children = null;
                        } else {
                            d.children = d._children;
                            d._children = null;
                        }
                        update(d);
                    });
                
                nodeEnter.append("text")
                    .attr("dy", ".35em")
                    .attr("x", d => d.children ? -13 : 13)
                    .attr("text-anchor", d => d.children ? "end" : "start")
                    .text(d => d.data.name)
                    .style("font-size", "12px");
                
                // ë§í¬ ê·¸ë¦¬ê¸°
                const link = g.selectAll(".link")
                    .data(links, d => d.target.id);
                
                link.enter().insert("path", "g")
                    .attr("class", "link")
                    .attr("d", d3.linkHorizontal()
                        .x(d => d.y)
                        .y(d => d.x))
                    .style("fill", "none")
                    .style("stroke", "#ccc")
                    .style("stroke-width", 2);
            }
            
            update(root);
        }

        // ì°¨íŠ¸ ìƒì„±
        window.onload = function() {
            create3LevelTreemap();
            createSunburst();
            createIcicle();
            createTree();
        };
    </script>

    <div style="margin: 40px 20px; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2>ğŸ¯ ê¶Œì¥ì‚¬í•­</h2>
        <p><strong>Position_1st â†’ Position_2nd â†’ Position_3rd 3ë‹¨ê³„ ê³„ì¸µì˜ ê²½ìš°:</strong></p>
        <ol>
            <li><strong>ë°ì´í„°ê°€ ê· í˜•ì¡í˜€ ìˆê³  ì „ì²´ êµ¬ì¡°ë¥¼ í•œëˆˆì— ë³´ì—¬ì£¼ê³  ì‹¶ë‹¤ë©´:</strong> 3ë‹¨ê³„ ì¤‘ì²© íŠ¸ë¦¬ë§µ</li>
            <li><strong>ì¸í„°ë™í‹°ë¸Œí•œ íƒìƒ‰ì´ ì¤‘ìš”í•˜ë‹¤ë©´:</strong> Sunburst Chart (í´ë¦­í•˜ì—¬ í™•ëŒ€/ì¶•ì†Œ)</li>
            <li><strong>ëª…í™•í•œ ê³„ì¸µ êµ¬ë¶„ê³¼ ë¼ë²¨ ê°€ë…ì„±ì´ ì¤‘ìš”í•˜ë‹¤ë©´:</strong> Icicle Chart</li>
            <li><strong>ì„ íƒì ìœ¼ë¡œ ì„¸ë¶€ì‚¬í•­ì„ ë³´ì—¬ì£¼ê³  ì‹¶ë‹¤ë©´:</strong> Collapsible Tree</li>
        </ol>
        
        <h3>ğŸ’¡ ìµœì¢… ì¶”ì²œ:</h3>
        <p style="font-size: 18px; background: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3;">
            <strong>Sunburst Chart</strong>ë¥¼ ë©”ì¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ìƒì„¸ ì •ë³´ëŠ” <strong>í…Œì´ë¸”</strong>ë¡œ ë³´ì™„í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.<br/>
            ì´ìœ : 3ë‹¨ê³„ ê³„ì¸µì„ ê°€ì¥ ê¹”ë”í•˜ê²Œ í‘œí˜„í•˜ë©´ì„œë„ ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ì„ ì œê³µí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
        </p>
    </div>
</body>
</html>