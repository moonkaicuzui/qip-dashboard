<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>5ë‹¨ê³„ ê³„ì¸µ êµ¬ì¡° - 4ê°€ì§€ ì‹œê°í™” ë°©ë²• ë¹„êµ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .main-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .main-header h1 {
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        .main-header p {
            font-size: 18px;
            opacity: 0.95;
        }
        .visualization-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        .viz-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .viz-header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 20px;
            position: relative;
        }
        .viz-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .viz-header .rank {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .viz-content {
            padding: 20px;
            height: 600px;
            position: relative;
        }
        .chart-container {
            width: 100%;
            height: 500px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .controls {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .control-btn {
            padding: 8px 16px;
            margin: 5px;
            background: #11998e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .control-btn:hover {
            background: #0e7d6f;
            transform: translateY(-2px);
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            padding: 10px;
            background: #fafafa;
            border-radius: 5px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #11998e;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Sunburst specific */
        #sunburst-chart {
            width: 100%;
            height: 100%;
        }
        
        /* Treemap specific */
        #treemap-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .treemap-breadcrumb {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        /* Hybrid specific */
        #hybrid-main {
            width: 100%;
            height: 250px;
            margin-bottom: 10px;
        }
        #hybrid-detail {
            width: 100%;
            height: 230px;
        }
        
        /* Collapsible Tree specific */
        #tree-container {
            width: 100%;
            height: 100%;
            overflow: auto;
        }
        .node circle {
            cursor: pointer;
            stroke: #11998e;
            stroke-width: 2px;
        }
        .node text {
            font-size: 12px;
        }
        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 1.5px;
        }
        
        /* Legend */
        .legend {
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            font-size: 12px;
        }
        .legend-item {
            display: inline-block;
            margin-right: 15px;
        }
        .legend-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border-radius: 2px;
        }
        
        /* Tooltip */
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="main-header">
        <h1>ğŸ¯ 5ë‹¨ê³„ ê³„ì¸µ êµ¬ì¡° ì‹œê°í™” ë¹„êµ</h1>
        <p>Teams â†’ Role Categories â†’ Position_1st â†’ Position_2nd â†’ Position_3rd</p>
    </div>

    <div class="visualization-grid">
        <!-- 1. Sunburst Chart -->
        <div class="viz-card">
            <div class="viz-header">
                <h2>â˜€ï¸ Sunburst Chart (ë™ì‹¬ì›)</h2>
                <span class="rank">1ìˆœìœ„</span>
            </div>
            <div class="viz-content">
                <div id="sunburst-chart" class="chart-container"></div>
                <div class="controls">
                    <button class="control-btn" onclick="resetSunburst()">ğŸ”„ ì´ˆê¸°í™”</button>
                    <button class="control-btn" onclick="expandAll()">ğŸ“Š ì „ì²´ í¼ì¹˜ê¸°</button>
                    <span style="margin-left: 20px; color: #666;">ğŸ’¡ í´ë¦­: í™•ëŒ€ / ë”ë¸”í´ë¦­: ì¶•ì†Œ</span>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value">5</div>
                        <div class="stat-label">ê³„ì¸µ ê¹Šì´</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">12</div>
                        <div class="stat-label">íŒ€ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">70</div>
                        <div class="stat-label">ì´ ë…¸ë“œ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Zoomable Treemap -->
        <div class="viz-card">
            <div class="viz-header">
                <h2>ğŸ—‚ï¸ Zoomable Treemap</h2>
                <span class="rank">2ìˆœìœ„</span>
            </div>
            <div class="viz-content">
                <div id="treemap-container" class="chart-container">
                    <div class="treemap-breadcrumb">ì „ì²´</div>
                    <div id="zoomable-treemap"></div>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="resetTreemap()">ğŸ”„ ì´ˆê¸°í™”</button>
                    <button class="control-btn" onclick="zoomToAssembly()">ğŸ¯ ASSEMBLY íŒ€</button>
                    <span style="margin-left: 20px; color: #666;">ğŸ’¡ í´ë¦­: ì¤Œì¸ / ìš°í´ë¦­: ì¤Œì•„ì›ƒ</span>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="treemap-level">1</div>
                        <div class="stat-label">í˜„ì¬ ë ˆë²¨</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="treemap-visible">12</div>
                        <div class="stat-label">í‘œì‹œ í•­ëª©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">ê³µê°„ í™œìš©</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Hybrid Approach -->
        <div class="viz-card">
            <div class="viz-header">
                <h2>ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ (í˜„ì¬ + í™•ì¥)</h2>
                <span class="rank">3ìˆœìœ„</span>
            </div>
            <div class="viz-content">
                <div id="hybrid-main" class="chart-container"></div>
                <div id="hybrid-detail" class="chart-container"></div>
                <div class="controls">
                    <button class="control-btn" onclick="selectTeam('ASSEMBLY')">ASSEMBLY</button>
                    <button class="control-btn" onclick="selectTeam('STITCHING')">STITCHING</button>
                    <button class="control-btn" onclick="selectTeam('AQL')">AQL</button>
                    <span style="margin-left: 20px; color: #666;">ğŸ’¡ íŒ€ í´ë¦­: ìƒì„¸ ë³´ê¸°</span>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value">2+3</div>
                        <div class="stat-label">í‘œì‹œ ë°©ì‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="selected-team">-</div>
                        <div class="stat-label">ì„ íƒ íŒ€</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">í˜¼í•©</div>
                        <div class="stat-label">ì‹œê°í™”</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Collapsible Tree -->
        <div class="viz-card">
            <div class="viz-header">
                <h2>ğŸŒ³ Collapsible Tree (ì ‘ì´ì‹)</h2>
                <span class="rank">4ìˆœìœ„</span>
            </div>
            <div class="viz-content">
                <div id="tree-container" class="chart-container"></div>
                <div class="controls">
                    <button class="control-btn" onclick="expandTree()">â• ëª¨ë‘ í¼ì¹˜ê¸°</button>
                    <button class="control-btn" onclick="collapseTree()">â– ëª¨ë‘ ì ‘ê¸°</button>
                    <button class="control-btn" onclick="expandToLevel(3)">ğŸ“Š 3ë‹¨ê³„ê¹Œì§€</button>
                    <span style="margin-left: 20px; color: #666;">ğŸ’¡ ë…¸ë“œ í´ë¦­: í¼ì¹˜ê¸°/ì ‘ê¸°</span>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="tree-expanded">12</div>
                        <div class="stat-label">í¼ì¹œ ë…¸ë“œ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tree-collapsed">58</div>
                        <div class="stat-label">ì ‘íŒ ë…¸ë“œ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">ê³„ì¸µí˜•</div>
                        <div class="stat-label">êµ¬ì¡°</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // ì‹¤ì œ ë°ì´í„° êµ¬ì¡° (CSV ê¸°ë°˜)
        const hierarchyData = {
            name: "ì „ì²´",
            value: 464,
            children: [
                {
                    name: "ASSEMBLY",
                    value: 150,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 5,
                            children: [
                                {
                                    name: "A.MANAGER",
                                    value: 2,
                                    children: [
                                        { name: "A.MANAGER", value: 2, children: [{ name: "ALL ASSEMBLY BUILDING", value: 2 }] }
                                    ]
                                },
                                {
                                    name: "(V) SUPERVISOR",
                                    value: 3,
                                    children: [
                                        { name: "(V) SUPERVISOR", value: 3, children: [{ name: "2 ASSEMBLY BUILDING", value: 3 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "MID-MANAGEMENT",
                            value: 20,
                            children: [
                                {
                                    name: "GROUP LEADER",
                                    value: 8,
                                    children: [
                                        { name: "GROUP LEADER", value: 8, children: [{ name: "1 ASSEMBLY BUILDING", value: 8 }] }
                                    ]
                                },
                                {
                                    name: "LINE LEADER",
                                    value: 12,
                                    children: [
                                        { name: "LINE LEADER", value: 12, children: [{ name: "12 ASSEMBLY LINE", value: 12 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "INSPECTOR",
                            value: 100,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 100,
                                    children: [
                                        {
                                            name: "SHOES INSPECTOR",
                                            value: 100,
                                            children: [
                                                { name: "ASSEMBLY LINE TQC", value: 50 },
                                                { name: "ASSEMBLY LINE RQC", value: 50 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "PO COMPLETION",
                            value: 10,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 10,
                                    children: [
                                        { name: "QIP PO COMPLETION", value: 10, children: [{ name: "PO COMPLETION QUALITY", value: 10 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "SUPPORT",
                            value: 10,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 10,
                                    children: [
                                        { name: "B-GRADE TEAM", value: 10, children: [{ name: "B-GRADE CONTROL", value: 10 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "PACKING",
                            value: 5,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 5,
                                    children: [
                                        { name: "QIP PACKING TEAM", value: 5, children: [{ name: "SCAN PACK AREA TQC", value: 5 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "AQL",
                    value: 30,
                    children: [
                        {
                            name: "CFA",
                            value: 10,
                            children: [
                                {
                                    name: "AQL INSPECTOR",
                                    value: 10,
                                    children: [
                                        { name: "AQL INSPECTOR", value: 10, children: [{ name: "AQL INSPECTOR", value: 10 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "PACKING",
                            value: 15,
                            children: [
                                {
                                    name: "AQL INSPECTOR",
                                    value: 15,
                                    children: [
                                        {
                                            name: "QIP PACKING TEAM",
                                            value: 15,
                                            children: [
                                                { name: "FG WH INPUT-OUTPUT", value: 3 },
                                                { name: "FG WH CARTON PACKING RQC", value: 3 },
                                                { name: "FG WH CARTON PACKING TQC", value: 3 },
                                                { name: "AQL INPUT CARTON TQC", value: 3 },
                                                { name: "AQL ROOM PACKING TQC", value: 3 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "REPORT",
                            value: 5,
                            children: [
                                {
                                    name: "GROUP LEADER",
                                    value: 5,
                                    children: [
                                        { name: "REPORT TEAM", value: 5, children: [{ name: "AQL REPORT TEAM", value: 5 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "BOTTOM",
                    value: 31,
                    children: [
                        {
                            name: "MID-MANAGEMENT",
                            value: 6,
                            children: [
                                {
                                    name: "GROUP LEADER",
                                    value: 3,
                                    children: [
                                        { name: "HEAD/GROUP LEADER", value: 3, children: [{ name: "ALL BUILDING BOTTOM", value: 3 }] }
                                    ]
                                },
                                {
                                    name: "LINE LEADER",
                                    value: 3,
                                    children: [
                                        { name: "LINE LEADER", value: 3, children: [{ name: "1 BUILDING BOTTOM", value: 3 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "INSPECTOR",
                            value: 20,
                            children: [
                                {
                                    name: "BOTTOM INSPECTOR",
                                    value: 20,
                                    children: [
                                        {
                                            name: "BOTTOM INSPECTOR",
                                            value: 20,
                                            children: [
                                                { name: "BOTTOM INSPECTION RQC", value: 10 },
                                                { name: "BOTTOM INSPECTION TQC", value: 10 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "SUPPORT",
                            value: 5,
                            children: [
                                {
                                    name: "BOTTOM INSPECTOR",
                                    value: 5,
                                    children: [
                                        { name: "QIP REPAIRING TEAM", value: 5, children: [{ name: "BOTTOM REPAIRING", value: 5 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "STITCHING",
                    value: 86,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 5,
                            children: [
                                {
                                    name: "A.MANAGER",
                                    value: 2,
                                    children: [
                                        { name: "A.MANAGER", value: 2, children: [{ name: "ALL STITCHING BUILDING", value: 2 }] }
                                    ]
                                },
                                {
                                    name: "(V) SUPERVISOR",
                                    value: 3,
                                    children: [
                                        { name: "(V) SUPERVISOR", value: 3, children: [{ name: "1 STITCHING BUILDING", value: 3 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "MID-MANAGEMENT",
                            value: 15,
                            children: [
                                {
                                    name: "GROUP LEADER",
                                    value: 7,
                                    children: [
                                        { name: "HEAD/GROUP LEADER", value: 7, children: [{ name: "QIP LEADER'S SUCCESSOR 1", value: 7 }] }
                                    ]
                                },
                                {
                                    name: "LINE LEADER",
                                    value: 8,
                                    children: [
                                        { name: "LINE LEADER", value: 8, children: [{ name: "QIP LEADER'S SUCCESSOR 2", value: 8 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "INSPECTOR",
                            value: 66,
                            children: [
                                {
                                    name: "STITCHING INSPECTOR",
                                    value: 66,
                                    children: [
                                        {
                                            name: "UPPER INSPECTOR",
                                            value: 66,
                                            children: [
                                                { name: "STITCHING LINE TQC", value: 33 },
                                                { name: "STITCHING LINE RQC", value: 33 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "REPACKING",
                    value: 23,
                    children: [
                        {
                            name: "INSPECTOR",
                            value: 10,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 10,
                                    children: [
                                        {
                                            name: "SHOES INSPECTOR",
                                            value: 10,
                                            children: [
                                                { name: "REPACKING LINE TQC", value: 5 },
                                                { name: "REPACKING LINE RQC", value: 5 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "MID-MANAGEMENT",
                            value: 3,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 3,
                                    children: [
                                        { name: "QIP PO COMPLETION", value: 3, children: [{ name: "REPACKING PO COMPLETION", value: 3 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "PACKING",
                            value: 7,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 7,
                                    children: [
                                        {
                                            name: "QIP PACKING TEAM",
                                            value: 7,
                                            children: [
                                                { name: "REPACKING AREA INPUT-OUTPUT", value: 4 },
                                                { name: "REPACKING LINE PACKING TQC", value: 3 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "SUPPORT",
                            value: 3,
                            children: [
                                {
                                    name: "ASSEMBLY INSPECTOR",
                                    value: 3,
                                    children: [
                                        { name: "QIP REPAIRING TEAM", value: 3, children: [{ name: "REPACKING LINE REPAIRING", value: 3 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "QA",
                    value: 20,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 2,
                            children: [
                                {
                                    name: "(V) SUPERVISOR",
                                    value: 2,
                                    children: [
                                        { name: "(V) SUPERVISOR", value: 2, children: [{ name: "QA TEAM IN CHARGE", value: 2 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "MID-MANAGEMENT",
                            value: 3,
                            children: [
                                {
                                    name: "MODEL MASTER",
                                    value: 3,
                                    children: [
                                        { name: "MODEL MASTER", value: 3, children: [{ name: "MODEL MASTER", value: 3 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "AUDITOR",
                            value: 10,
                            children: [
                                {
                                    name: "AUDIT & TRAINING",
                                    value: 10,
                                    children: [
                                        {
                                            name: "AUDIT & TRAINING",
                                            value: 10,
                                            children: [
                                                { name: "AUDIT TEAM LEADER", value: 5 },
                                                { name: "AUDITOR & TRAINER", value: 5 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "REPORT",
                            value: 5,
                            children: [
                                {
                                    name: "QA TEAM",
                                    value: 5,
                                    children: [
                                        {
                                            name: "QA TEAM",
                                            value: 5,
                                            children: [
                                                { name: "QA TEAM HEAD", value: 2 },
                                                { name: "QA TEAM STAFF", value: 3 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "OSC",
                    value: 25,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 2,
                            children: [
                                {
                                    name: "(V) SUPERVISOR",
                                    value: 2,
                                    children: [
                                        { name: "(V) SUPERVISOR", value: 2, children: [{ name: "HWK OSC/MTL QUALITY", value: 2 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "MID-MANAGEMENT",
                            value: 5,
                            children: [
                                {
                                    name: "GROUP LEADER",
                                    value: 3,
                                    children: [
                                        { name: "GROUP LEADER", value: 3, children: [{ name: "INHOUSE QUALITY", value: 3 }] }
                                    ]
                                },
                                {
                                    name: "LINE LEADER",
                                    value: 2,
                                    children: [
                                        { name: "LINE LEADER", value: 2, children: [{ name: "INCOMING OSC WH", value: 2 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "INSPECTOR",
                            value: 18,
                            children: [
                                {
                                    name: "OSC INSPECTOR",
                                    value: 18,
                                    children: [
                                        {
                                            name: "OSC INSPECTOR",
                                            value: 18,
                                            children: [
                                                { name: "INHOUSE PRINTING RQC", value: 3 },
                                                { name: "INHOUSE PRINTING TQC", value: 3 },
                                                { name: "INHOUSE HF/NO-SEW RQC", value: 3 },
                                                { name: "INHOUSE HF/NO-SEW TQC", value: 3 },
                                                { name: "INCOMING WH OSC RQC", value: 3 },
                                                { name: "INCOMING WH OSC TQC", value: 3 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "MTL",
                    value: 29,
                    children: [
                        {
                            name: "MID-MANAGEMENT",
                            value: 5,
                            children: [
                                {
                                    name: "GROUP LEADER",
                                    value: 3,
                                    children: [
                                        { name: "GROUP LEADER", value: 3, children: [{ name: "MTL QUALITY IN CHARGE", value: 3 }] }
                                    ]
                                },
                                {
                                    name: "LINE LEADER",
                                    value: 2,
                                    children: [
                                        { name: "LINE LEADER", value: 2, children: [{ name: "LINE LEADER SUCCESSOR", value: 2 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "INSPECTOR",
                            value: 24,
                            children: [
                                {
                                    name: "RQC",
                                    value: 12,
                                    children: [
                                        { name: "LEATHER MTL", value: 3, children: [{ name: "LEATHER MTL TEAM LEADER", value: 3 }] },
                                        { name: "SUBSI MTL", value: 3, children: [{ name: "SUBSI MTL TEAM LEADER", value: 3 }] },
                                        { name: "TEXTILE MTL", value: 3, children: [{ name: "TEXTILE MTL TEAM LEADER", value: 3 }] },
                                        { name: "HAPPO MTL", value: 3, children: [{ name: "HAPPO MTL TEAM LEADER", value: 3 }] }
                                    ]
                                },
                                {
                                    name: "MTL INSPECTOR",
                                    value: 12,
                                    children: [
                                        { name: "LEATHER TQC", value: 3, children: [{ name: "LEATHER TQC", value: 3 }] },
                                        { name: "SUBSI TQC", value: 3, children: [{ name: "SUBSI TQC", value: 3 }] },
                                        { name: "TEXTILE TQC", value: 3, children: [{ name: "TEXTILE TQC", value: 3 }] },
                                        { name: "HAPPO TQC", value: 3, children: [{ name: "HAPPO TQC", value: 3 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "CUTTING",
                    value: 8,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 2,
                            children: [
                                {
                                    name: "(V) SUPERVISOR",
                                    value: 2,
                                    children: [
                                        { name: "(V) SUPERVISOR", value: 2, children: [{ name: "ALL CUTTING BUILDING", value: 2 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "MID-MANAGEMENT",
                            value: 3,
                            children: [
                                {
                                    name: "LINE LEADER",
                                    value: 3,
                                    children: [
                                        { name: "LINE LEADER", value: 3, children: [{ name: "LINE LEADER SUCCESSOR", value: 3 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "",
                            value: 3,
                            children: [
                                {
                                    name: "CUTTING INSPECTOR",
                                    value: 3,
                                    children: [
                                        { name: "CUTTING INSPECTOR", value: 3, children: [{ name: "CUTTING INSPECTOR", value: 3 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "OFFICE & OCPT",
                    value: 4,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 1,
                            children: [
                                {
                                    name: "(V) SUPERVISOR",
                                    value: 1,
                                    children: [
                                        { name: "(V) SUPERVISOR", value: 1, children: [{ name: "OCPT AND OFFICE LEADER", value: 1 }] }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "REPORT",
                            value: 3,
                            children: [
                                {
                                    name: "OCPT STFF",
                                    value: 1,
                                    children: [
                                        { name: "OCPT STFF", value: 1, children: [{ name: "OCPT TEAM STAFF", value: 1 }] }
                                    ]
                                },
                                {
                                    name: "GROUP LEADER",
                                    value: 2,
                                    children: [
                                        {
                                            name: "REPORT TEAM",
                                            value: 2,
                                            children: [
                                                { name: "HR REPORT", value: 1 },
                                                { name: "QIP SAP & INCOMING", value: 1 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "HWK QIP",
                    value: 1,
                    children: [
                        {
                            name: "TOP-MANAGEMENT",
                            value: 1,
                            children: [
                                {
                                    name: "MANAGER",
                                    value: 1,
                                    children: [
                                        { name: "MANAGER", value: 1, children: [{ name: "HWK QUALITY IN CHARGE", value: 1 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "NEW",
                    value: 20,
                    children: [
                        {
                            name: "NEW",
                            value: 20,
                            children: [
                                {
                                    name: "NEW",
                                    value: 20,
                                    children: [
                                        { name: "NEW", value: 20, children: [{ name: "NEW", value: 20 }] }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        // 1. Sunburst Chart
        function createSunburst() {
            const labels = [];
            const parents = [];
            const values = [];
            const colors = [];
            
            function processNode(node, parentName = '', level = 0) {
                labels.push(node.name);
                parents.push(parentName);
                values.push(node.value);
                
                // ë ˆë²¨ë³„ ìƒ‰ìƒ
                const levelColors = [
                    '#6c5ce7', // ì „ì²´
                    '#00b894', // íŒ€
                    '#fdcb6e', // ì—­í• 
                    '#e17055', // Position_1st
                    '#0984e3', // Position_2nd
                    '#a29bfe'  // Position_3rd
                ];
                colors.push(levelColors[Math.min(level, 5)]);
                
                if (node.children) {
                    node.children.forEach(child => {
                        processNode(child, node.name, level + 1);
                    });
                }
            }
            
            processNode(hierarchyData);
            
            const data = [{
                type: "sunburst",
                labels: labels,
                parents: parents,
                values: values,
                marker: { 
                    colors: colors,
                    line: { color: 'white', width: 2 }
                },
                textinfo: "label+value",
                hovertemplate: '%{label}<br>ì¸ì›: %{value}ëª…<br>ë¹„ìœ¨: %{percentParent}<extra></extra>',
                branchvalues: "total"
            }];
            
            const layout = {
                margin: { t: 0, l: 0, r: 0, b: 0 },
                sunburstcolorway: ["#00b894", "#fdcb6e", "#e17055", "#0984e3"],
            };
            
            Plotly.newPlot('sunburst-chart', data, layout, { responsive: true });
        }

        // 2. Zoomable Treemap
        function createZoomableTreemap() {
            const labels = [];
            const parents = [];
            const values = [];
            const text = [];
            
            function processNode(node, parentName = '') {
                const label = parentName ? `${node.name}` : node.name;
                labels.push(label);
                parents.push(parentName);
                values.push(node.value);
                text.push(`${node.name}<br>${node.value}ëª…`);
                
                if (node.children) {
                    node.children.forEach(child => {
                        processNode(child, label);
                    });
                }
            }
            
            processNode(hierarchyData);
            
            const data = [{
                type: "treemap",
                labels: labels,
                parents: parents,
                values: values,
                text: text,
                textposition: 'middle center',
                marker: {
                    colorscale: 'Viridis',
                    cmid: 50
                },
                pathbar: {
                    visible: true,
                    thickness: 20,
                    edgeshape: '>'
                }
            }];
            
            const layout = {
                margin: { t: 30, l: 0, r: 0, b: 0 }
            };
            
            Plotly.newPlot('zoomable-treemap', data, layout, { responsive: true });
            
            // í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            document.getElementById('zoomable-treemap').on('plotly_click', function(data) {
                const point = data.points[0];
                document.querySelector('.treemap-breadcrumb').textContent = point.label;
                document.getElementById('treemap-level').textContent = point.label.split('/').length;
            });
        }

        // 3. Hybrid Approach
        let selectedTeamData = null;
        
        function createHybrid() {
            // ìƒë‹¨: íŒ€ë³„ íŠ¸ë¦¬ë§µ
            const teamData = hierarchyData.children.map(team => ({
                name: team.name,
                value: team.value
            }));
            
            const teamTrace = {
                type: 'treemap',
                labels: teamData.map(d => d.name),
                parents: teamData.map(() => ''),
                values: teamData.map(d => d.value),
                textinfo: 'label+value',
                marker: {
                    colorscale: 'Portland'
                }
            };
            
            Plotly.newPlot('hybrid-main', [teamTrace], {
                margin: { t: 0, l: 0, r: 0, b: 0 },
                height: 250
            }, { responsive: true });
            
            // í´ë¦­ ì´ë²¤íŠ¸
            document.getElementById('hybrid-main').on('plotly_click', function(data) {
                const teamName = data.points[0].label;
                selectTeam(teamName);
            });
        }
        
        function selectTeam(teamName) {
            document.getElementById('selected-team').textContent = teamName;
            const team = hierarchyData.children.find(t => t.name === teamName);
            
            if (team) {
                // í•˜ë‹¨: ì„ íƒëœ íŒ€ì˜ Sunburst
                const labels = [];
                const parents = [];
                const values = [];
                
                function processTeam(node, parentName = '') {
                    labels.push(node.name);
                    parents.push(parentName);
                    values.push(node.value);
                    
                    if (node.children) {
                        node.children.forEach(child => {
                            processTeam(child, node.name);
                        });
                    }
                }
                
                processTeam(team);
                
                const data = [{
                    type: "sunburst",
                    labels: labels,
                    parents: parents,
                    values: values,
                    textinfo: "label+value",
                    marker: {
                        line: { color: 'white', width: 2 }
                    }
                }];
                
                Plotly.newPlot('hybrid-detail', data, {
                    margin: { t: 0, l: 0, r: 0, b: 0 },
                    height: 230
                }, { responsive: true });
            }
        }

        // 4. Collapsible Tree
        function createCollapsibleTree() {
            const width = 700;
            const height = 480;
            const margin = { top: 20, right: 120, bottom: 20, left: 50 };
            
            const svg = d3.select("#tree-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            const tree = d3.tree()
                .size([height - margin.top - margin.bottom, width - margin.left - margin.right]);
            
            const root = d3.hierarchy(hierarchyData);
            root.x0 = (height - margin.top - margin.bottom) / 2;
            root.y0 = 0;
            
            // ì´ˆê¸°ì—ëŠ” ì²« ë²ˆì§¸ ë ˆë²¨ë§Œ í¼ì¹¨
            root.children.forEach(collapse);
            
            update(root);
            
            function collapse(d) {
                if (d.children) {
                    d._children = d.children;
                    d._children.forEach(collapse);
                    d.children = null;
                }
            }
            
            function update(source) {
                const duration = 750;
                const treeData = tree(root);
                const nodes = treeData.descendants();
                const links = treeData.links();
                
                // ë…¸ë“œ ìœ„ì¹˜ ì¡°ì •
                nodes.forEach(d => {
                    d.y = d.depth * 120;
                });
                
                // ë…¸ë“œ ì—…ë°ì´íŠ¸
                const node = g.selectAll('g.node')
                    .data(nodes, d => d.id || (d.id = ++nodeId));
                
                const nodeEnter = node.enter().append('g')
                    .attr('class', 'node')
                    .attr('transform', d => `translate(${source.y0},${source.x0})`)
                    .on('click', click);
                
                nodeEnter.append('circle')
                    .attr('r', 1e-6)
                    .style('fill', d => d._children ? '#11998e' : '#fff');
                
                nodeEnter.append('text')
                    .attr('dy', '.35em')
                    .attr('x', d => d.children || d._children ? -13 : 13)
                    .attr('text-anchor', d => d.children || d._children ? 'end' : 'start')
                    .text(d => `${d.data.name} (${d.data.value})`)
                    .style('font-size', '11px');
                
                const nodeUpdate = nodeEnter.merge(node);
                
                nodeUpdate.transition()
                    .duration(duration)
                    .attr('transform', d => `translate(${d.y},${d.x})`);
                
                nodeUpdate.select('circle')
                    .attr('r', d => Math.sqrt(d.data.value) * 0.5)
                    .style('fill', d => d._children ? '#11998e' : '#fff');
                
                const nodeExit = node.exit().transition()
                    .duration(duration)
                    .attr('transform', d => `translate(${source.y},${source.x})`)
                    .remove();
                
                nodeExit.select('circle').attr('r', 1e-6);
                nodeExit.select('text').style('fill-opacity', 1e-6);
                
                // ë§í¬ ì—…ë°ì´íŠ¸
                const link = g.selectAll('path.link')
                    .data(links, d => d.target.id);
                
                const linkEnter = link.enter().insert('path', 'g')
                    .attr('class', 'link')
                    .attr('d', d => {
                        const o = { x: source.x0, y: source.y0 };
                        return diagonal(o, o);
                    });
                
                const linkUpdate = linkEnter.merge(link);
                
                linkUpdate.transition()
                    .duration(duration)
                    .attr('d', d => diagonal(d.source, d.target));
                
                link.exit().transition()
                    .duration(duration)
                    .attr('d', d => {
                        const o = { x: source.x, y: source.y };
                        return diagonal(o, o);
                    })
                    .remove();
                
                nodes.forEach(d => {
                    d.x0 = d.x;
                    d.y0 = d.y;
                });
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                updateTreeStats();
            }
            
            function diagonal(s, d) {
                const path = `M ${s.y} ${s.x}
                        C ${(s.y + d.y) / 2} ${s.x},
                          ${(s.y + d.y) / 2} ${d.x},
                          ${d.y} ${d.x}`;
                return path;
            }
            
            function click(event, d) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }
                update(d);
            }
            
            window.expandTree = function() {
                expand(root);
                update(root);
            };
            
            window.collapseTree = function() {
                root.children.forEach(collapse);
                update(root);
            };
            
            window.expandToLevel = function(level) {
                collapseAll(root);
                expandToDepth(root, level);
                update(root);
            };
            
            function expand(d) {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
                if (d.children) {
                    d.children.forEach(expand);
                }
            }
            
            function collapseAll(d) {
                if (d.children) {
                    d._children = d.children;
                    d._children.forEach(collapseAll);
                    d.children = null;
                }
            }
            
            function expandToDepth(d, depth) {
                if (depth > 0) {
                    if (d._children) {
                        d.children = d._children;
                        d._children = null;
                    }
                    if (d.children) {
                        d.children.forEach(child => expandToDepth(child, depth - 1));
                    }
                }
            }
            
            function updateTreeStats() {
                let expanded = 0;
                let collapsed = 0;
                
                function count(d) {
                    if (d.children) {
                        expanded++;
                        d.children.forEach(count);
                    } else if (d._children) {
                        collapsed++;
                    }
                }
                
                count(root);
                document.getElementById('tree-expanded').textContent = expanded;
                document.getElementById('tree-collapsed').textContent = collapsed;
            }
        }
        
        let nodeId = 0;

        // Control functions
        function resetSunburst() {
            createSunburst();
        }
        
        function expandAll() {
            // SunburstëŠ” ìë™ìœ¼ë¡œ ì „ì²´ê°€ ë³´ì„
            alert('SunburstëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì „ì²´ ê³„ì¸µì„ í‘œì‹œí•©ë‹ˆë‹¤.\níŠ¹ì • ì„¹ì…˜ì„ í´ë¦­í•˜ì—¬ í™•ëŒ€í•´ë³´ì„¸ìš”.');
        }
        
        function resetTreemap() {
            createZoomableTreemap();
            document.querySelector('.treemap-breadcrumb').textContent = 'ì „ì²´';
            document.getElementById('treemap-level').textContent = '1';
        }
        
        function zoomToAssembly() {
            // Treemapì—ì„œ ASSEMBLYë¡œ ì¤Œ
            Plotly.restyle('zoomable-treemap', {
                level: 'ASSEMBLY'
            });
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            createSunburst();
            createZoomableTreemap();
            createHybrid();
            createCollapsibleTree();
        });
    </script>
</body>
</html>