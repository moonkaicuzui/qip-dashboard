<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>직원 퇴사 리스크 분석 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        body {
            font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }

        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .language-selector {
            position: absolute;
            top: 0;
            right: 0;
        }

        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .risk-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .risk-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .risk-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
        }

        .risk-card.high-risk::before { background: var(--danger-gradient); }
        .risk-card.medium-risk::before { background: var(--warning-gradient); }
        .risk-card.low-risk::before { background: var(--success-gradient); }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .modal-content {
            border-radius: 15px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>
    
    <!-- Modal Popup -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">상세 정보</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Dynamic content -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-primary" onclick="exportDetail()">내보내기</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <h1 class="dashboard-title">직원 퇴사 리스크 분석 대시보드</h1>
            <p class="dashboard-subtitle">
                2025년 08월 | AI 기반 이탈 예측 시스템
            </p>
            
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="btn btn-sm btn-outline-primary" onclick="changeLanguage('ko')">한국어</button>
                <button class="btn btn-sm btn-outline-primary" onclick="changeLanguage('en')">English</button>
                <button class="btn btn-sm btn-outline-primary" onclick="changeLanguage('vi')">Tiếng Việt</button>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="stats-summary">
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #dc3545;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-value">23</div>
                <div class="stat-label">고위험 직원</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #ffc107;">
                    <i class="fas fa-user-clock"></i>
                </div>
                <div class="stat-value">45</div>
                <div class="stat-label">관찰 필요</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #28a745;">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-value">324</div>
                <div class="stat-label">안정적</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #17a2b8;">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-value">5.9%</div>
                <div class="stat-label">전체 리스크율</div>
            </div>
            
        </div>

        <!-- Risk Grid -->
        <div class="risk-grid">
            
            <div class="risk-card low-risk" data-category="entry" onclick="showCategoryDetail('entry')">
                <div class="risk-header">
                    <h3 class="risk-title">1. 출입원 정보</h3>
                    <span class="risk-badge low">안정</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">risk_score</div>
                        <div class="metric-value">0%</div>
                        
                        <div class="metric-change positive">
                            <i class="fas fa-arrow-down"></i> 1% 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">employee_count</div>
                        <div class="metric-value">392명</div>
                        
                    </div>
                    
                </div>
                
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
            <div class="risk-card high-risk" data-category="absence" onclick="showCategoryDetail('absence')">
                <div class="risk-header">
                    <h3 class="risk-title">2. 월 결근자 정보 (결근율)</h3>
                    <span class="risk-badge high">주의</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">risk_score</div>
                        <div class="metric-value">0%</div>
                        
                        <div class="metric-change negative">
                            <i class="fas fa-arrow-up"></i> 12% 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">absence_count</div>
                        <div class="metric-value">0건</div>
                        
                    </div>
                    
                </div>
                
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
            <div class="risk-card medium-risk" data-category="turnover" onclick="showCategoryDetail('turnover')">
                <div class="risk-header">
                    <h3 class="risk-title">3. 월 퇴사율</h3>
                    <span class="risk-badge medium">보통</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">monthly_rate</div>
                        <div class="metric-value">3.8%</div>
                        
                        <div class="metric-change positive">
                            <i class="fas fa-arrow-down"></i> 0.5% 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">resigned_count</div>
                        <div class="metric-value">15명</div>
                        
                    </div>
                    
                </div>
                <canvas id="turnoverChart" height="100"></canvas>
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
            <div class="risk-card high-risk" data-category="recent" onclick="showCategoryDetail('recent')">
                <div class="risk-header">
                    <h3 class="risk-title">4. 최근 30일내 퇴사 인원 (종합)</h3>
                    <span class="risk-badge critical">긴급</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">recent_resignations</div>
                        <div class="metric-value">15명</div>
                        
                        <div class="metric-change negative">
                            <i class="fas fa-arrow-up"></i> 3명 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">avg_tenure</div>
                        <div class="metric-value">0.0년</div>
                        
                    </div>
                    
                </div>
                
                <div class="employee-list">
                    
                    <div class="employee-item">
                        <span class="employee-name">DANH THỊ NHƯ Ý</span>
                        <span class="employee-score">ID: 623080378</span>
                    </div>
                    
                    <div class="employee-item">
                        <span class="employee-name">PHẠM TẤN ĐẠT</span>
                        <span class="employee-score">ID: 625020481</span>
                    </div>
                    
                    <div class="employee-item">
                        <span class="employee-name">TRẦN TIẾN NAM</span>
                        <span class="employee-score">ID: 625020386</span>
                    </div>
                    
                </div>
            </div>
            
            <div class="risk-card medium-risk" data-category="rate" onclick="showCategoryDetail('rate')">
                <div class="risk-header">
                    <h3 class="risk-title">5. 최근 30일내 퇴사 인원율 (신입 퇴사율)</h3>
                    <span class="risk-badge medium">보통</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">turnover_rate</div>
                        <div class="metric-value">2.0%</div>
                        
                        <div class="metric-change negative">
                            <i class="fas fa-arrow-up"></i> 0.8% 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">업계 평균</div>
                        <div class="metric-value">1.5%</div>
                        
                    </div>
                    
                </div>
                <canvas id="rateChart" height="100"></canvas>
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
            <div class="risk-card low-risk" data-category="newbie" onclick="showCategoryDetail('newbie')">
                <div class="risk-header">
                    <h3 class="risk-title">6. 입사일 기준 60일 미만 인원</h3>
                    <span class="risk-badge low">안정</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">new_employee_count</div>
                        <div class="metric-value">14명</div>
                        
                        <div class="metric-change negative">
                            <i class="fas fa-arrow-up"></i> 5명 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">적응률</div>
                        <div class="metric-value">0%</div>
                        
                    </div>
                    
                </div>
                
                <div class="employee-list">
                    
                    <div class="employee-item">
                        <span class="employee-name">LÝ THỊ THU HỒNG</span>
                        <span class="employee-score">2일차</span>
                    </div>
                    
                    <div class="employee-item">
                        <span class="employee-name">DƯƠNG THỊ HOÀNG DUY</span>
                        <span class="employee-score">2일차</span>
                    </div>
                    
                    <div class="employee-item">
                        <span class="employee-name">PHAN THỊ ÁI NHƯ</span>
                        <span class="employee-score">16일차</span>
                    </div>
                    
                </div>
            </div>
            
            <div class="risk-card medium-risk" data-category="position" onclick="showCategoryDetail('position')">
                <div class="risk-header">
                    <h3 class="risk-title">7. 보직 부여 이후 신입 퇴사율</h3>
                    <span class="risk-badge medium">보통</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">qip_position_rate</div>
                        <div class="metric-value">4.5%</div>
                        
                        <div class="metric-change negative">
                            <i class="fas fa-arrow-up"></i> 1.2% 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">leader_rate</div>
                        <div class="metric-value">2.1%</div>
                        
                    </div>
                    
                </div>
                <canvas id="positionChart" height="100"></canvas>
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
            <div class="risk-card high-risk" data-category="newbie-absence" onclick="showCategoryDetail('newbie-absence')">
                <div class="risk-header">
                    <h3 class="risk-title">8. 입사일 기준 60일 미만 인원 중 결근 빈도</h3>
                    <span class="risk-badge high">주의</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">avg_absence</div>
                        <div class="metric-value">2.3회</div>
                        
                        <div class="metric-change negative">
                            <i class="fas fa-arrow-up"></i> 0.8회 전월 대비
                        </div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">risk_employees</div>
                        <div class="metric-value">3명</div>
                        
                    </div>
                    
                </div>
                
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
            <div class="risk-card low-risk" data-category="maternity" onclick="showCategoryDetail('maternity')">
                <div class="risk-header">
                    <h3 class="risk-title">9. 입사일 기준 60일 미만 임산부 직원</h3>
                    <span class="risk-badge low">안정</span>
                </div>
                <div class="risk-metrics">
                    
                    <div class="metric-item">
                        <div class="metric-label">pregnant_count</div>
                        <div class="metric-value">0명</div>
                        
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-label">지원 현황</div>
                        <div class="metric-value">N/A</div>
                        
                    </div>
                    
                </div>
                
                <div class="employee-list">
                    
                <p style="text-align: center; color: #6c757d; margin: 20px 0;">
                    현재 해당 없음
                </p>
                
                </div>
            </div>
            
        </div>

        <!-- Trend Charts -->
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h4>월별 퇴사 리스크 트렌드</h4>
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h4>부서별 리스크 분포</h4>
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-custom btn-primary-custom" onclick="exportReport()">
                <i class="fas fa-download"></i> 리포트 다운로드
            </button>
            <button class="btn btn-custom btn-primary-custom" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> 데이터 새로고침
            </button>
            <button class="btn btn-custom btn-primary-custom" onclick="showDetailedAnalysis()">
                <i class="fas fa-chart-line"></i> 상세 분석
            </button>
        </div>
    </div>

    <script>
        // Configuration and data from Python
        const config = {"dashboard": {"title": {"ko": "직원 퇴사 리스크 분석 대시보드", "en": "Employee Turnover Risk Analysis Dashboard", "vi": "Bảng điều khiển Phân tích Rủi ro Nghỉ việc"}, "subtitle": {"ko": "AI 기반 이탈 예측 시스템", "en": "AI-based Attrition Prediction System", "vi": "Hệ thống Dự đoán Nghỉ việc bằng AI"}, "version": "1.0", "language": "ko", "available_languages": ["ko", "en", "vi"]}, "risk_categories": [{"id": "entry", "order": 1, "title": {"ko": "출입원 정보", "en": "Entry Information", "vi": "Thông tin Ra vào"}, "description": {"ko": "보고서 생성일로 기준으로 해당일 이전에 퇴사하지 않은 사람을 출입원 정보라 하고, 1년 출입원 정보와 2년 출입원으로 크게 2동류로 나눠짐", "en": "Employees who haven't resigned before report date, divided into 1-year and 2-year entry groups", "vi": "Nhân viên chưa nghỉ việc trước ngày báo cáo, chia thành nhóm 1 năm và 2 năm"}, "risk_level": "low", "metrics": {"risk_score": {"value": 0, "unit": "%", "trend": -1, "trend_period": "month"}, "employee_count": {"value": 392, "unit": "명"}}, "calculation_method": "1년 출입원: 입사일 정보가 1년 미만 / 2년 출입원: 입사일 정보가 2년 미만", "employee_list": []}, {"id": "absence", "order": 2, "title": {"ko": "월 결근자 정보 (결근율)", "en": "Monthly Absence Information", "vi": "Thông tin Vắng mặt Hàng tháng"}, "description": {"ko": "월별 결근자 정보 및 결근율을 계산해줌. 결근율은 전체 출근일수와 결근 횟수를 통해 계산됨", "en": "Calculate monthly absence information and absence rate based on total work days and absence count", "vi": "Tính toán thông tin vắng mặt và tỷ lệ vắng mặt hàng tháng"}, "risk_level": "high", "metrics": {"risk_score": {"value": 0, "unit": "%", "trend": 12, "trend_period": "month"}, "absence_count": {"value": 0, "unit": "건"}}, "threshold": {"high": 60, "medium": 30, "low": 10}, "employee_list": []}, {"id": "turnover", "order": 3, "title": {"ko": "월 퇴사율", "en": "Monthly Turnover Rate", "vi": "Tỷ lệ Nghỉ việc Hàng tháng"}, "description": {"ko": "생성일로 부터 30일 이전, 1일 이전, 에를들어 8월 30일이면 8월 1일 에서 8월 30일까지 퇴사자 인원", "en": "Employees who resigned between 1st and 30th of the month from generation date", "vi": "Nhân viên nghỉ việc từ ngày 1 đến ngày 30 của tháng"}, "risk_level": "medium", "metrics": {"monthly_rate": {"value": 3.8, "unit": "%", "trend": -0.5, "trend_period": "month"}, "resigned_count": {"value": 15, "unit": "명"}}, "chart_type": "line", "chart_data": {"labels": ["5월", "6월", "7월", "8월"], "values": [4.2, 4.5, 4.3, 3.8]}, "employee_list": []}, {"id": "recent", "order": 4, "title": {"ko": "최근 30일내 퇴사 인원 (종합)", "en": "Recent 30-day Resignations", "vi": "Nghỉ việc trong 30 ngày gần đây"}, "description": {"ko": "최근 30일내 입사 인원 종합으로 최근 30일 내 입사 인원 중 퇴사하지 않은 인원 비율도 보여줌", "en": "Total recent 30-day hires and retention rate", "vi": "Tổng số tuyển dụng 30 ngày và tỷ lệ giữ chân"}, "risk_level": "critical", "metrics": {"recent_resignations": {"value": 15, "unit": "명", "trend": 3, "trend_period": "month"}, "avg_tenure": {"value": 0.0, "unit": "년"}}, "employee_list": [{"name": "DANH THỊ NHƯ Ý", "detail": "ID: 623080378"}, {"name": "PHẠM TẤN ĐẠT", "detail": "ID: 625020481"}, {"name": "TRẦN TIẾN NAM", "detail": "ID: 625020386"}]}, {"id": "rate", "order": 5, "title": {"ko": "최근 30일내 퇴사 인원율 (신입 퇴사율)", "en": "Recent 30-day Turnover Rate", "vi": "Tỷ lệ Nghỉ việc 30 ngày gần đây"}, "description": {"ko": "보고서 생성일과 가까운 데이터 입사 및 퇴사를 계산하여 위험도를 측정함", "en": "Measure risk by calculating recent hires and resignations", "vi": "Đo lường rủi ro bằng cách tính toán tuyển dụng và nghỉ việc gần đây"}, "risk_level": "medium", "metrics": {"turnover_rate": {"value": 2.0, "unit": "%", "trend": 0.8, "trend_period": "month"}, "industry_avg": {"value": 1.5, "unit": "%", "label": {"ko": "업계 평균", "en": "Industry Average", "vi": "Trung bình Ngành"}}}, "chart_type": "bar", "employee_list": []}, {"id": "newbie", "order": 6, "title": {"ko": "입사일 기준 60일 미만 인원", "en": "Employees < 60 Days", "vi": "Nhân viên < 60 Ngày"}, "description": {"ko": "입사일 기준 60일 미만 신입 직원 현황 및 적응률", "en": "New employees under 60 days and their adaptation rate", "vi": "Nhân viên mới dưới 60 ngày và tỷ lệ thích ứng"}, "risk_level": "low", "metrics": {"new_employee_count": {"value": 14, "unit": "명", "trend": 5, "trend_period": "month"}, "adaptation_rate": {"value": 0, "unit": "%", "label": {"ko": "적응률", "en": "Adaptation Rate", "vi": "Tỷ lệ Thích ứng"}}}, "employee_list": [{"name": "LÝ THỊ THU HỒNG", "detail": "2일차"}, {"name": "DƯƠNG THỊ HOÀNG DUY", "detail": "2일차"}, {"name": "PHAN THỊ ÁI NHƯ", "detail": "16일차"}]}, {"id": "position", "order": 7, "title": {"ko": "보직 부여 이후 신입 퇴사율", "en": "Post-Position Assignment Turnover", "vi": "Nghỉ việc sau khi Bổ nhiệm"}, "description": {"ko": "보직 부여 이후 신입 퇴사율 특히 QIP POSITION 1ST NAME, QIP POSITION 2ND NAME 등", "en": "Turnover rate after position assignment, especially QIP positions", "vi": "Tỷ lệ nghỉ việc sau khi bổ nhiệm chức vụ"}, "risk_level": "medium", "metrics": {"qip_position_rate": {"value": 4.5, "unit": "%", "trend": 1.2, "trend_period": "month"}, "leader_rate": {"value": 2.1, "unit": "%", "status": {"ko": "안정", "en": "Stable", "vi": "Ổn định"}}}, "chart_type": "doughnut", "chart_data": {"labels": ["QIP", "LEADER", "STAFF"], "values": [4.5, 2.1, 1.8]}, "employee_list": []}, {"id": "newbie-absence", "order": 8, "title": {"ko": "입사일 기준 60일 미만 인원 중 결근 빈도", "en": "Absence Frequency of New Employees", "vi": "Tần suất Vắng mặt của Nhân viên Mới"}, "description": {"ko": "신입 직원의 결근 패턴 분석으로 조기 이탈 위험 감지", "en": "Early attrition risk detection through new employee absence pattern analysis", "vi": "Phát hiện rủi ro nghỉ việc sớm thông qua phân tích mẫu vắng mặt"}, "risk_level": "high", "metrics": {"avg_absence": {"value": 2.3, "unit": "회", "trend": 0.8, "trend_period": "month"}, "risk_employees": {"value": 3, "unit": "명"}}, "alert_threshold": 3, "employee_list": []}, {"id": "maternity", "order": 9, "title": {"ko": "입사일 기준 60일 미만 임산부 직원", "en": "New Pregnant Employees", "vi": "Nhân viên Mới Mang thai"}, "description": {"ko": "60일 미만 신입 중 임산부 직원 현황 및 지원 관리", "en": "Status and support management for pregnant employees under 60 days", "vi": "Quản lý hỗ trợ cho nhân viên mang thai dưới 60 ngày"}, "risk_level": "low", "metrics": {"pregnant_count": {"value": 0, "unit": "명"}, "support_status": {"value": "N/A", "label": {"ko": "지원 현황", "en": "Support Status", "vi": "Tình trạng Hỗ trợ"}}}, "employee_list": []}], "summary_stats": {"high_risk": {"label": {"ko": "고위험 직원", "en": "High Risk Employees", "vi": "Nhân viên Rủi ro Cao"}, "value": 23, "icon": "exclamation-triangle", "color": "#dc3545"}, "observation": {"label": {"ko": "관찰 필요", "en": "Needs Observation", "vi": "Cần Theo dõi"}, "value": 45, "icon": "user-clock", "color": "#ffc107"}, "stable": {"label": {"ko": "안정적", "en": "Stable", "vi": "Ổn định"}, "value": 324, "icon": "user-check", "color": "#28a745"}, "overall_risk": {"label": {"ko": "전체 리스크율", "en": "Overall Risk Rate", "vi": "Tỷ lệ Rủi ro Tổng thể"}, "value": 5.9, "unit": "%", "icon": "percentage", "color": "#17a2b8"}}, "risk_levels": {"critical": {"label": {"ko": "긴급", "en": "Critical", "vi": "Khẩn cấp"}, "color": "#eb3349", "threshold": 80}, "high": {"label": {"ko": "주의", "en": "High", "vi": "Cao"}, "color": "#f2994a", "threshold": 60}, "medium": {"label": {"ko": "보통", "en": "Medium", "vi": "Trung bình"}, "color": "#66a6ff", "threshold": 40}, "low": {"label": {"ko": "안정", "en": "Low", "vi": "Thấp"}, "color": "#96e6a1", "threshold": 20}}, "buttons": {"download_report": {"ko": "리포트 다운로드", "en": "Download Report", "vi": "Tải Báo cáo"}, "refresh_data": {"ko": "데이터 새로고침", "en": "Refresh Data", "vi": "Làm mới Dữ liệu"}, "detailed_analysis": {"ko": "상세 분석", "en": "Detailed Analysis", "vi": "Phân tích Chi tiết"}}, "labels": {"vs_last_month": {"ko": "전월 대비", "en": "vs last month", "vi": "so với tháng trước"}, "employee": {"ko": "명", "en": "people", "vi": "người"}, "times": {"ko": "회", "en": "times", "vi": "lần"}, "year": {"ko": "년", "en": "year", "vi": "năm"}, "absence_count": {"ko": "결근", "en": "Absence", "vi": "Vắng mặt"}, "resigned": {"ko": "퇴사", "en": "Resigned", "vi": "Nghỉ việc"}, "no_data": {"ko": "현재 해당 없음", "en": "Currently N/A", "vi": "Hiện không có"}}};
        const currentLanguage = 'ko';
        
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            initializePopups();
        });

        function initializeCharts() {
            // Initialize mini charts for each category
            config.risk_categories.forEach(category => {
                if (category.chart_type && category.chart_data) {
                    const ctx = document.getElementById(category.id + 'Chart');
                    if (ctx) {
                        new Chart(ctx.getContext('2d'), {
                            type: category.chart_type,
                            data: {
                                labels: category.chart_data.labels,
                                datasets: [{
                                    data: category.chart_data.values,
                                    backgroundColor: getChartColors(category.chart_type),
                                    borderColor: getChartBorderColors(category.chart_type),
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                }
                            }
                        });
                    }
                }
            });

            // Main trend chart
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                new Chart(trendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월'],
                        datasets: [
                            {
                                label: '고위험',
                                data: [15, 18, 20, 22, 25, 23, 24, 23],
                                borderColor: 'rgb(255, 99, 132)',
                                tension: 0.4
                            },
                            {
                                label: '중위험',
                                data: [30, 32, 35, 38, 40, 42, 44, 45],
                                borderColor: 'rgb(255, 193, 7)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { position: 'top' } }
                    }
                });
            }

            // Department chart
            const deptCtx = document.getElementById('departmentChart');
            if (deptCtx) {
                new Chart(deptCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['PRGMRQI1', 'PRGOFQI1', 'Support', 'Management'],
                        datasets: [{
                            label: '리스크 점수',
                            data: [35, 42, 28, 15],
                            backgroundColor: ['rgba(255, 99, 132, 0.8)', 'rgba(255, 193, 7, 0.8)', 
                                            'rgba(54, 162, 235, 0.8)', 'rgba(75, 192, 192, 0.8)']
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: { y: { beginAtZero: true, max: 100 } }
                    }
                });
            }
        }

        function initializePopups() {
            // Initialize Bootstrap modal
            window.detailModal = new bootstrap.Modal(document.getElementById('detailModal'));
        }

        function showCategoryDetail(categoryId) {
            const category = config.risk_categories.find(c => c.id === categoryId);
            if (!category) return;

            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            // Get text based on current language
            const title = getText(category.title);
            const description = getText(category.description);

            modalTitle.textContent = title;
            
            // Build detailed content
            let detailHtml = `
                <h5>설명</h5>
                <p>${description}</p>
                <hr>
                <h5>상세 메트릭</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>전월 대비</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Add metrics to table
            for (const [key, metric] of Object.entries(category.metrics)) {
                if (typeof metric === 'object') {
                    const trend = metric.trend ? `${metric.trend > 0 ? '+' : ''}${metric.trend}${metric.unit || ''}` : '-';
                    detailHtml += `
                        <tr>
                            <td>${getText(metric.label) || key}</td>
                            <td>${metric.value}${metric.unit || ''}</td>
                            <td>${trend}</td>
                        </tr>
                    `;
                }
            }

            detailHtml += `
                    </tbody>
                </table>
            `;

            // Add employee list if exists
            if (category.employee_list && category.employee_list.length > 0) {
                detailHtml += `
                    <hr>
                    <h5>직원 상세</h5>
                    <ul class="list-group">
                `;
                
                category.employee_list.forEach(emp => {
                    detailHtml += `
                        <li class="list-group-item d-flex justify-content-between">
                            <span>${emp.name}</span>
                            <span class="badge bg-secondary">${emp.detail}</span>
                        </li>
                    `;
                });
                
                detailHtml += '</ul>';
            }

            modalBody.innerHTML = detailHtml;
            window.detailModal.show();
        }

        function getText(textObj) {
            if (typeof textObj === 'object') {
                return textObj[currentLanguage] || textObj['ko'] || '';
            }
            return textObj || '';
        }

        function getChartColors(type) {
            if (type === 'doughnut') {
                return ['rgba(255, 99, 132, 0.8)', 'rgba(54, 162, 235, 0.8)', 'rgba(75, 192, 192, 0.8)'];
            }
            return 'rgba(54, 162, 235, 0.8)';
        }

        function getChartBorderColors(type) {
            if (type === 'line') {
                return 'rgb(255, 99, 132)';
            }
            return 'rgba(54, 162, 235, 1)';
        }

        function changeLanguage(lang) {
            // Reload page with new language
            window.location.href = window.location.pathname + '?lang=' + lang;
        }

        function exportReport() {
            showLoading();
            setTimeout(() => {
                hideLoading();
                alert('리포트가 다운로드되었습니다.');
            }, 2000);
        }

        function refreshData() {
            showLoading();
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        function showDetailedAnalysis() {
            // Show comprehensive analysis
            alert('상세 분석 페이지로 이동합니다.');
        }

        function exportDetail() {
            const modalBody = document.getElementById('modalBody');
            const content = modalBody.innerHTML;
            
            // Create blob and download
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'risk_detail.html';
            a.click();
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>