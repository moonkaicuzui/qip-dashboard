# 하드코딩 제거 이력 문서

## 📅 작업 일자: 2025-01-25

## 📋 프로젝트 개요
QIP 인센티브 대시보드 시스템에서 하드코딩된 비즈니스 로직과 UI 요소들을 제거하고, JSON 기반 동적 시스템으로 전환한 작업 이력입니다.

## 🎯 작업 목적
1. **유지보수성 향상**: 비즈니스 룰 변경 시 코드 수정 없이 JSON 파일만 수정
2. **확장성 개선**: 새로운 조건이나 직급 추가 시 JSON 설정만 추가
3. **일관성 보장**: 모든 데이터가 단일 소스(JSON)에서 관리됨
4. **오류 감소**: 하드코딩으로 인한 불일치 문제 해결

## ❌ 제거된 하드코딩 목록

### 1. HTML/JavaScript 하드코딩 제거

#### 1.1 조건명 하드코딩
**이전 (하드코딩):**
```html
<td>출근율 ≥88%</td>
<td>무단결근 ≤2일</td>
<td>실제 근무일 >0일</td>
<td>최소 근무일 ≥12일</td>
```

**이후 (동적 처리):**
```javascript
${cond.name}  // condition_results에서 동적으로 가져옴
```

#### 1.2 조건 충족 버튼 하드코딩
**제거된 요소들:**
- 상단의 의미없는 "조건 충족" 버튼 3개
- "개산 근거" 칼럼의 하드코딩된 버튼
- 하드코딩된 조건 표시 배지

**이전:**
```html
<button class="btn btn-primary">조건 충족</button>
<span class="badge bg-success">출근✓</span>
<span class="badge bg-danger">AQL: N/A</span>
```

**이후:**
```javascript
${emp.condition_results ? emp.condition_results.map(cond => {
    if (cond.is_na || cond.actual === 'N/A') {
        return `<span class="badge" style="background-color: #999;" title="${cond.name}">N/A</span>`;
    } else if (cond.is_met) {
        return `<span class="badge bg-success" title="${cond.name}">✓</span>`;
    } else {
        return `<span class="badge bg-danger" title="${cond.name}">✗</span>`;
    }
}).join('') : ''}
```

#### 1.3 조건별 충족률 하드코딩
**제거된 하드코딩:**
```html
<div>개인 AQL: 당월 실패 0건 <span>평가 대상 아님</span></div>
<div>연속성 체크: 3개월 연속 실패 없음 <span>평가 대상 아님</span></div>
<div>팀/구역 AQL: 3개월 연속 실패 없음 <span>평가 대상 아님</span></div>
```

### 2. Python 코드 개선

#### 2.1 TYPE-3 조건 처리 로직
**추가된 코드:**
```python
def evaluate_conditions(emp_data, condition_matrix):
    """직원 데이터에 대한 조건 평가"""
    # TYPE-3인 경우 모든 조건을 N/A로 처리
    if type_name == 'TYPE-3':
        results = []
        for cond_id in range(1, 11):
            cond = conditions.get(str(cond_id), {})
            cond_name = cond.get('description', f'조건 {cond_id}')
            results.append({
                'id': cond_id,
                'name': cond_name,
                'is_met': False,
                'actual': 'N/A',
                'is_na': True  # N/A 표시를 위한 플래그
            })
        return results
```

#### 2.2 조건 평가 동적 처리
**개선 사항:**
- 모든 조건(1-10)에 대해 applicable_conditions 확인
- 해당 없는 조건은 자동으로 N/A 처리
- is_na 플래그 추가로 UI에서 구분 가능

## 📄 JSON 기반 설정 시스템

### position_condition_matrix.json 구조
```json
{
  "conditions": {
    "1": {
      "id": "attendance_rate",
      "name": "Attendance Rate >= 88%",
      "description": "출근율 88% 이상"
    }
    // ... 나머지 조건들
  },
  "position_matrix": {
    "TYPE-3": {
      "default": {
        "applicable_conditions": [],
        "excluded_conditions": [1,2,3,4,5,6,7,8,9,10],
        "description": "TYPE-3 기본 설정 (모든 조건 제외)"
      }
    }
  }
}
```

## 🔄 데이터 흐름 개선

### 이전 (하드코딩):
```
HTML(하드코딩) → 화면 표시
Python(하드코딩) → 계산
```

### 이후 (동적 처리):
```
JSON 설정 → Python 읽기 → 조건 평가 → HTML 동적 생성 → 화면 표시
```

## ✅ 작업 결과

### 개선된 점:
1. **모든 조건명이 JSON에서 관리됨**
   - 한 곳에서 수정하면 전체 시스템에 반영

2. **TYPE별 조건 적용이 자동화됨**
   - TYPE-1: 직급별 다양한 조건
   - TYPE-2: 출근 조건만
   - TYPE-3: 모든 조건 N/A

3. **UI가 데이터 기반으로 렌더링됨**
   - condition_results 배열에서 동적 생성
   - 하드코딩된 텍스트 없음

4. **유지보수 편의성 대폭 향상**
   - 비개발자도 JSON 파일 수정으로 룰 변경 가능
   - 코드 수정 없이 비즈니스 로직 변경

## ⚠️ 주의사항

### UI 개선사항 손실:
하드코딩 제거 작업 중 Python 파일 수정으로 인해 기존 UI 개선사항들이 덮어써짐:
- 1열 레이아웃
- 차트 제거
- 인센티브 통계 확장

이는 별도로 복원 작업이 필요함.

## 📊 영향받은 파일

1. **integrated_dashboard_final.py**
   - evaluate_conditions() 함수 수정
   - TYPE-3 특별 처리 로직 추가

2. **output_files/dashboard_2025_08.html**
   - 조건 충족 상세 테이블 동적 처리
   - 직원별 조건 표시 동적 처리

3. **config_files/position_condition_matrix.json**
   - TYPE-3 설정 확인 및 검증

## 🚀 향후 개선 제안

1. **UI 템플릿 분리**
   - HTML 생성 로직을 별도 템플릿 파일로 분리
   - UI 변경과 로직 변경을 독립적으로 관리

2. **조건 검증 강화**
   - JSON 스키마 검증 추가
   - 조건 ID 일관성 체크

3. **테스트 자동화**
   - 각 TYPE별 조건 적용 테스트
   - UI 렌더링 테스트

## 📝 핵심 원칙
> "우리사전에 가짜 데이타는 없다"
> 
> 모든 데이터는 실제 소스에서 가져와야 하며, 하드코딩이나 가짜 데이터 생성은 절대 금지

---

작성자: Claude Code
작성일: 2025-01-25
버전: 1.0