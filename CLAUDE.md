# QIP 인센티브 대시보드 프로젝트 지침

## 🚨 필수 준수 원칙

### 데이터 처리 원칙
1. **가짜 데이터 사용 금지**
   - 테스트용 가짜 데이터 생성 금지
   - 실제 데이터만 사용
   - 데이터가 없으면 가짜로 채우지 말고 오류 표시

2. **명확한 오류 메시지**
   - 데이터가 없을 때 "데이터 오류" 메시지 표시
   - 누락된 파일명을 구체적으로 표시
   - 해결 방법 안내 포함

3. **실제 데이터 우선**
   - Google Drive 또는 실제 소스에서 데이터 가져오기
   - 임의로 데이터를 생성하지 않기
   - 시스템은 실제 운영 데이터만 처리

## 📁 프로젝트 구조

```
/
├── action.sh                    # 메인 실행 스크립트
├── src/
│   ├── step0_create_monthly_config.py
│   ├── step1_인센티브_계산_개선버전.py
│   └── step2_dashboard_version4.py
├── config_files/               # 월별 설정 파일
├── input_files/                # 입력 데이터 (실제 데이터만)
└── output_files/               # 출력 결과
```

## ⚠️ 주의사항

### 하지 말아야 할 것:
- ❌ 테스트 데이터 생성 (`test_*.py` 파일 생성 금지)
- ❌ 가짜 출근 데이터 생성
- ❌ 임의의 인센티브 금액 설정
- ❌ 데이터 없을 때 0이 아닌 값으로 채우기

### 해야 할 것:
- ✅ 실제 데이터 파일 확인
- ✅ 누락된 데이터 명확히 표시
- ✅ 데이터 오류 시 사용자에게 알림
- ✅ Google Drive 동기화 안내

## 🔍 데이터 검증

필수 데이터 파일:
1. `attendance/converted/attendance data {month}_converted.csv`
2. `{year}년 {month-1}월 인센티브 지급 세부 정보.csv`
3. `config_files/type2_position_mapping.json`
4. `config_files/auditor_trainer_area_mapping.json`

이 파일들이 없으면:
- 인센티브 계산 진행하지 않음
- 대시보드에 오류 메시지 표시
- 0 VND로 표시 (정상 동작)

## 💡 개발 가이드라인

1. **UI/UX 원칙**
   - 데이터 문제를 숨기지 말고 명확히 표시
   - 사용자가 문제를 이해하고 해결할 수 있도록 안내

2. **코드 수정 시**
   - 실제 데이터 경로만 사용
   - 하드코딩된 테스트 값 사용 금지
   - 오류 처리 강화

3. **Git 커밋 시**
   - 테스트 파일은 커밋하지 않음
   - 실제 운영 코드만 커밋

## 🏆 극복한 주요 문제들 (2025년 1월)

### 1. **0 VND 인센티브 문제** ✅ 해결
- **증상**: 대시보드에서 모든 직원 인센티브가 0 VND로 표시
- **원인**: 출석 데이터 컬럼 매칭 오류 ("No." vs "ID No")
- **해결**: 올바른 컬럼명 탐지 알고리즘 개선
- **결과**: 121,996,842 VND 정확히 계산됨

### 2. **IndexError: Out of Bounds** ✅ 해결
- **증상**: `single positional indexer is out-of-bounds` 오류
- **원인**: 빈 DataFrame에 .iloc[0] 접근
- **해결**: 방어적 코딩 - empty DataFrame 체크 추가
- **교훈**: 데이터가 없을 수 있는 모든 경우 고려

### 3. **데이터 타입 불일치** ✅ 해결
- **증상**: int64 ID가 string ID와 매칭 안됨
- **원인**: 표준화된 ID (문자열)와 원본 ID (정수) 타입 차이
- **해결**: `.astype(str).str.zfill(9)` 일관된 비교
- **영향**: 392/464명 매칭 성공

### 4. **하드코딩된 월 처리** ✅ 해결
- **증상**: JavaScript가 항상 `july_incentive`만 참조
- **원인**: 템플릿에 하드코딩된 변수명
- **해결**: 동적 템플릿 `emp.{month}_incentive` 구현
- **결과**: 모든 월에 대해 자동화 달성

### 5. **Google Drive 동기화** ✅ 해결
- **증상**: 이전 월 인센티브 파일 수동 다운로드 필요
- **원인**: 자동화 스크립트 부재
- **해결**: `sync_previous_incentive.py` 생성
- **효과**: 완전 자동화된 워크플로우

### 6. **출석 상태 잘못된 컬럼 참조** ✅ 해결
- **증상**: 근무일수 항상 0으로 계산
- **원인**: 'Work Date' 값 체크 대신 'compAdd' 상태 필요
- **해결**: 'compAdd' == 'Đi làm' 체크로 변경
- **결과**: 실제 근무일수 정확히 계산 (예: 13일)

## 📈 성과 지표

- **초기 상태**: 0 VND (100% 오류)
- **최종 상태**: 121,996,842 VND (100% 정확)
- **매칭률**: 84.5% (392/464 직원)
- **자동화**: 수동 작업 5단계 → 완전 자동화
- **동적 처리**: 하드코딩 제거, 모든 월 지원

---

*이 지침은 프로젝트 완료 시까지 항상 준수되어야 합니다.*
*Claude는 대화 시작 시 이 파일을 자동으로 읽고 적용합니다.*
*최종 업데이트: 2025년 1월 - 모든 주요 문제 해결 완료*